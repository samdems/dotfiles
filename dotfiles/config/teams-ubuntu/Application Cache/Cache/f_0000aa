var Microsoft;!function(t){!function(t){!function(t){t[t.BT_STOP=0]="BT_STOP",t[t.BT_STOP_BASE=1]="BT_STOP_BASE",t[t.BT_BOOL=2]="BT_BOOL",t[t.BT_UINT8=3]="BT_UINT8",t[t.BT_UINT16=4]="BT_UINT16",t[t.BT_UINT32=5]="BT_UINT32",t[t.BT_UINT64=6]="BT_UINT64",t[t.BT_FLOAT=7]="BT_FLOAT",t[t.BT_DOUBLE=8]="BT_DOUBLE",t[t.BT_STRING=9]="BT_STRING",t[t.BT_STRUCT=10]="BT_STRUCT",t[t.BT_LIST=11]="BT_LIST",t[t.BT_SET=12]="BT_SET",t[t.BT_MAP=13]="BT_MAP",t[t.BT_INT8=14]="BT_INT8",t[t.BT_INT16=15]="BT_INT16",t[t.BT_INT32=16]="BT_INT32",t[t.BT_INT64=17]="BT_INT64",t[t.BT_WSTRING=18]="BT_WSTRING",t[t.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(t.BondDataType||(t.BondDataType={}));!function(t){t[t.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",t[t.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",t[t.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",t[t.JSON_PROTOCOL=21322]="JSON_PROTOCOL",t[t.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",t[t.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL"}(t.ProtocolType||(t.ProtocolType={}))}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){!function(t){var e=function(){function t(){this._buffer=[]}return t.prototype.Add=function(t){for(var e=0;e<this._buffer.length&&this._buffer[e]!=t;++e);e==this._buffer.length&&this._buffer.push(t)},t.prototype.Count=function(){return this._buffer.length},t.prototype.GetBuffer=function(){return this._buffer},t}();t.Set=e;var n=function(){function t(){this._buffer=[]}return t.prototype.Add=function(t,e){-1==this._getIndex(t)&&this._buffer.push({Key:t,Value:e})},t.prototype.AddOrReplace=function(t,e){var n=this._getIndex(t);n>=0?this._buffer[n]={Key:t,Value:e}:this._buffer.push({Key:t,Value:e})},t.prototype.Remove=function(t){var e=this._getIndex(t);e>=0&&this._buffer.splice(e,1)},t.prototype.Count=function(){return this._buffer.length},t.prototype.GetBuffer=function(){return this._buffer},t.prototype.ContainsKey=function(t){return this._getIndex(t)>=0},t.prototype.Get=function(t){var e=this._getIndex(t);return e>=0?this._buffer[e].Value:null},t.prototype._getIndex=function(t){for(var e=0,n=-1;e<this._buffer.length;++e)if(this._buffer[e].Key==t){n=e;break}return n},t}();t.Map=n}(t.Collections||(t.Collections={}))}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(e){!function(t){var i=function(){function t(){}return t.GetBytes=function(t){for(var e=[],n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},t}();t.Utf8=i;var r=function(){function t(){}return t.GetString=function(t){var e,n,i,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=[],s=t.length%3;for(e=0,i=t.length-s;e<i;e+=3)n=(t[e]<<16)+(t[e+1]<<8)+t[e+2],o.push(function(t){return[r.charAt(t>>18&63),r.charAt(t>>12&63),r.charAt(t>>6&63),r.charAt(63&t)].join("")}(n));switch(s){case 1:n=t[t.length-1],o.push(r.charAt(n>>2)),o.push(r.charAt(n<<4&63)),o.push("==");break;case 2:n=(t[t.length-2]<<8)+t[t.length-1],o.push(r.charAt(n>>10)),o.push(r.charAt(n>>4&63)),o.push(r.charAt(n<<2&63)),o.push("=")}return o.join("")},t}();t.Base64=r;var o=function(){function t(){}return t.GetBytes=function(t){for(var e=[];4294967168&t;)e.push(127&t|128),t>>>=7;return e.push(127&t),e},t}();t.Varint=o;var s=function(){function t(){}return t.GetBytes=function(t){for(var e=t.low,n=t.high,i=[];n||4294967168&e;)i.push(127&e|128),e=(127&n)<<25|e>>>7,n>>>=7;return i.push(127&e),i},t}();t.Varint64=s;var a=function(){function t(){}return t.GetBytes=function(t){if(e.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(4));i.setFloat32(0,t,!0);for(var r=[],o=0;o<4;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(t,!1)},t}();t.Float=a;var u=function(){function t(){}return t.GetBytes=function(t){if(e.BrowserChecker.IsDataViewSupport()){var i=new DataView(new ArrayBuffer(8));i.setFloat64(0,t,!0);for(var r=[],o=0;o<8;++o)r.push(i.getUint8(o));return r}return n.ConvertNumberToArray(t,!0)},t}();t.Double=u;var c=function(){function t(){}return t.EncodeZigzag16=function(t){return(t=e.Number.ToInt16(t))<<1^t>>15},t.EncodeZigzag32=function(t){return(t=e.Number.ToInt32(t))<<1^t>>31},t.EncodeZigzag64=function(t){var n=t.low,i=t.high,r=i<<1|n>>>31,o=n<<1;2147483648&i&&(r=~r,o=~o);var s=new e.UInt64("0");return s.low=o,s.high=r,s},t}();t.Zigzag=c}(e.Encoding||(e.Encoding={}));!function(i){var r=function(){function t(){}return t.GetString=function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];if(i<=191)e.push(String.fromCharCode(i));else if(i<=223){r=t[++n];e.push(String.fromCharCode((31&i)<<6|63&r))}else if(i<=239){var r=t[++n],o=t[++n];e.push(String.fromCharCode((15&i)<<12|(63&r)<<6|63&o))}else i=(7&i)<<18|(63&(r=t[++n]))<<12|(63&(o=t[++n]))<<6|63&t[++n],i-=65536,e.push(String.fromCharCode(55296|i>>10&1023)),e.push(String.fromCharCode(56320|1023&i))}return e.join("")},t}();i.Utf8=r;var o=function(){function t(){}return t.GetBytes=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=[],i=0;i<t.length;++i){var r=e.indexOf(t.charAt(i++)),o=e.indexOf(t.charAt(i++)),s=e.indexOf(t.charAt(i++)),a=e.indexOf(t.charAt(i));n.push(r<<2|o>>4),s>=0&&(n.push(o<<4&240|s>>2),a>=0&&n.push(s<<6&192|a))}return n},t}();i.Base64=o;var s=function(){function e(){}return e.GetInt64=function(e){var n=new t.Bond.Int64("0"),i=this._Read(e);return n.low=i[0],i.length>1&&(n.high=i[1]),n},e.GetNumber=function(t){return this._Read(t)[0]},e._Read=function(t){for(var e=[],n=0,i=!0,r=0;i;){if(i=0!=(128&(o=t.shift())),o&=127,!(r<28)){n|=o<<r,e.push(n),n=o>>4,r=3;break}n|=o<<r,r+=7}for(;i;){var o=t.shift();if(i=0!=(128&o),o&=127,n|=o<<r,(r+=7)>=32)break}return e.push(n),e},e}();i.Varint=s;var a=function(){function t(){}return t.GetNumber=function(t){if(e.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(4)),r=0;r<4;++r)i.setUint8(r,t[r]);return i.getFloat32(0,!0)}return n.ConvertArrayToNumber(t,!1)},t}();i.Float=a;var u=function(){function t(){}return t.GetNumber=function(t){if(e.BrowserChecker.IsDataViewSupport()){for(var i=new DataView(new ArrayBuffer(8)),r=0;r<8;++r)i.setUint8(r,t[r]);return i.getFloat64(0,!0)}return n.ConvertArrayToNumber(t,!0)},t}();i.Double=u;var c=function(){function e(){}return e.DecodeZigzag16=function(t){return((65535&t)>>>1^-(1&t))<<16>>16},e.DecodeZigzag32=function(t){return t>>>1^-(1&t)},e.DecodeZigzag64=function(e){var n=1&e.high,i=e.high>>>1,r=1&e.low,o=e.low>>>1;o|=n<<31,r&&(o^=4294967295,i^=4294967295);var s=new t.Bond.UInt64("0");return s.low=o,s.high=i,s},e}();i.Zigzag=c}(e.Decoding||(e.Decoding={}));var n=function(){function t(){}return t.ConvertNumberToArray=function(t,e){if(!t)return e?this._doubleZero:this._floatZero;var n=e?11:8,i=e?52:23,r=(1<<n-1)-1,o=1-r,s=r,a=t<0?1:0;t=Math.abs(t);for(var u=Math.floor(t),c=t-u,l=2*(r+2)+i,h=new Array(l),_=0;_<l;)h[_++]=0;for(_=r+2;_&&u;)h[--_]=u%2,u=Math.floor(u/2);for(_=r+1;_<l-1&&c>0;)(c*=2)>=1?(h[++_]=1,--c):h[++_]=0;for(var f=0;f<l&&!h[f];++f);var d=r+1-f,p=f+i;if(h[p+1]){for(_=p;_>f&&!(h[_]=1-h[_]);--_);_==f&&++d}if(d>s||u)return a?e?this._doubleNegInifinity:this._floatNegInifinity:e?this._doubleInifinity:this._floatInifinity;if(d<o)return e?this._doubleZero:this._floatZero;if(e){var g=0;for(_=0;_<20;++_)g=g<<1|h[++f];for(var I=0;_<52;++_)I=I<<1|h[++f];return S=[255&I,I>>8&255,I>>16&255,I>>>24,255&(g=a<<31|2147483647&(g|=d+r<<20)),g>>8&255,g>>16&255,g>>>24]}var T=0;for(_=0;_<23;++_)T=T<<1|h[++f];var S=[255&(T=a<<31|2147483647&(T|=d+r<<23)),T>>8&255,T>>16&255,T>>>24];return S},t.ConvertArrayToNumber=function(t,n){var i=(1<<(n?11:8)-1)-1,r=0!=(128&t[n?7:3]),o=n?(127&t[7])<<4|(240&t[6])>>4:(127&t[3])<<1|(128&t[2])>>7;if(255==o)throw new e.Exception("Not a valid float/double buffer.");var s=1,a=1;if(n){var u=(15&t[6])<<28|(255&t[5])<<20|(255&t[4])<<12,c=t[3]<<24|(255&t[2])<<16|(255&t[1])<<8|255&t[0];if(!o&&!u&&!c)return 0;for(h=0;h<20;++h)a/=2,u<0&&(s+=a),u<<=1;for(h=0;h<32;++h)a/=2,c<0&&(s+=a),c<<=1}else{var l=(127&t[2])<<25|(255&t[1])<<17|(255&t[0])<<9;if(!o&&!l)return 0;for(var h=0;h<23;++h)a/=2,l<0&&(s+=a),l<<=1}return s*=Math.pow(2,o-i),r?0-s:s},t._floatZero=[0,0,0,0],t._doubleZero=[0,0,0,0,0,0,0,0],t._floatInifinity=[0,0,128,127],t._floatNegInifinity=[0,0,128,255],t._doubleInifinity=[0,0,0,0,0,0,240,127],t._doubleNegInifinity=[0,0,0,0,0,0,240,255],t}()}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){!function(e){var n=function(){function e(){this._buffer=[]}return e.prototype.WriteByte=function(e){this._buffer.push(t.Number.ToByte(e))},e.prototype.Write=function(t,e,n){for(;n--;)this.WriteByte(t[e++])},e.prototype.GetBuffer=function(){return this._buffer},e}();e.MemoryStream=n}(t.IO||(t.IO={}))}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={}));var Microsoft;!function(t){!function(t){var e=function(){return function(t,e){this.Type=t,this.Id=e}}();t.FieldTag=e;var n=function(){return function(t,e){this.ElementType=t,this.Size=e}}();t.ContainerTag=n;var i=function(){return function(t,e,n){this.KeyType=t,this.ValueType=e,this.Size=n}}();t.KeyValueContainerTag=i;var r=function(){return function(){}}();t.Bonded=r;var o=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t),this.low<0&&(this.high=-1)}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high},t}();t.Int64=o;var s=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t)}return t.prototype.Equals=function(e){var n=new t(e);return this.low==n.low&&this.high==n.high},t}();t.UInt64=s;var a=function(){function t(){}return t.ToByte=function(t){return this.ToUInt8(t)},t.ToInt8=function(t){return 127&t|(128&t)<<24>>24},t.ToInt16=function(t){return 32767&t|(32768&t)<<16>>16},t.ToInt32=function(t){return 2147483647&t|2147483648&t},t.ToUInt8=function(t){return 255&t},t.ToUInt16=function(t){return 65535&t},t.ToUInt32=function(t){return 4294967295&t},t}();t.Number=a;var u=function(){return function(t){this.Message=t}}();t.Exception=u;var c=function(){return function(){}}();t.KeyValuePair=c;var l=function(){function t(){}return t.IsDataViewSupport=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},t}();t.BrowserChecker=l}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={})),function(t){!function(t){var e=function(){function e(t){this._stream=t}return e.prototype.WriteBlob=function(t){this._stream.Write(t,0,t.length)},e.prototype.WriteBool=function(t){this._stream.WriteByte(t?1:0)},e.prototype.WriteContainerBegin=function(t,e){this.WriteUInt8(e),this.WriteUInt32(t)},e.prototype.WriteMapContainerBegin=function(t,e,n){this.WriteUInt8(e),this.WriteUInt8(n),this.WriteUInt32(t)},e.prototype.WriteContainerEnd=function(){},e.prototype.WriteDouble=function(e){var n=t.Encoding.Double.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteFloat=function(e){var n=t.Encoding.Float.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteFieldBegin=function(t,e,n){e<=5?this._stream.WriteByte(t|e<<5):e<=255?(this._stream.WriteByte(192|t),this._stream.WriteByte(e)):(this._stream.WriteByte(224|t),this._stream.WriteByte(e),this._stream.WriteByte(e>>8))},e.prototype.WriteFieldEnd=function(){},e.prototype.WriteFieldOmitted=function(t,e,n){},e.prototype.WriteInt16=function(e){e=t.Encoding.Zigzag.EncodeZigzag16(e),this.WriteUInt16(e)},e.prototype.WriteInt32=function(e){e=t.Encoding.Zigzag.EncodeZigzag32(e),this.WriteUInt32(e)},e.prototype.WriteInt64=function(e){this.WriteUInt64(t.Encoding.Zigzag.EncodeZigzag64(e))},e.prototype.WriteInt8=function(e){this._stream.WriteByte(t.Number.ToInt8(e))},e.prototype.WriteString=function(e){if(""==e)this.WriteUInt32(0);else{var n=t.Encoding.Utf8.GetBytes(e);this.WriteUInt32(n.length),this._stream.Write(n,0,n.length)}},e.prototype.WriteStructBegin=function(t,e){},e.prototype.WriteStructEnd=function(e){this.WriteUInt8(e?t.BondDataType.BT_STOP_BASE:t.BondDataType.BT_STOP)},e.prototype.WriteUInt16=function(e){var n=t.Encoding.Varint.GetBytes(t.Number.ToUInt16(e));this._stream.Write(n,0,n.length)},e.prototype.WriteUInt32=function(e){var n=t.Encoding.Varint.GetBytes(t.Number.ToUInt32(e));this._stream.Write(n,0,n.length)},e.prototype.WriteUInt64=function(e){var n=t.Encoding.Varint64.GetBytes(e);this._stream.Write(n,0,n.length)},e.prototype.WriteUInt8=function(e){this._stream.WriteByte(t.Number.ToUInt8(e))},e.prototype.WriteWString=function(t){this.WriteUInt32(t.length);for(var e=0;e<t.length;++e){var n=t.charCodeAt(e);this._stream.WriteByte(n),this._stream.WriteByte(n>>>8)}},e}();t.CompactBinaryProtocolWriter=e;var n=function(){return function(){}}();t.CompactBinaryProtocolReader=n}(t.Bond||(t.Bond={}))}(Microsoft||(Microsoft={}));var sct;!function(t){var e=function(){function t(){}return t.IsSafariOrFirefox=function(){return null===t._isSafariOrFirefox&&t._DetectBrowser(),t._isSafariOrFirefox},t.ajax=function(e){var n=t._createConnection();if(e.headers){var i="qsp=true";for(var r in e.headers)i+="&",i+=encodeURIComponent(r),i+="=",i+=encodeURIComponent(e.headers[r]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=i}n.open(e.type,e.url),e.complete&&(n.onload=function(){void 0===n.status&&(n.status=200),e.complete(n)},n.ontimeout=function(){void 0===n.status&&(n.status=500),e.complete(n)},n.onerror=function(){e.complete(n)}),n.send(e.data)},t.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},t.IsUsingXDomainRequest=function(){if(null==t._usingXDomainRequest){var e=new XMLHttpRequest;t._usingXDomainRequest=void 0===e.withCredentials&&"undefined"!=typeof XDomainRequest}return t._usingXDomainRequest},t._createConnection=function(){var e=new XMLHttpRequest;return t.IsUsingXDomainRequest()?new XDomainRequest:e},t._DetectBrowser=function(){var e=navigator.userAgent.toLowerCase();t._isSafariOrFirefox=(e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0},t._isSafariOrFirefox=null,t._usingXDomainRequest=null,t}();t.Utils=e}(sct||(sct={}));var microsoft;!function(t){!function(t){!function(t){!function(e){var n=function(){function t(){}return t.GetGuid=function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1,5)};return[t(),t(),"-",t(),"-",t(),"-",t(),"-",t(),t(),t()].join("")},t.GetTimeStamp=function(){var t=(new Date).getTime(),e=new Microsoft.Bond.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},t.GetTimeStampWithValue=function(t){var e=new Microsoft.Bond.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},t}();e.utils=n;!function(t){t[t.NotSet=0]="NotSet",t[t.Event=1]="Event",t[t.PerformanceCounter=2]="PerformanceCounter",t[t.Anomaly=3]="Anomaly",t[t.Prediction=4]="Prediction",t[t.TraceLog=5]="TraceLog",t[t.EventSourceLog=6]="EventSourceLog",t[t.HttpLog=7]="HttpLog",t[t.PerformanceCounterAzure=8]="PerformanceCounterAzure",t[t.PerformanceCounterGfs=9]="PerformanceCounterGfs"}(e.RecordType||(e.RecordType={}));!function(t){t[t.NotSet=0]="NotSet",t[t.O365=1]="O365",t[t.SkypeBI=2]="SkypeBI",t[t.SkypeData=3]="SkypeData"}(e.PIIScrubber||(e.PIIScrubber={}));!function(t){t[t.NotSet=0]="NotSet",t[t.DistinguishedName=1]="DistinguishedName",t[t.GenericData=2]="GenericData",t[t.IPV4Address=3]="IPV4Address",t[t.IPv6Address=4]="IPv6Address",t[t.MailSubject=5]="MailSubject",t[t.PhoneNumber=6]="PhoneNumber",t[t.QueryString=7]="QueryString",t[t.SipAddress=8]="SipAddress",t[t.SmtpAddress=9]="SmtpAddress",t[t.Identity=10]="Identity",t[t.Uri=11]="Uri",t[t.Fqdn=12]="Fqdn",t[t.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(e.PIIKind||(e.PIIKind={}));var i=function(){function e(){this.ScrubType=t.datamodels.PIIScrubber.NotSet,this.Kind=t.datamodels.PIIKind.NotSet,this.RawContent=""}return e.prototype.Write=function(t){this.WriteImpl(t,!1)},e.prototype.WriteImpl=function(e,n){e.WriteStructBegin(null,n),this.ScrubType!=t.datamodels.PIIScrubber.NotSet?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,1,null),e.WriteInt32(this.ScrubType),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,1,null),this.Kind!=t.datamodels.PIIKind.NotSet?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),e.WriteInt32(this.Kind),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null),""!=this.RawContent?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,3,null),e.WriteString(this.RawContent),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,3,null),e.WriteStructEnd(n)},e.prototype.Read=function(t){this.ReadImpl(t,!1)},e.prototype.ReadImpl=function(t,e){},e}();e.PII=i;var r=function(){function e(){this.Id=n.GetGuid(),this.Timestamp=n.GetTimeStamp(),this.Type="",this.EventType="",this.Extension=new Microsoft.Bond.Collections.Map,this.RecordType=t.datamodels.RecordType.NotSet,this.PIIExtensions=new Microsoft.Bond.Collections.Map}return e.prototype.AddOrReplacePII=function(e,n,i){var r=new t.datamodels.PII;r.RawContent=n,r.Kind=i,r.ScrubType=t.datamodels.PIIScrubber.O365,this.PIIExtensions.AddOrReplace(e,r)},e.prototype.Write=function(t){this.WriteImpl(t,!1)},e.prototype.WriteImpl=function(e,n){if(e.WriteStructBegin(null,n),""!=this.Id?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,1,null),e.WriteString(this.Id),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,3,null):(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,3,null),e.WriteInt64(this.Timestamp),e.WriteFieldEnd()),""!=this.Type?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),e.WriteString(this.Type),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),""!=this.EventType?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,6,null),e.WriteString(this.EventType),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,6,null),this.Extension.Count()){e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,13,null),e.WriteMapContainerBegin(this.Extension.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRING);for(var i=0;i<this.Extension.GetBuffer().length;++i)e.WriteString(this.Extension.GetBuffer()[i].Key),e.WriteString(this.Extension.GetBuffer()[i].Value);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,13,null);if(this.RecordType!=t.datamodels.RecordType.NotSet?(e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,24,null),e.WriteInt32(this.RecordType),e.WriteFieldEnd()):e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,24,null),this.PIIExtensions.Count()){e.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_MAP,30,null),e.WriteMapContainerBegin(this.PIIExtensions.Count(),Microsoft.Bond.BondDataType.BT_STRING,Microsoft.Bond.BondDataType.BT_STRUCT);for(var r=0;r<this.PIIExtensions.GetBuffer().length;++r)e.WriteString(this.PIIExtensions.GetBuffer()[r].Key),this.PIIExtensions.GetBuffer()[r].Value.WriteImpl(e,!1);e.WriteContainerEnd(),e.WriteFieldEnd()}else e.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_MAP,30,null);e.WriteStructEnd(n)},e.prototype.Read=function(t){this.ReadImpl(t,!1)},e.prototype.ReadImpl=function(t,e){},e}();e.Record=r;var o=function(){function t(){this.Source="",this.DataPackageId="",this.Timestamp=new Microsoft.Bond.Int64("0"),this.Records=[]}return t.prototype.Write=function(t){this.WriteImpl(t,!1)},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),""!=this.Source?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,2,null),t.WriteString(this.Source),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,2,null),""!=this.DataPackageId?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_STRING,5,null),t.WriteString(this.DataPackageId),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_STRING,5,null),this.Timestamp.Equals("0")?t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT64,6,null):(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT64,6,null),t.WriteInt64(this.Timestamp),t.WriteFieldEnd()),this.Records.length){t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,8,null),t.WriteContainerBegin(this.Records.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.Records.length;++n)this.Records[n].WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,8,null);t.WriteStructEnd(e)},t.prototype.Read=function(t){this.ReadImpl(t,!1)},t.prototype.ReadImpl=function(t,e){},t}();e.DataPackage=o;var s=function(){function t(){this.DataPackages=[],this.RequestRetryCount=0}return t.prototype.Write=function(t){this.WriteImpl(t,!1)},t.prototype.WriteImpl=function(t,e){if(t.WriteStructBegin(null,e),this.DataPackages.length){t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_LIST,1,null),t.WriteContainerBegin(this.DataPackages.length,Microsoft.Bond.BondDataType.BT_STRUCT);for(var n=0;n<this.DataPackages.length;++n)this.DataPackages[n].WriteImpl(t,!1);t.WriteContainerEnd(),t.WriteFieldEnd()}else t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_LIST,1,null);0!=this.RequestRetryCount?(t.WriteFieldBegin(Microsoft.Bond.BondDataType.BT_INT32,2,null),t.WriteInt32(this.RequestRetryCount),t.WriteFieldEnd()):t.WriteFieldOmitted(Microsoft.Bond.BondDataType.BT_INT32,2,null),t.WriteStructEnd(e)},t.prototype.Read=function(t){this.ReadImpl(t,!1)},t.prototype.ReadImpl=function(t,e){},t}();e.ClientToCollectorRequest=s}(t.datamodels||(t.datamodels={}))}(t.telemetry||(t.telemetry={}))}(t.applications||(t.applications={}))}(microsoft||(microsoft={}));var microsoft;!function(t){!function(t){!function(t){!function(e){var n;!function(t){t[t.SENT=0]="SENT",t[t.SEND_FAILED=1]="SEND_FAILED"}(n=e.CallbackEventType||(e.CallbackEventType={}));var i;!function(t){t[t.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",t[t.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",t[t.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",t[t.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",t[t.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",t[t.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(i=e.DATARV_ERROR||(e.DATARV_ERROR={}));var r=function(){function t(t){this._errorCode=i.DATARV_ERROR_OK,this._errorCode=t}return t.prototype.ErrorCode=function(){return this._errorCode},t.prototype.toString=function(){switch(this._errorCode){case i.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case i.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case i.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case i.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case i.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case i.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}},t}();e.Exception=r;var o=function(){return function(){}}();e.TelemetryConfig=o;var s=function(){function t(){}return t.CreateTelemetryManager=function(){return new c},t}();e.TelemetryManagerFactory=s;var a,u=function(){function t(){}return t.MaxPackageSizeInBytes=3e6,t.TimeIntervalForNextSendInMS=15e3,t}();!function(t){t[t.Created=0]="Created",t[t.Initialized=1]="Initialized",t[t.Started=2]="Started"}(a||(a={}));var c=function(){function e(){this._MaxPackageSizeInBytes=u.MaxPackageSizeInBytes,this._listeners=[],this._status=a.Created,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null,this._testHookListeners=[]}return e.prototype.Initialize=function(t){if(this._status!=a.Created)throw new r(i.DATARV_ERROR_INVALID_STATUS);if(!t||!t.collectorUrl)throw new r(i.DATARV_ERROR_INVALID_CONFIG);this._config=t,this._Reset(),this._status=a.Initialized,t.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=t.ecsClient),t.overwriteSendTimeInterval&&t.overwriteSendTimeInterval>=0&&(u.TimeIntervalForNextSendInMS=t.overwriteSendTimeInterval),this._Verbose("Initialize() done")},e.prototype.AddListener=function(t){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return void this._Verbose("the listener has been added already, index: "+e);this._listeners.push(t),this._Verbose("AddListener() done, the new length: "+this._listeners.length)},e.prototype.RemoveListener=function(t){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",t].join(""));for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return 1==this._listeners.length?this._listeners=[]:e==this._listeners.length-1?this._listeners.pop():this._listeners[e]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",e,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)},e.prototype.Start=function(){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",e._tag].join(" ")),this._status>=a.Started&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++e._tag,this._status=a.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",e._tag].join(""))},e.prototype.Stop=function(){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);this._Verbose("Stop(), status: "+this._status),this._status!=a.Initialized?(this._Reset(),this._status=a.Initialized,this._Verbose("Stop() done, status: "+this._status)):this._Verbose("Stop() already, ignore")},e.prototype.Flush=function(t){this._eventsCache.IsEmpty()||this._WorkThread(t)},e.prototype.SendAsync=function(t,n){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",t,"count:",n.length].join(" ")),this._status<a.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!t||!n)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new r(i.DATARV_ERROR_INVALID_ARG);for(var o=0;o<n.length;++o)if(!n[o].Id||!e._eventTypeRegex.test(n[o].EventType)||n[o].Timestamp.Equals("0"))throw this._Error(["eventId:",n[o].Id,"eventType:",n[o].EventType,"timestamp high:",n[o].Timestamp.high,"timestamp low:",n[o].Timestamp.low].join("")),new r(i.DATARV_ERROR_INVALID_EVENT);return this._eventsCache.AddEvents(t,n),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0},e.prototype._WorkThread=function(t){var n=this;try{var i=Date.now();if(this._Verbose("_WorkThread, status: "+this._status),this._status<a.Started)return void this._Verbose("_WorkThread, status is not started, return");var r=this._eventsCache.DequeuEvents();if(null==r)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var o=r.events.length,s=this._PackEvents(r.tenantToken,r.events);this._eventsCache.AddEvents(r.tenantToken,s.remainedEvents);var u=s.remainedEvents.length;if(null==s.buffer||0==s.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testHookListeners)for(var c=0;c<this._testHookListeners.length;++c)this._testHookListeners[c](s.sendEvents);if(this._testServerResponseHook){var l=this._testServerResponseHook();return void setTimeout(this._SendCallback(_,r.tenantToken,s.sendEvents,l,null),100)}var h={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+clienttelemetry_build.version},complete:function(e){return n._SendCallback(_,r.tenantToken,s.sendEvents,e,t)}};this._config.useJsonTextStream?(h.data=s.buffer,h.headers["content-type"]="application/json"):sct.Utils.IsSafariOrFirefox()||"undefined"==typeof Uint8Array?(this._Verbose("Uint8Array is undefined, send with base64 encode."),h.data=Microsoft.Bond.Encoding.Base64.GetString(s.buffer),h.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),h.data=new Uint8Array(s.buffer)),r.tenantToken&&(h.headers["x-apikey"]=r.tenantToken);var _=e._tag;this._lastActiveTime=(new Date).getTime(),sct.Utils.ajax(h),this._Verbose("_Workthread, send via jquery, tag: "+_),this._Info("Processing telemetry events took "+(Date.now()-i)+" ms for "+(o-u)+" events with total size of "+s.buffer.length+" bytes, remaining events - "+u)}catch(t){this._Error("_WorkThread, exception: "+t)}},e.prototype._PackEvents=function(e,n){this._Verbose("_PackageEvents, total Count: "+n.length);var i=new t.datamodels.ClientToCollectorRequest,r=new t.datamodels.DataPackage;r.Source="JS_default_source",r.DataPackageId=t.datamodels.utils.GetGuid(),r.Timestamp=t.datamodels.utils.GetTimeStamp();var o,s=n;if(n=[],s.length>200){var a=s.splice(0,200);n.push.apply(n,s),s=a}for(;;){if(r.Records=[],r.Records.push.apply(r.Records,s),i.DataPackages=[],i.DataPackages.push(r),o=this._Serialize(i),this._Verbose(["_PackageEvents, sendEvents.length:",s.length," buffer.length:",o.length," MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),o.length<this._MaxPackageSizeInBytes)break;if(1==s.length){s=[],o=null;break}var u=s.splice(0,Math.floor(s.length/2));this._Verbose("_PackageEvents, too large, package again"),n.push.apply(n,s),s=u}return this._Verbose(["_PakcageEvents done, sendEventsCount:",s.length,"buffer.length:",null==o?0:o.length,"remained events:",n.length].join("")),{buffer:o,sendEvents:s,remainedEvents:n}},e.prototype._Serialize=function(e){if(this._config.useJsonTextStream){var n=new t.JsonTextWriter;return e.Write(n),JSON.stringify(n.data)}var i=new Microsoft.Bond.IO.MemoryStream,r=new Microsoft.Bond.CompactBinaryProtocolWriter(i);return e.Write(r),i.GetBuffer()},e.prototype._SendCallback=function(t,i,r,o,s){if(this._Verbose(["_SendCallback","tag:",t,"current tag:",e._tag,"tenantToken:",i,"events count:",r.length,"jqXHR:",o].join("")),null==s){var u=null!=o&&o.status>=200&&o.status<300;if(this._status<a.Started||t<e._tag)this._Verbose("_SendCallback, is not started, or tag is not the same, return");else{if(!(u||o&&400==o.status))return this._Verbose("retry statusCode: "+(o?o.status:0)),this._eventsCache.AddEvents(i,r),void this._ScheduleTimer(!0);for(var c=0;c<this._listeners.length;++c)this._listeners[c](u?n.SENT:n.SEND_FAILED,o?o.status:0,i,r);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}}else s(o?o.status:0,i,r)},e.prototype._CleanTimer=function(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)},e.prototype._ScheduleTimer=function(t){var e=this;if(this._Verbose("_ScheduleTimer: isRetry: "+t),this._CleanTimer(),t){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);n=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(function(){return e._WorkThread(null)},1e3*n),this._Verbose("_ScheduleTimer, next try (s): "+n),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var n=0,i=(new Date).getTime()-this._lastActiveTime;n=i>u.TimeIntervalForNextSendInMS?0:u.TimeIntervalForNextSendInMS-i,this._timer=setTimeout(function(){return e._WorkThread(null)},n),this._Verbose("_ScheduleTimer, next try: "+n),this._rescheduleFactor=1}},e.prototype._Verbose=function(t){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+t)},e.prototype._Info=function(t){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+t)},e.prototype._Error=function(t){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+t)},e.prototype._Reset=function(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new l,this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)},e.prototype._CreateEcsCallback=function(){var t=this;return function(e){e==ecs.CallbackEventType.CONFIG_UPDATED&&(t._etag=t._ecsClient.GetETag())}},e.prototype.__AddTestHookListener=function(t){if(this._status<a.Initialized)throw new r(i.DATARV_ERROR_INVALID_STATUS);for(var e=0;e<this._testHookListeners.length;++e)if(this._testHookListeners[e]==t)return;this._testHookListeners.push(t)},e.prototype.__ClearTestHookListener=function(){this._testHookListeners=[]},e.prototype.__GetListenerArray=function(){return this._listeners},e.prototype.__GetTotalEventsCount=function(){return this._eventsCache.GetTotalEventsCount()},e.prototype.__IsScheduled=function(){return null!=this._timer},e.prototype.__ChageMaxPackageSizeInKB=function(t){this._MaxPackageSizeInBytes=1024*t},e.prototype.__SetTestServerResponseHook=function(t){this._testServerResponseHook=t},e._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,e._tag=0,e}();e.TelemetryManagerImpl=c;var l=function(){function t(){this._events={},this._tokens=[]}return t.prototype.AddEvents=function(t,e){e.length&&(e.length>1e4||(this._events[t]||(this._events[t]=[],this._tokens.push(t)),this._events[t].push.apply(this._events[t],e)))},t.prototype.IsEmpty=function(){return 0==this._tokens.length},t.prototype.DequeuEvents=function(){if(0==this._tokens.length)return null;var t=this._tokens.shift(),e=this._events[t];return delete this._events[t],{tenantToken:t,events:e}},t.prototype.GetTotalEventsCount=function(){var t=0;for(var e in this._events)t+=this._events[e].length;return t},t}()}(t._sender||(t._sender={}))}(t.telemetry||(t.telemetry={}))}(t.applications||(t.applications={}))}(microsoft||(microsoft={}));var clienttelemetry_build;!function(t){t.version="2.5.0"}(clienttelemetry_build||(clienttelemetry_build={}));var microsoft;!function(t){!function(t){!function(t){t.globalTelemetryManager=null;var e=function(){return function(){this.collectorUrl=null}}();t.LogConfiguration=e;var n=function(){function e(){this.key=null,this.value=null,this.pii=null}return e._isPii=function(e){if(e==t.datamodels.PIIKind.NotSet)return!1;var n=!1;for(var i in t.datamodels.PIIKind)isNaN(i)||i==e&&(n=!0);return n},e}();t.Property=n;var i=function(){function e(){this.name=null,this.timestamp=null,this.properties=[],this.eventType=null}return e.prototype.setProperty=function(n,i,s){if(!n||!this.properties[n]&&!e._propertyNameRegex.test(n))throw new o(r.INVALID_PROPERTY_NAME);this.properties[n]={key:n,value:i,pii:s!=t.datamodels.PIIKind.NotSet?s:null}},e.prototype.unsetProperty=function(t){if(!t)throw new o(r.INVALID_PROPERTY_NAME);void 0!==this.properties[t]&&(this.properties[t]=void 0,delete this.properties[t])},e._propertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_|.]){0,98}[a-zA-Z0-9])?$/,e}();t.EventProperties=i;var r;!function(t){t[t.INVALID_TENANT_TOKEN=1]="INVALID_TENANT_TOKEN",t[t.MISSING_EVENT_PROPERTIES_NAME=2]="MISSING_EVENT_PROPERTIES_NAME",t[t.INVALID_PROPERTY_NAME=3]="INVALID_PROPERTY_NAME",t[t.INVALID_COLLECTOR_URL=4]="INVALID_COLLECTOR_URL",t[t.MISSING_FAILURE_SIGNATURE=5]="MISSING_FAILURE_SIGNATURE",t[t.MISSING_FAILURE_DETAIL=6]="MISSING_FAILURE_DETAIL",t[t.MISSING_PAGEVIEW_ID=7]="MISSING_PAGEVIEW_ID",t[t.MISSING_PAGEVIEW_NAME=8]="MISSING_PAGEVIEW_NAME",t[t.INVALID_SESSION_STATE=9]="INVALID_SESSION_STATE"}(r=t.TelemetryError||(t.TelemetryError={}));var o=function(){function t(t){this.errorCode=null,this.errorCode=t}return t.prototype.ErrorCode=function(){return this.errorCode},t.prototype.toString=function(){switch(this.errorCode){case r.INVALID_TENANT_TOKEN:return"Invalid tenant token";case r.MISSING_EVENT_PROPERTIES_NAME:return"Eventproperties.name can not be null or empty";case r.INVALID_PROPERTY_NAME:return"Invalid Key. Key does not conform to regular expression ^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$";case r.INVALID_COLLECTOR_URL:return"Collector url can't be null or empty.";case r.MISSING_FAILURE_SIGNATURE:return"Failure signature can't be null or empty.";case r.MISSING_FAILURE_DETAIL:return"Failure detail can't be null or empty.";case r.MISSING_PAGEVIEW_ID:return"Pageview id can't be null or empty.";case r.MISSING_PAGEVIEW_NAME:return"Pageview name can't be null or empty.";case r.INVALID_SESSION_STATE:return"Session state has to be a value from the SessionState enum.";default:return"Unknown error"}},t}();t.Exception=o;var s=function(){function e(e){this.contextMap=new Microsoft.Bond.Collections.Map,this.piiKind=t.datamodels.PIIKind.NotSet,this._allowDeviceInfoFields=!1,this._allowDeviceInfoFields=e}return e.prototype.setAppId=function(t){t&&this.contextMap.Add("AppInfo.Id",t)},e.prototype.setAppVersion=function(t){t&&this.contextMap.Add("AppInfo.Version",t)},e.prototype.setAppLanguage=function(t){t&&this.contextMap.Add("AppInfo.Language",t)},e.prototype.setDeviceId=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.Id",t)},e.prototype.setDeviceOsName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsName",t)},e.prototype.setDeviceOsVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.OsVersion",t)},e.prototype.setDeviceBrowserName=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserName",t)},e.prototype.setDeviceBrowserVersion=function(t){t&&this._allowDeviceInfoFields&&this.contextMap.Add("DeviceInfo.BrowserVersion",t)},e.prototype.setUserId=function(t,e){t&&this.contextMap.Add("UserInfo.Id",t),n._isPii(e)&&(this.piiKind=e)},e.prototype.setUserMsaId=function(t){t&&this.contextMap.Add("UserInfo.MsaId",t)},e.prototype.setUserANID=function(t){t&&this.contextMap.Add("UserInfo.ANID",t)},e.prototype.setUserAdvertisingId=function(t){t&&this.contextMap.Add("UserInfo.AdvertisingId",t)},e.prototype.setUserTimeZone=function(t){t&&this.contextMap.Add("UserInfo.TimeZone",t)},e.prototype.setUserLanguage=function(t){t&&this.contextMap.Add("UserInfo.Language",t)},e}();t.SemanticContext=s;var a,u=function(){function t(){}return t.initialize=function(e){t.documentInfo=e;var n=e.appLanguage;n&&t.semanticContext.setAppLanguage(n);var i=e.userLanguage;i&&t.semanticContext.setUserLanguage(i);var r=(new Date).getTimezoneOffset(),o=r%60,s=(r-o)/60,a="+";s>0&&(a="-"),o=Math.abs(o);var u=a+((s=Math.abs(s))<10?"0"+s:s.toString())+":"+(o<10?"0"+o:o.toString());t.semanticContext.setUserTimeZone(u),t.semanticContext.setDeviceBrowserName(t._getBrowserName()),t.semanticContext.setDeviceBrowserVersion(t._getBrowserVersion()),t.semanticContext.setDeviceOsName(t._getOsName()),t.semanticContext.setDeviceOsVersion(t._getOsVersion()),t.semanticContext.setDeviceId(e.deviceId),t.firstLaunchTime=e.firstLaunchTime},t.checkAndUpdateDeviceId=function(t){},t._setCookie=function(t,e){},t._getCookie=function(t){return""},t._getUserAgent=function(){return t.documentInfo.userAgent},t._userAgentContainsString=function(e){return t._getUserAgent().indexOf(e)>-1},t._isIe=function(){return t._userAgentContainsString("Trident")},t._isEdge=function(){return t._userAgentContainsString(t.BROWSERS.EDGE)},t._isOpera=function(){return t._userAgentContainsString("OPR/")},t._getBrowserName=function(){return t._isOpera()?t.BROWSERS.UNKNOWN:t._userAgentContainsString(t.BROWSERS.PHANTOMJS)?t.BROWSERS.PHANTOMJS:t._isEdge()?t.BROWSERS.EDGE:t._userAgentContainsString(t.BROWSERS.ELECTRON)?t.BROWSERS.ELECTRON:t._userAgentContainsString(t.BROWSERS.CHROME)?t.BROWSERS.CHROME:t._userAgentContainsString(t.BROWSERS.FIREFOX)?t.BROWSERS.FIREFOX:t._userAgentContainsString(t.BROWSERS.SAFARI)?t.BROWSERS.SAFARI:t._userAgentContainsString(t.BROWSERS.SKYPE_SHELL)?t.BROWSERS.SKYPE_SHELL:t._isIe()?t.BROWSERS.MSIE:t.BROWSERS.UNKNOWN},t._getBrowserVersion=function(){return t._isIe()?function(){var e,n=t._getUserAgent(),i=n.match(new RegExp(t.BROWSERS.MSIE+" "+t.REGEX_VERSION));return i?i[1]:(e=n.match(new RegExp("rv:"+t.REGEX_VERSION)))?e[1]:void 0}():function(e){var n;return e===t.BROWSERS.SAFARI&&(e="Version"),(n=t._getUserAgent().match(new RegExp(e+"/"+t.REGEX_VERSION)))?n[1]:t.UNKNOWN_VERSION}(t._getBrowserName())},t._getOsName=function(){var e=/(windows|win32)/i,n=/ arm;/i,i=/windows\sphone\s\d+\.\d+/i,r=/(macintosh|mac os x)/i,o=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,s=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,a=/android/i;return t._getUserAgent().match(i)?t.OPERATING_SYSTEMS.WINDOWS_PHONE:t._getUserAgent().match(n)?t.OPERATING_SYSTEMS.WINDOWS_RT:t._getUserAgent().match(o)?t.OPERATING_SYSTEMS.IOS:t._getUserAgent().match(a)?t.OPERATING_SYSTEMS.ANDROID:t._getUserAgent().match(s)?t.OPERATING_SYSTEMS.LINUX:t._getUserAgent().match(r)?t.OPERATING_SYSTEMS.MACOSX:t._getUserAgent().match(e)?t.OPERATING_SYSTEMS.WINDOWS:t.OPERATING_SYSTEMS.UNKNOWN},t._getOsVersion=function(){function e(t){return t.indexOf(".")>-1?".":t.indexOf("_")>-1?"_":null}return t._getOsName()===t.OPERATING_SYSTEMS.WINDOWS?function(){var e=t._getUserAgent().match(new RegExp("Windows NT "+t.REGEX_VERSION));return e&&t.VERSION_MAPPINGS[e[1]]?t.VERSION_MAPPINGS[e[1]]:t.UNKNOWN_VERSION}():t._getOsName()===t.OPERATING_SYSTEMS.MACOSX?function(){var n=t._getUserAgent().match(new RegExp(t.OPERATING_SYSTEMS.MACOSX+" "+t.REGEX_VERSION_MAC));if(n){var i=n[1].replace(/_/g,".");if(i){var r=e(i);return r?i.split(r)[0]:i}}return t.UNKNOWN_VERSION}():t.UNKNOWN_VERSION},t.semanticContext=new s(!0),t.firstLaunchTime=-1,t.BROWSERS={MSIE:"MSIE",CHROME:"Chrome",FIREFOX:"Firefox",SAFARI:"Safari",EDGE:"Edge",ELECTRON:"Electron",SKYPE_SHELL:"SkypeShell",PHANTOMJS:"PhantomJS",UNKNOWN:"Unknown"},t.OPERATING_SYSTEMS={WINDOWS:"Windows",MACOSX:"Mac OS X",WINDOWS_PHONE:"Windows Phone",WINDOWS_RT:"Windows RT",IOS:"iOS",ANDROID:"Android",LINUX:"Linux",UNKNOWN:"Unknown"},t.VERSION_MAPPINGS={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},t.REGEX_VERSION="([\\d,.]+)",t.REGEX_VERSION_MAC="([\\d,_,.]+)",t.UNKNOWN_VERSION="Unknown",t.DEVICE_ID_COOKIE="MicrosoftApplicationsTelemetryDeviceId",t.FIRST_LAUNCH_TIME_COOKIE="MicrosoftApplicationsTelemetryFirstLaunchTime",t}();!function(t){t[t.STARTED=0]="STARTED",t[t.ENDED=1]="ENDED"}(a=t.SessionState||(t.SessionState={}));var c=function(){function e(){}return e.initialize=function(n,i){if(!e._initialized){if(!i)throw new o(r.INVALID_TENANT_TOKEN);e._defaultToken=i,e._config.collectorUrl||(e._config.collectorUrl="https://browser.pipe.aria.microsoft.com/Collector/3.0/"),t.globalTelemetryManager||(t.globalTelemetryManager=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),t.globalTelemetryManager.Initialize(e._config)),t.globalTelemetryManager.Start(),u.initialize(n),e._initialized=!0}},e.initializeWithConfiguration=function(t,n,i){if(!i.collectorUrl)throw new o(r.INVALID_COLLECTOR_URL);e._config.collectorUrl=i.collectorUrl,e.initialize(t,n)},e.flush=function(e){t.globalTelemetryManager.Flush(e)},e.addCallbackListener=function(n){e._initialized&&t.globalTelemetryManager.AddListener(n)},e.setContext=function(t,n,i){""!==n&&"null"!==n&&"undefined"!==n?e._contextProperties.setProperty(t,n,i):e._contextProperties.unsetProperty(t)},e.isInitialized=function(){return e._initialized},e.getDefaultToken=function(){return e._defaultToken},e.getSemanticContext=function(){return e._semanticContext},e.__addTestHookListener=function(n){e._initialized&&t.globalTelemetryManager.__AddTestHookListener(n)},e.__clearTestHookListener=function(){e._initialized&&t.globalTelemetryManager.__ClearTestHookListener()},e.__backToUninitialized=function(){e._config=new t._sender.TelemetryConfig,e._semanticContext=new s(!0),e._contextProperties=new i,t.globalTelemetryManager=t._sender.TelemetryManagerFactory.CreateTelemetryManager(),e._initialized=!1},e._initialized=!1,e._defaultToken=null,e._config=new t._sender.TelemetryConfig,e._contextProperties=new i,e._semanticContext=new s(!0),e}();t.LogManager=c;var l=function(){function e(e){this._initId=t.datamodels.utils.GetGuid(),this._sequence=0,this._tenantToken=null,this._contextProperties=new i,this._semanticContext=new s(!1),this._sessionStartTime=0,this._sessionId=null,this._tenantToken=e||c.getDefaultToken()}return e.prototype.logEvent=function(t){if(!t.name)throw new o(r.MISSING_EVENT_PROPERTIES_NAME);var e=this._createEventRecord(t.name,t.eventType);this._addCustomPropertiesToEvent(e,t),this._sendRecord(e)},e.prototype.logFailure=function(t,e,n,i,s){if(!t)throw new o(r.MISSING_FAILURE_SIGNATURE);if(!e)throw new o(r.MISSING_FAILURE_DETAIL);var a=this._createEventRecord("failure","failure");a.Extension.Add("Failure.Signature",t),a.Extension.Add("Failure.Detail",e),n&&a.Extension.Add("Failure.Category",n),i&&a.Extension.Add("Failure.Id",i),this._addCustomPropertiesToEvent(a,s),this._sendRecord(a)},e.prototype.logPageView=function(t,e,n,i,s,a){if(!t)throw new o(r.MISSING_PAGEVIEW_ID);if(!e)throw new o(r.MISSING_PAGEVIEW_NAME);var u=this._createEventRecord("pageview","pageview");u.Extension.Add("PageView.Id",t),u.Extension.Add("PageView.Name",e),n&&u.Extension.Add("PageView.Category",n),i&&u.Extension.Add("PageView.Uri",i),s&&u.Extension.Add("PageView.ReferrerUri",s),this._addCustomPropertiesToEvent(u,a),this._sendRecord(u)},e.prototype.logSession=function(e,n){if(e!==a.STARTED&&e!==a.ENDED)throw new o(r.INVALID_SESSION_STATE);var i=this._createEventRecord("session","session");if(e===a.STARTED){if(this._sessionStartTime>0)return;this._sessionStartTime=(new Date).getTime(),this._sessionId=t.datamodels.utils.GetGuid(),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Started")}else if(e===a.ENDED){if(0==this._sessionStartTime)return;var s=Math.floor(((new Date).getTime()-this._sessionStartTime)/1e3);i.Extension.Add("Session.Duration",s.toString()),i.Extension.Add("Session.DurationBucket",this._getSessionDurationFromTime(s)),i.Extension.Add("Session.Id",this._sessionId),i.Extension.Add("Session.State","Ended"),this._sessionId=null,this._sessionStartTime=0}i.Extension.Add("Session.FirstLaunchTime",new Date(u.firstLaunchTime).toISOString()),this._addCustomPropertiesToEvent(i,n),this._sendRecord(i)},e.prototype.getSessionId=function(){return this._sessionId},e.prototype.setContext=function(t,e,n){this._contextProperties.setProperty(t,e,n)},e.prototype.getSemanticContext=function(){return this._semanticContext},e.prototype._getSessionDurationFromTime=function(t){return t<0?"Undefined":t<=3?"UpTo3Sec":t<=10?"UpTo10Sec":t<=30?"UpTo30Sec":t<=60?"UpTo60Sec":t<=180?"UpTo3Min":t<=600?"UpTo10Min":t<=1800?"UpTo30Min":"Above30Min"},e.prototype._createEventRecord=function(e,n){var i=new t.datamodels.Record;n||(n="custom"),i.EventType=e.toLowerCase(),i.Type=n.toLowerCase(),i.Extension.Add("EventInfo.Source","JS_default_source"),i.Extension.Add("EventInfo.InitId",this._initId),this._sequence++,i.Extension.Add("EventInfo.Sequence",this._sequence.toString()),i.Extension.Add("EventInfo.Name",e.toLowerCase());var r=new Date;return i.Timestamp=t.datamodels.utils.GetTimeStampWithValue(r.getTime()),i.Extension.Add("EventInfo.Time",r.toISOString()),i.Extension.Add("EventInfo.SdkVersion","ACT-Web-JS-"+clienttelemetry_build.version),i},e.prototype._addCustomPropertiesToEvent=function(t,e){this._addSemanticContext(t,u.semanticContext),this._addSemanticContext(t,c._semanticContext),this._addSemanticContext(t,this._semanticContext),this._sessionId&&t.Extension.Add("Session.Id",this._sessionId),this._addEventPropertiesToEvent(t,c._contextProperties),this._addEventPropertiesToEvent(t,this._contextProperties),this._addEventPropertiesToEvent(t,e)},e.prototype._addSemanticContext=function(e,n){if(n&&n.contextMap.Count()>0)for(var i=n.contextMap.GetBuffer(),r=0;r<i.length;r++)"UserInfo.Id"==i[r].Key&&n.piiKind!=t.datamodels.PIIKind.NotSet?e.AddOrReplacePII(i[r].Key,i[r].Value,n.piiKind):e.Extension.AddOrReplace(i[r].Key,i[r].Value)},e.prototype._addEventPropertiesToEvent=function(e,i){if(i){i.timestamp&&i.timestamp>=new Date("1/1/2000").getTime()&&(e.Timestamp=t.datamodels.utils.GetTimeStampWithValue(i.timestamp),e.Extension.AddOrReplace("EventInfo.Time",new Date(i.timestamp).toISOString())),i.name&&(e.EventType=i.name.toLowerCase(),e.Extension.AddOrReplace("EventInfo.Name",i.name.toLowerCase()));var r=i.properties;if(r)for(var o in r)r[o].key&&"string"==typeof r[o].key&&(r[o].value||0==r[o].value||0==r[o].value||""==r[o].value)&&(n._isPii(r[o].pii)?(e.AddOrReplacePII(r[o].key,r[o].value.toString(),r[o].pii),e.Extension.Remove(r[o].key)):(e.Extension.AddOrReplace(r[o].key,r[o].value.toString()),e.PIIExtensions.Remove(r[o].key)))}},e.prototype._sendRecord=function(e){c.isInitialized()&&t.globalTelemetryManager.SendAsync(this._tenantToken,[e])},e}();t.Logger=l}(t.telemetry||(t.telemetry={}))}(t.applications||(t.applications={}))}(microsoft||(microsoft={}));var ecs;!function(t){var e;!function(t){t[t.ECS_ERROR_OK=0]="ECS_ERROR_OK",t[t.ECS_ERROR_INVALID_STATUS=1]="ECS_ERROR_INVALID_STATUS",t[t.ECS_ERROR_INVALID_RESPONSE=6]="ECS_ERROR_INVALID_RESPONSE",t[t.ECS_ERROR_INVALID_CONFIG=8]="ECS_ERROR_INVALID_CONFIG"}(e=t.ECS_ERROR||(t.ECS_ERROR={}));var n=function(){function t(t){this._errorCode=t}return t.prototype.ErrorCode=function(){return this._errorCode},t.prototype.toString=function(){switch(this._errorCode){case e.ECS_ERROR_OK:return"ECS_ERROR_OK";case e.ECS_ERROR_INVALID_STATUS:return"ECS_ERROR_INVALID_STATUS";case e.ECS_ERROR_INVALID_RESPONSE:return"ECS_ERROR_INVALID_RESPONSE";case e.ECS_ERROR_INVALID_CONFIG:return"ECS_ERROR_INVALID_CONFIG";default:return"Unknown error"}},t}();t.Exception=n;var i;!function(t){t[t.CONFIG_UPDATED=0]="CONFIG_UPDATED",t[t.TOKEN_IS_INVALID=1]="TOKEN_IS_INVALID"}(i=t.CallbackEventType||(t.CallbackEventType={}));var r=function(){function t(){}return t.prototype.Copy=function(t){if(this.uiVersion=t.uiVersion,this.log=t.log,this.servers=void 0,t.servers&&t.servers.length){this.servers=[];for(var e=0;e<t.servers.length;++e)this.servers.push(t.servers[e])}},t}();t.EcsClientConfig=r;var o=function(){function t(){}return t.CreateEcsClient=function(){return new u},t.__ChangeFailedRetryFactorInMS=function(t){a.FailedRetryFactorInMS=t},t}();t.EcsClientFactory=o;var s,a=function(){function t(){}return t.Servers=["https://config.teams.microsoft.com/config/v1/Skype/"],t.RefreshIntervalInMS=36e5,t.FailedRetryFactorInMS=1e4,t.MaxRetryIntervalForFailedInMS=36e5,t}();!function(t){t[t.Created=0]="Created",t[t.Initialized=1]="Initialized",t[t.Started=2]="Started",t[t.Loading=3]="Loading"}(s||(s={}));var u=function(){function t(){this._tag=0,this._status=s.Created,this._listeners=[],this._failedTimes={},this._skypeToken=null,this._pendingToken=[],this._queryParams={}}return t.prototype.Initialize=function(t){if(this._status!=s.Created)throw new n(e.ECS_ERROR_INVALID_STATUS);if(!t||!t.uiVersion)throw new n(e.ECS_ERROR_INVALID_CONFIG);this._config=new r,this._config.Copy(t),this._config.uiVersion=this._config.uiVersion.replace("/","_");var i=[];if(this._config.servers&&this._config.servers.length)i=this._config.servers;else for(var o=0;o<a.Servers.length;++o)i.push(a.Servers[o]);for(var u=[];i.length;){var c=Math.floor(Math.random()*i.length);u.push(i[c]),c==i.length-1?i.pop():i[c]=i.pop()}this._config.servers=u,this._Info("servers: "+this._config.servers.join(",")),this._status=s.Initialized,this._Verbose("Initialize() done")},t.prototype.AddListener=function(t){this._Verbose("AddListener()"),this._CheckStatus(s.Initialized);for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return void this._Verbose("the listener has been added already, index: "+e);this._listeners.push(t)},t.prototype.RemoveListener=function(t){this._Verbose("RemoveListener()"),this._CheckStatus(s.Initialized);for(var e=0;e<this._listeners.length;++e)if(this._listeners[e]==t)return void(e==this._listeners.length-1?this._listeners.pop():this._listeners[e]=this._listeners.pop())},t.prototype.Start=function(){this._Verbose("Start()"),this._CheckStatus(s.Initialized),this._status>=s.Started?this._Verbose("Start() already, ignore"):(++this._tag,this._status=s.Started,this.ConfigReloadAsync())},t.prototype.Stop=function(){this._Verbose("Stop()"),this._CheckStatus(s.Initialized),this._status!=s.Initialized?(this._CleanTimer(),this._ecsConfig=null,this._etag=null,this._expireTime=null,this._failedTimes={},this._status=s.Initialized):this._Verbose("Stop() already, ignore")},t.prototype.GetETag=function(){return this._CheckStatus(s.Started),this._etag},t.prototype.SetSkypeToken=function(t){this._Verbose("SetToken()"),this._CheckStatus(s.Started),t=t||null,this._status==s.Loading?(this._Verbose("A request is ongoing, postpone."),this._pendingToken.push(t)):(this._skypeToken=t,this.ConfigReloadAsync())},t.prototype.ConfigReloadAsync=function(){var t=this;if(this._Verbose("ConfigReloadAsync()"),this._CheckStatus(s.Started),this._status!=s.Loading){this._CleanTimer();var e=this._tag,n=this._config.servers[0]+this._config.uiVersion,i={};for(var r in this._queryParams){i[r]={};for(var o in this._queryParams[r])i[r][o]=this._queryParams[r][o]}i.Headers={},!sct.Utils.IsUsingXDomainRequest()&&this._etag&&(i.Headers["If-None-Match"]=this._etag),this._skypeToken&&(i.Headers.SkypeToken=this._skypeToken),0==sct.Utils.keys(i.Headers).length&&delete i.Headers,sct.Utils.ajax({type:"POST",url:n,data:JSON.stringify(i),complete:function(n){return t._HttpCallback(e,n)}}),this._status=s.Loading}else this._Verbose("ConfigReloadAsync() is loading, ignore")},t.prototype.AddQueryParameter=function(t,e,n){if(e&&n){t||(t="global");var i=t.toLowerCase();if("headers"==i)return;i in this._queryParams||(this._queryParams[i]={}),this._queryParams[i][e.toLowerCase()]=n.toLowerCase()}},t.prototype.RemoveQueryParameter=function(t,e){var n="global";t&&(n=t.toLowerCase()),e&&(e=e.toLowerCase(),n in this._queryParams&&e in this._queryParams[n]&&(delete this._queryParams[n][e],0==sct.Utils.keys(this._queryParams[n]).length&&delete this._queryParams[n]))},t.prototype.RemoveQueryParameterByNamespace=function(t){t=t?t.toLowerCase():"global",delete this._queryParams[t]},t.prototype.GetSetting=function(t,e,n){return this._CheckStatus(s.Started),t?this._GetSettingAsDefault(t,e,n,JSON.stringify):this._ecsConfig?JSON.stringify(this._ecsConfig):""},t.prototype.GetSettingAsString=function(t,e,n){return this._CheckStatus(s.Started),this._GetSettingAsDefault(t,e,n,function(t){return""+t})},t.prototype.GetSettingAsInt=function(t,e,n){return this._CheckStatus(s.Started),this._GetSettingAsDefault(t,e,n,parseInt)},t.prototype.GetSettingAsBool=function(t,e,n){return this._CheckStatus(s.Started),this._GetSettingAsDefault(t,e,n,function(t){return!!t})},t.prototype.GetSettingAsReal=function(t,e,n){return this._CheckStatus(s.Started),this._GetSettingAsDefault(t,e,n,parseFloat)},t.prototype.GetSettingAsList=function(t,e){return this._CheckStatus(s.Started),this._GetSettingAsList(t,e,function(t){return""+t})},t.prototype.GetSettingAsListOfInts=function(t,e){return this._CheckStatus(s.Started),this._GetSettingAsList(t,e,parseInt)},t.prototype.GetSettingAsListOfReal=function(t,e){return this._CheckStatus(s.Started),this._GetSettingAsList(t,e,parseFloat)},t.prototype.GetKeys=function(t,e){if(this._CheckStatus(s.Started),!t)return this.GetAgents();var n=this._NormalizePath(t,e);return n?this._GetObjectKeys(this._GetObject(n)):[]},t.prototype.GetAgents=function(){return this._CheckStatus(s.Started),this._GetObjectKeys(this._ecsConfig)},t.prototype._HttpCallback=function(t,r){if(this._Verbose("_HttpCallback"),this._status==s.Loading&&t==this._tag){var o=!0,a=!1;try{if(null==r)throw this._Error("jqXHR is null. exception"),new n(e.ECS_ERROR_INVALID_RESPONSE);var u=this._ParseResponse(r),c=u.statuscode;if(this._Info("status of HttpCallback: "+c),c>=200&&c<=299){var l=u.etag;if(this._Verbose("etag: "+l),!l)throw new n(e.ECS_ERROR_INVALID_RESPONSE);u.expires;this._Verbose("2xx: JSON.parse() success."),this._etag=l,this._ecsConfig=u.data,this._expireTime=u.expires,this._Notify(i.CONFIG_UPDATED)}else switch(c){case 304:this._Verbose("Config is not changed. Update expire time only."),this._expireTime=u.expires;break;case 401:this._Warning("token is invalid"),o=!1,this._Notify(i.TOKEN_IS_INVALID);break;case-1:o=!1;break;default:throw new n(e.ECS_ERROR_INVALID_RESPONSE)}}catch(t){this._Error("exception: "+t),a=!0}o&&this._ScheduleTimer(a),this._status=s.Started}else this._Verbose("_status != loading || tag != _tag, ignore")},t.prototype._Notify=function(t){for(var e=0;e<this._listeners.length;++e)this._listeners[e](t)},t.prototype._ScheduleTimer=function(t){var e=this;if(this._CleanTimer(),t){var n=this._config.servers.shift();this._failedTimes[n]?++this._failedTimes[n]:this._failedTimes[n]=1,this._config.servers.push(n);var i=this._failedTimes[this._config.servers[0]]||0,r=0;i&&(r=Math.pow(2,i-1)*a.FailedRetryFactorInMS)>a.MaxRetryIntervalForFailedInMS&&(r=a.MaxRetryIntervalForFailedInMS),this._timer=setTimeout(function(){return e.ConfigReloadAsync()},r)}else{this._failedTimes[this._config.servers[0]]=0;var o=!1;if(this._pendingToken.length){this._Verbose("Pending token found.");var s=this._pendingToken.pop();this._pendingToken.splice(0,this._pendingToken.length),s!=this._skypeToken&&(this._Verbose("Trigger new request immediately."),this._skypeToken=s,o=!0)}r=0;o||(r=a.RefreshIntervalInMS,this._expireTime&&(r=this._expireTime-(new Date).getTime())<0&&(r=0)),this._timer=setTimeout(function(){return e.ConfigReloadAsync()},r)}},t.prototype._CleanTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},t.prototype._GetSettingAsDefault=function(t,e,n,i){if(!t)return n;var r=this._NormalizePath(t,e);if(!r)return n;var o=this._GetObject(r);if(null==o)return n;try{return i(o)}catch(t){return n}},t.prototype._GetSettingAsList=function(t,e,n){if(!t)return[];var i=this._NormalizePath(t,e);if(!i)return[];var r=this._GetObject(i);if(null==r)return[];try{for(var o=[],s=0;s<r.length;++s)o.push(n(r[s]));return o}catch(t){return[]}},t.prototype._CheckStatus=function(t){if(this._status<t)throw this._Error(["status is error, current status:",this._status,"minimalStatus:",t].join(" ")),new n(e.ECS_ERROR_INVALID_STATUS)},t.prototype._GetObjectKeys=function(t){var e=[];if(null!=t)for(var n in t)e.push(n);return e},t.prototype._GetObject=function(t){for(var e=t.split("/"),n=this._ecsConfig,i=0;i<e.length&&n;++i)n=n[e[i]];return n},t.prototype._NormalizePath=function(t,e){return null!=e&&e.length&&"/"==e[0]&&(e=e.substr(1)),null!=e&&e.length&&"/"==e[e.length-1]&&(e=e.substr(0,e.length-1)),e?t?t+"/"+e:e:t},t.prototype._Verbose=function(t){this._config&&this._config.log&&this._config.log.Verbose("[EcsClient]: "+t)},t.prototype._Info=function(t){this._config&&this._config.log&&this._config.log.Info("[EcsClient]: "+t)},t.prototype._Warning=function(t){this._config&&this._config.log&&this._config.log.Warning("[EcsClient]: "+t)},t.prototype._Error=function(t){this._config&&this._config.log&&this._config.log.Error("[EcsClient]: "+t)},t.prototype._ParseResponse=function(t){var e={};if(t&&void 0!==t.status)if(304==t.status){r=t.getResponseHeader("Expires");this._Verbose("expires: "+r),e.expires=r?Date.parse(r):null,e.etag=t.getResponseHeader("ETag"),e.statuscode=t.status}else if(t.status>=500)e.statuscode=t.status;else if(0==t.status)this._Verbose("Blocked by same-origin policy."),e.statuscode=-1;else try{e.statuscode=t.status;var n=JSON.parse(t.responseText),i=this._GetHeader(n);if(i){this._Verbose("Header found in body.");var r=i.expires;e.expires=r?Date.parse(r):null,e.statuscode=parseInt(i.statuscode),e.etag=i.etag}else this._Error("Header missing in response body.");e.data=n}catch(t){this._Error("Failed when parsing")}else this._Verbose("IE8/IE9 general error handler."),e.statuscode=-1;return this._Verbose("Return code = "+e.statuscode),e},t.prototype._GetHeader=function(t){var e=null;for(var n in t)if("headers"==n.toLowerCase()){e={};for(var i in t[n])e[i.toLowerCase()]=t[n][i];break}return e},t.prototype.__GetListenerArray=function(){return this._listeners},t.prototype.__UpdateServers=function(t){this._config.servers=t},t.prototype.__GetQueryParameters=function(){return this._queryParams},t}()}(ecs||(ecs={}));var microsoft;!function(t){!function(t){!function(t){var e=function(){function t(){this.data=[]}return t.prototype.WriteBlob=function(t){var e={type:"blob",value:t};this.data.push(e)},t.prototype.WriteBool=function(t){var e={type:"boolean",value:t};this.data.push(e)},t.prototype.WriteContainerBegin=function(t,e){var n={type:"containerBegin",size:t,elementType:e};this.data.push(n)},t.prototype.WriteMapContainerBegin=function(t,e,n){var i={type:"mapContainerBegin",size:t,keyType:e,valueType:n};this.data.push(i)},t.prototype.WriteContainerEnd=function(){var t={type:"containerEnd"};this.data.push(t)},t.prototype.WriteDouble=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteFloat=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteFieldBegin=function(t,e,n){var i={type:"fieldBegin",id:e};this.data.push(i)},t.prototype.WriteFieldEnd=function(){var t={type:"fieldEnd"};this.data.push(t)},t.prototype.WriteFieldOmitted=function(t,e,n){var i={type:"fieldOmitted",id:e};this.data.push(i)},t.prototype.WriteInt16=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteInt32=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteInt64=function(t){var e={type:"number",value:4294967296*t.high+t.low};this.data.push(e)},t.prototype.WriteInt8=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteString=function(t){var e={type:"string",value:t};this.data.push(e)},t.prototype.WriteStructBegin=function(t,e){var n={type:"structBegin",isBase:e};this.data.push(n)},t.prototype.WriteStructEnd=function(t){var e={type:"structEnd",isBase:t};this.data.push(e)},t.prototype.WriteUInt16=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteUInt32=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteUInt64=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteUInt8=function(t){var e={type:"number",value:t};this.data.push(e)},t.prototype.WriteWString=function(t){var e={type:"string",value:t};this.data.push(e)},t}();t.JsonTextWriter=e}(t.telemetry||(t.telemetry={}))}(t.applications||(t.applications={}))}(microsoft||(microsoft={}));var PerfDetectWebWorker=function(){function t(){}return t.prototype.initialize=function(t){t.registerEventListener("runBenchMarkPerformanceDetectStrategy",function(){for(var e=Date.now(),n=1e5;n>0;)n--;var i={name:"handleBenchMarkPerformanceDetectStrategy",params:{elapse:Date.now()-e}};t.postMessageToUiThread(i)})},t}(),TelemetryWebWorker=function(){function t(){this.telemetry=new microsoft.applications.telemetry._sender.TelemetryManagerImpl,this.ariaLoggers={},microsoft.applications.telemetry.globalTelemetryManager=this.telemetry}return t.prototype.initialize=function(t){var e=this;t.registerEventListener("start",function(t){e.telemetry.Start()}),t.registerEventListener("stop",function(t){e.telemetry.Stop()}),t.registerEventListener("flush",function(n){var i=8,r=function(){var n=e.telemetry._eventsCache.IsEmpty(),o=0==--i;n||o?t.postMessageToUiThread({name:"flushed"}):e.telemetry.Flush(r)};r()}),t.registerEventListener("initialize",function(t){t.config&&(t.config.log=e),e.telemetry.Initialize(t.config),microsoft.applications.telemetry.LogManager.initialize(t.documentInfo,t.appToken)}),t.registerEventListener("newLogger",function(t){e.ariaLoggers[t.name]=new microsoft.applications.telemetry.Logger(t.token)}),t.registerEventListener("sendAsync",function(t){e.telemetry.SendAsync(t.tenantToken,t.events)}),t.registerEventListener("changeMaxPackageSizeInKB",function(t){e.telemetry.__ChageMaxPackageSizeInKB(t.size)}),t.registerEventListener("logEvent",function(t){e.ariaLoggers[t.name].logEvent(t.eventProperties)}),t.registerEventListener("logSession",function(n){var i=e.ariaLoggers[n.name];i.logSession(n.state,n.properties),t.postMessageToUiThread({name:"sessionId",params:{name:n.name,sessionId:i.getSessionId()}})}),t.registerEventListener("setContext",function(t){microsoft.applications.telemetry.LogManager.setContext(t.key,t.value,t.pii)}),t.registerEventListener("setUserId",function(t){microsoft.applications.telemetry.LogManager.getSemanticContext().setUserId(t.id)}),t.registerEventListener("disableTestHook",function(t){microsoft.applications.telemetry.LogManager.__clearTestHookListener()}),t.registerEventListener("enableTestHook",function(e){microsoft.applications.telemetry.LogManager.__addTestHookListener(function(n){n.forEach(function(n){e&&e.eventTypes&&e.eventTypes.indexOf(n.EventType)>-1&&t.postMessageToUiThread({name:"telemetryTestHook",params:{event:n}})})})})},t.prototype.Verbose=function(t){},t.prototype.Info=function(t){this.workerManager&&this.workerManager.logInfo(t)},t.prototype.Error=function(t){this.workerManager&&this.workerManager.logError(t)},t}(),WebWorkerManager=function(){function t(){var t=this;this.messageHandlers={},this.worker=self,this.worker.addEventListener("message",function(e){if(e&&e.data&&e.data.name){var n=t.messageHandlers[e.data.name];n?n(e.data.params):t.logError("Unhandled webworker message - "+JSON.stringify(e.data))}})}return t.prototype.setupRegistrations=function(t){for(var e=0,n=t;e<n.length;e++)n[e].initialize(this)},t.prototype.registerEventListener=function(t,e){this.messageHandlers[t]?this.logError("Detected duplicate event listener registered to the same key: "+t+"!"):this.messageHandlers[t]=e},t.prototype.postMessageToUiThread=function(t){this.worker.postMessage(t)},t.prototype.logInfo=function(t){this.worker.postMessage({name:"info",params:{msg:t}})},t.prototype.logError=function(t){this.worker.postMessage({name:"error",params:{msg:t}})},t}(),webWorkerManager1=new WebWorkerManager;webWorkerManager1.setupRegistrations([new TelemetryWebWorker,new PerfDetectWebWorker]);
//# sourceMappingURL=https://statics.teams.microsoft.com/hashedjs/webworker.js-72862b63.map