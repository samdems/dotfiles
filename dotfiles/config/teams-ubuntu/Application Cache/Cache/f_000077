(window.webPackBridgeJsonp=window.webPackBridgeJsonp||[]).push([[23],{"6578506114fc52cc91d3":function(e,t,r){"use strict";r.d(t,"c",function(){return o}),r.d(t,"a",function(){return l}),r.d(t,"b",function(){return s});var n=r("5e76ddf6bb30811ee697"),i=r("c0ec8ed08a9b4b107886"),a=r("fcf654cc44d7ec457fe0");function o(e){var t=e.webAbsoluteUrl,r=e.listOrItemFullUrl,n=new i.b({webAbsoluteUrl:t||new a.SimpleUri(r).authority}).build();return!t&&r?n.method("SP.RemoteWeb",r).segment("Web"):n.segment("web")}function l(e){var t=e.webAbsoluteUrl,r=e.listFullUrl,i=new n.a({context:{webAbsoluteUrl:t,listUrl:r}}).getUrlParts().serverRelativeListUrl;return o({webAbsoluteUrl:t,listOrItemFullUrl:r}).method("GetList",i)}function s(e){var t=e.webAbsoluteUrl,r=e.listFullUrl,n=e.viewId;return l({webAbsoluteUrl:t,listFullUrl:r}).method("Views",n)}},"766d9e7109808f01029d":function(e,t,r){"use strict";var n,i=r("98bae3dbabd51089d613"),a=r("a4060cda3c9c24220a4a"),o=r("0b8514f932f40951d460"),l=r("6631b0451e9f577f414d"),s=r("c1a09d7dd35e11297e15"),u=function(){function e(e){this.concurrency=e||1,this._running=0,this._queue=[],this._promiseComplete=this._promiseComplete.bind(this)}return e.prototype.enqueue=function(e){var t;if(this._running<this.concurrency)this._running++,(t=e()).then(this._promiseComplete,this._promiseComplete);else{var r={callback:e,signal:null,canceled:!1,result:null};r.signal=new s.default(function(){r.canceled=!0,o.c.is(r.result)&&r.result.cancel()}),this._queue.push(r),t=r.signal.getPromise()}return o.c.resolve(t)},e.prototype._promiseComplete=function(){var e=this;if(this._running--,this._running<this.concurrency&&this._queue.length){for(var t=this._queue.shift();t&&t.canceled;)t=this._queue.length?this._queue.shift():null;t&&(this._running++,t.result=t.callback(),t.result.then(function(r){t.signal.complete(r),e._promiseComplete()},function(r){t.signal.error(r),e._promiseComplete()}))}},e}(),c=r("cdb9a7d2db44c7a9f4dd"),d=r("e9d155a6651c0bf6c9b0");!function(e){e[e.File=0]="File",e[e.Folder=1]="Folder",e[e.Media=2]="Media",e[e.OneNote=3]="OneNote",e[e.Unknown=4]="Unknown",e[e.Error=5]="Error",e[e.App=6]="App",e[e.Subsite=7]="Subsite",e[e.Shortcut=8]="Shortcut"}(n||(n={}));var p,h,f=n,m=r("62a856fb51e24a703bd6");!function(e){e[e.queued=0]="queued",e[e.started=1]="started",e[e.completed=2]="completed",e[e.aborted=3]="aborted",e[e.failed=4]="failed",e[e.none=5]="none"}(p||(p={})),function(e){e[e.none=0]="none",e[e.other=1]="other",e[e.general=2]="general",e[e.conflict=3]="conflict",e[e.invalidName=4]="invalidName",e[e.fileSize=5]="fileSize",e[e.emptyFileOrFolder=6]="emptyFileOrFolder",e[e.emptyFileOrFolderForDocLib=7]="emptyFileOrFolderForDocLib",e[e.overQuota=8]="overQuota",e[e.accessDenied=9]="accessDenied",e[e.lockMismatch=10]="lockMismatch",e[e.overQuotaSharedFolder=11]="overQuotaSharedFolder",e[e.folderUploadNotSupported=12]="folderUploadNotSupported",e[e.versionMismatch=13]="versionMismatch",e[e.authFailure=14]="authFailure",e[e.targetFolderMissing=15]="targetFolderMissing",e[e.malwareDetected=16]="malwareDetected",e[e.throttled=17]="throttled",e[e.pathTooLong=18]="pathTooLong",e[e.disconnected=19]="disconnected",e[e.unlockRequired=20]="unlockRequired"}(h||(h={}));var _=r("c1d76209a7f2fe28e159"),v=r("00620f24248a4f158ff6"),g=(r("9ba97cc998d0be4df04a"),r("b32a03546c11ac251a10")),b=function(e){function t(t){var r=e.call(this,t)||this;return r.message=t.message,r.errorType=t.errorType||h.other,r.maxSizeInBytes=t.maxSizeInBytes,r.allowRename=t.allowRename||!1,r.allowMerge=t.allowMerge||!1,r.extraData=t.extraData,r.libraryName=t.libraryName,r.isFolder=t.isFolder,r.fixItUrl=t.fixItUrl,r}return i.__extends(t,e),t}(r("655c29c4569d728dbf1e").CustomError),U=r("8e315e7d1c81f1fe46e0"),y=r("256c2b1df06b9b785912"),F=function(){function e(){var e=this.scope=new y.a;this._events=e.attach(new U.a(this))}return e.prototype.start=function(){},e.prototype.abort=function(){},e.prototype.dispose=function(){this.scope.dispose()},e.prototype.updateState=function(e){e!==this.state&&(this.state=e,this._events.raise("upload_state_change",e))},e}(),I=8388608,S=262144e3,w=new u(3),C=function(e){function t(t){var r=this,n=t.fileUpload;return(r=e.call(this)||this)._fileUpload=n,r._authToken=t.authToken,r._uploadId=null,r._chunkNumber=0,r._streamingChunkNumber=0,r._currentChunkSize=I,r._currentStreamingChunkSize=S,r._onProgress=t.onProgress,r._dataRequestor=t.dataRequestor,r._async=r.scope.attach(new l.a(r)),r.totalBytes=n.size,r.uploadedBytes=0,r.fileName=n.name,r.iconName=t.iconName,r.state=0,r.error=null,r.nameConflictBehavior=0,r.allowRename=!1,r._expandAllItemFields=t.expandAllItemFields,r._uniqueId=t.uniqueId,r._parentItemKey=t.parentItemKey,r._targetItemKey=t.targetItemKey,r._serverRelativeItemUrl=t.serverRelativeItemUrl,r._webApiUrl=t.webApiUrl,r}return i.__extends(t,e),t.prototype.start=function(){var e=this;this.updateState(0);var t=w.enqueue(function(){return e.error=void 0,e.updateState(1),e._upload().then(function(){e.updateState(2)},function(t){var r;return r=t instanceof b?t:new b({message:t&&t.message||"",errorType:h.general}),e.error=r,e.updateState(4),o.c.reject(t)})});return this._uploadPromise=t,t},t.prototype.abort=function(){var e=this;if(2!==this.state){this.error=null,this.updateState(3);var t=this._uploadPromise;this._uploadPromise=void 0,t&&(t.cancel(),t.then(function(){},function(){}).done(function(){return e._cancelChunkUpload()}))}},t.prototype.restart=function(){var e,t=this,r=this._uploadPromise;this._uploadPromise=void 0,r?(r.cancel(),e=r.catch(function(){return t._cancelChunkUpload().catch(function(){})})):e=o.c.resolve(),e.done(function(){t.start()})},t.prototype._upload=function(){var e,t=this;this.uploadedBytes=0;var r=this._fileUpload.size;return r<=25165824?e=this._sendSingleRequestUpload():(this._maxUploadRequestDuration=15e4,e=this._sendStreamingUpload()),e.then(function(e){t.uploadedBytes=r,t.item=e})},t.prototype._createUploadError=function(e){var t,r,n;return"string"==typeof e?r=String(e):(t=this._getErrorCode(e),r="string"==typeof e.message?String(e.message):e.message.value),n=-2130575257===t?h.conflict:-1===t?h.general:r?h.other:h.general,new b({message:r,errorType:n,allowRename:this.allowRename})},t.prototype._getErrorCode=function(e){var t=e.code;return(void 0===t?"":t).split(",").map(function(e){return Number(e)})[0]},t.prototype._getUploadFileUrl=function(){var e=this._uniqueId,t=this._serverRelativeItemUrl,r=this._webApiUrl;r=e?r.method("GetFolderById",e):k(r,{serverRelativeItemUrl:t,isFolder:!0});var n=this._fileUpload.name,i=1===this.nameConflictBehavior;r=(r=r.segment("Files")).methodWithAliases("AddUsingPath",{DecodedUrl:n,overwrite:i});var a=null;return this._expandAllItemFields&&(a=(a||"ListItemAllFields")+"/ContentType/Fields"),a&&r.oDataParameter("$Expand",a),r.toString()},t.prototype._isConflictFile=function(){var e=this;if(1===this.nameConflictBehavior)return o.c.resolve(!1);var t=this._serverRelativeItemUrl,r=this._webApiUrl;return r=(r=k(r,{serverRelativeItemUrl:t,isFolder:!0})).segment("Files").oDataParameter("$filter","Name eq '"+d.a.encodeRestUriStringToken(this._fileUpload.name)+"'"),this._dataRequestor.getData({url:r.toString(),qosName:"SingleFileUploader.GetFile",authToken:this._authToken,parseResponse:function(t){var r=JSON.parse(t);return!(!(r&&r.d&&r.d.results&&r.d.results.length>0)||r.d.results[0].Exists&&e._streamingChunkNumber>0)}}).then(function(e){return e},function(e){return!!o.c.isCanceled(e)&&o.c.reject(e)})},t.prototype._processUploadCompleteResponse=function(e){return this._getItemFromResponse(e)},t.prototype._getItemFromResponse=function(e){var t;try{var r=JSON.parse(e).d,n=this._targetItemKey,i=void 0;r.ListItemAllFields&&r.ListItemAllFields.Id&&(i=String(r.ListItemAllFields.Id));var a=!1;if(r.ListItemAllFields&&r.ListItemAllFields.ContentType&&r.ListItemAllFields.ContentType.Fields&&r.ListItemAllFields.ContentType.Fields.results){var o=r.ListItemAllFields.ContentType.Fields.results.filter(function(e){return e.Required});if(o.length>0)for(var l=0,s=o;l<s.length;l++){var u=s[l];if(!r.ListItemAllFields[u.InternalName]){a=!0;break}}}var d=void 0;r.UniqueId&&(d=c.a.normalizeLower(r.UniqueId));var p=r.Name,h=m.b(p);t={key:n,parentKey:this._parentItemKey,type:f.File,id:r.ServerRelativeUrl,name:p,displayName:p,extension:h,properties:{ID:i,uniqueId:d},itemFromServer:r,hasMissingMetadata:a}}catch(e){}return t},t.prototype._generateChunkPostUrl=function(e,t){var r,n=this._fileUpload,a=this._uniqueId,o=n.size<=t,l=this._serverRelativeItemUrl,s=this._webApiUrl,u={uploadId:{guid:this._uploadId}};return 0===this._chunkNumber&&0===this._streamingChunkNumber?(r="StartUpload",s=(s=a?s.method("GetFolderById",a):k(s,{serverRelativeItemUrl:l,isFolder:!0})).segment("Files"),s=1===this.nameConflictBehavior?s.methodWithAliases("GetByPathOrAddStub",{DecodedUrl:n.name}):s.methodWithAliases("AddStubUsingPath",{DecodedUrl:n.name})):(r=o?"FinishUpload":"ContinueUpload",s=k(s,{serverRelativeItemUrl:l+"/"+n.name,isFolder:!1}),u=i.__assign({},u,{fileOffset:e})),(s=s.methodWithAliases(r,u)).toString()},t.prototype._getUploadStatus=function(){var e=this._fileUpload,t=this._uploadId,r=this._serverRelativeItemUrl,n=this._webApiUrl;return n=n.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:r+"/"+e.name}).methodWithAliases("GetUploadStatus",{uploadId:{guid:t}}),this._dataRequestor.getData({url:n.toString(),authToken:this._authToken,qosName:"SingleFileUploader.GetUploadStatus",method:"GET"}).then(function(e){return e.d&&e.d.ExpectedContentRange?parseInt(e.d.ExpectedContentRange.split("-")[0],10):o.c.reject(new Error("No expected range from server response."))})},t.prototype._uploadFragment=function(e,t){var r=this;void 0===e&&(e=0),void 0===t&&(t=3);var n=this._fileUpload.size,i=Math.min(this._currentChunkSize+e,n);this._uploadId||(this._uploadId=c.a.generate());var a=Date.now();return this._sendFileData({url:this._generateChunkPostUrl(e,i),qosName:"SingleFileUploader.SendFileRequest",data:this._fileUpload.slice(e,i),offset:e,length:i-e}).then(function(e){return r.uploadedBytes=i,i<n?(r._chunkNumber++,Date.now()-a<6e4&&(r._currentChunkSize=Math.min(Math.floor(r._currentChunkSize*Math.pow(2,.25)),62914560)),r._uploadFragment(i)):r._processUploadCompleteResponse(e)},function(n){if(o.c.isCanceled(n))return o.c.reject(n);if(-2===r._getErrorCode(n)){if(r._currentChunkSize>262144){r._currentChunkSize=Math.max(Math.floor(r._currentChunkSize/2),262144);var i=void 0;return 0===r._chunkNumber&&(i=r._cancelChunkUpload()),o.c.resolve(i).then(function(){return r._uploadFragment(e)})}}else if(t>0&&r._canRetry(n)){var a,l=new s.default(function(){a&&r._async.clearTimeout(a)});return a=r._async.setTimeout(function(){return l.complete()},1e3),l.getPromise().then(function(){return r._uploadFragment(e,t-1)})}return o.c.reject(r._createUploadError(n))})},t.prototype._sendSingleRequestUpload=function(){var e=this;return this._isConflictFile().then(function(t){if(t){var r=new b({message:"",errorType:h.conflict});return o.c.reject(r)}return e._fileUpload.slice(0,e._fileUpload.size)}).then(function(t){return e._sendFileData({url:e._getUploadFileUrl(),qosName:"SingleFileUploader.UploadFile",data:t,offset:0,length:t.size}).then(function(t){return e._processUploadCompleteResponse(t)}).then(function(e){return e},function(t){return o.c.isCanceled(t)?o.c.reject(t):-2===e._getErrorCode(t)?(e.nameConflictBehavior=1,e._uploadFragment()):o.c.reject(e._createUploadError(t))})})},t.prototype._sendStreamingUpload=function(e,t){var r=this;void 0===e&&(e=0),void 0===t&&(t=3),this._uploadId||(this._uploadId=c.a.generate());var n=this._fileUpload.size,i=this._streamingChunkNumber>0?Math.min(this._currentStreamingChunkSize+e,n):0;return this._isConflictFile().then(function(t){if(t){var n=new b({message:"",errorType:h.conflict});return o.c.reject(n)}return r._fileUpload.slice(e,i)}).then(function(a){return r._sendFileData({url:r._generateChunkPostUrl(e,i),qosName:"SingleFileUploader.SendFileRequest",data:a,offset:e,length:a.size}).then(function(e){return r.uploadedBytes=i,i<n?(r._streamingChunkNumber++,r._sendStreamingUpload(i,t)):r._processUploadCompleteResponse(e)},function(e){if(o.c.isCanceled(e))return o.c.reject(e);if(-2===r._getErrorCode(e)){if(r._currentStreamingChunkSize<=1048576)return o.c.reject(r._createUploadError(e));r._currentStreamingChunkSize=r._currentStreamingChunkSize/2}return r._getUploadStatus().then(function(e){return r._sendStreamingUpload(e,3)},function(n){if(t>0&&r._canRetry(e)){var i,a=new s.default(function(){i&&r._async.clearTimeout(i)});return i=r._async.setTimeout(function(){return a.complete()},1e3),a.getPromise().then(function(){return r._sendStreamingUpload(0,t-1)})}return o.c.reject(r._createUploadError(e))})})})},t.prototype._canRetry=function(e){var t;switch(this._getErrorCode(e)){case-2130575257:case-2130575142:t=!1;break;default:t=!0}return t},t.prototype._cancelChunkUpload=function(){var e=this._uploadId;if(this._uploadId=void 0,this._chunkNumber=0,e){var t=this._fileUpload,r=this._serverRelativeItemUrl,n=this._webApiUrl;return n=(n=k(n,{serverRelativeItemUrl:r+"/"+t.name,isFolder:!1})).methodWithAliases("CancelUpload",{uploadId:{guid:e}}),this._dataRequestor.getData({url:n.toString(),authToken:this._authToken,qosName:"SingleFileUploader.CancelUploadSession"}).then(function(){})}return o.c.resolve()},t.prototype._sendFileData=function(e){var t,r,n,i=this,a=e.url,o=e.qosName,l=e.data,u=e.offset,c=e.length,d=new s.default(function(){t.cancel()}),p=function(e){var t=i._chunkNumber>0&&u+c>=i._fileUpload.size?3e5:1e4,n=Math.max(.08*e,t);r&&i._async.clearTimeout(r),e&&(r=i._async.setTimeout(function(){d.error({code:"-1",message:""})},n))},h=Date.now(),f=Date.now(),m=0,_=0,v=0,g=this._async.debounce(function(e){e>i.uploadedBytes&&(i.uploadedBytes=e,i._onProgress&&i._onProgress(e))},100,{leading:!1});t=this._dataRequestor.getData({url:a,authToken:this._authToken,qosName:o,parseResponse:function(e){return e},contentType:"application/octet-stream",additionalPostData:l,onUploadProgress:function(e){if(e.lengthComputable){var t=Date.now();_+=(e.loaded-m)/(t-f),v++,n=e.loaded/(t-h),f=t,m=e.loaded,g(u+e.loaded),p(c-e.loaded)}}}),p(c);var b=this._async.setInterval(function(){v&&Date.now()-h+(c-m)/((_+n)/(v+1))>i._maxUploadRequestDuration&&m<c&&d.error({code:"-2",message:""})},1e4);return t.done(function(e){d.complete(e)},function(e){d.error(e)}),d.getPromise().done(function(){r&&i._async.clearTimeout(r),b&&i._async.clearInterval(b)},function(){t.cancel(),r&&i._async.clearTimeout(r),b&&i._async.clearInterval(b)}),d.getPromise()},t}(F);function k(e,t){var r=t.serverRelativeItemUrl,n=t.isFolder;return e.methodWithAliases(n?"GetFolderByServerRelativePath":"GetFileByServerRelativePath",{DecodedUrl:r})}!function(e){i.__extends(function(t,r){var n=t.parentItem,i=t.fileUpload,a=r.listContext,o=r.itemUrlHelper,l=r.apiUrlHelper,s=a&&a.contentTypesEnabled&&a.listTemplateType!==v.default.mySiteDocumentLibrary,u=o.getItemUrlParts(n.key),c=n.properties&&n.properties.uniqueId,d=n.key,p=function(e,t,r){var n=e.getItemUrlParts(t);return function(e,t){var r=e;return 0!==r.indexOf("id")&&(r=Object(g.a)({id:e,listurl:t})),r}(n.serverRelativeItemUrl+"/"+r,n.normalizedListUrl)}(o,d,i.name),h=u.serverRelativeItemUrl,f=l.build().webByItemUrl(u),m=new _.b({pageContext:r.pageContext});return e.call(this,{uniqueId:c,expandAllItemFields:s,dataRequestor:m,parentItemKey:d,targetItemKey:p,serverRelativeItemUrl:h,webApiUrl:f,iconName:i.iconName,fileUpload:i})||this},e)}(C);var R=r("65da65eb66805e3724ff"),q=r("ee92087a6ec1d0e9ecc9"),A=r("63b321889ace4da8025b"),N=r("578e5017557fc66bb247"),T=r("3299d0c30f2cf3d2e06b"),P=r("d4c1443220e1f44fce5e"),D=r("447964f318fe44ff3682"),z=r("3da5d317c00adfe8f79c"),x=r("6578506114fc52cc91d3"),j=r("eef09ec91afb2fd77b66"),O=r("a5db57338f8274c3300c");function B(e){var t=this,r=e.itemKey,n=e.options.sourceEntries,l=a.r.deserialize(r),s=l.webAbsoluteUrl,u=l.listFullUrl,c=Object.keys(n)[0],d=n[c].progressItemKey;return function(e,n,a){return i.__awaiter(t,void 0,void 0,function(){var t,n,a,l,p,h,f,m,_,v,g,b,U;return i.__generator(this,function(y){switch(y.label){case 0:return[4,e(Object(R.d)({webAbsoluteUrl:s,listFullUrl:u}))];case 1:return t=y.sent(),[4,e(Object(R.b)({url:s}))];case 2:if(n=y.sent(),a=e(Object(N.a)({sourceFile:T.c},c)).sourceFile,l=e(Object(N.a)({folderPath:q.q},r)).folderPath,!a)throw new Error("No source file for upload.");if(!l)throw new Error("No path information for target folder.");p=Object(x.c)({webAbsoluteUrl:s,listOrItemFullUrl:u}),h=new A.a(this),f=h.debounce(function(t){var r;d&&e(Object(P.e)({items:(r={},r[d]=Object(D.c)({progressSize:z.f},{progressSize:{current:t}}),r)}))},300,{leading:!1}),m=new C({authToken:n,dataRequestor:t,parentItemKey:"",targetItemKey:"",fileUpload:a,iconName:"",serverRelativeItemUrl:l,webApiUrl:p,onProgress:f}),d&&e(Object(P.e)({items:(U={},U[d]=i.__assign({},z.f.pack({total:a.size,current:0})),U)})),_=m.start(),v=e(Object(j.a)(function(e){return e.demandItemFacet(z.b,d)})),g=v?v.token.subscribe(function(){m.abort()}):void 0,y.label=3;case 3:return y.trys.push([3,5,6,7]),[4,_];case 4:return y.sent(),[3,7];case 5:if(b=y.sent(),m.abort(),o.a.isCanceled(b))throw new O.a;throw b;case 6:return g&&g(),m.dispose(),[7];case 7:return[2,m.item]}})})}}r.d(t,"a",function(){return B})},b32a03546c11ac251a10:function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r("98bae3dbabd51089d613"),i=r("e9d155a6651c0bf6c9b0");function a(e,t,r){var a="",o=!0;for(var l in t&&(e=n.__assign({},t,e)),e){var s=e[l];(!r||"object"!=typeof s&&s||"object"==typeof s&&s&&s.uriValue||"number"==typeof s||"boolean"==typeof s)&&(o?o=!1:a+="&",a+=l+"="+("object"==typeof s&&s&&s.uriValue?s.uriValue:i.a.encodeURIComponent(""+s)))}return a}}}]);
//# sourceMappingURL=precompiled-23.min.4e84c015c5171e97099c.js.map