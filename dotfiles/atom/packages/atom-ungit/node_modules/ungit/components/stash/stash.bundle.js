(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){

var ko = require('knockout');
var moment = require('moment');
var components = require('ungit-components');
var storage = require('ungit-storage');

components.register('stash', function(args) {
  return new StashViewModel(args.server, args.repoPath);
});

function StashItemViewModel(stash, data) {
  this.stash = stash;
  this.server = stash.server;
  this.id = data.reflogId;
  this.sha1 = data.sha1;
  this.title = data.reflogName + ' ' + moment(new Date(data.commitDate)).fromNow();
  this.message = data.message;
  this.showCommitDiff = ko.observable(false);

  this.commitDiff = ko.observable(components.create('commitDiff', {
    fileLineDiffs: data.fileLineDiffs.slice(),
    sha1: this.sha1,
    repoPath: stash.repoPath,
    server: stash.server
  }));
}
StashItemViewModel.prototype.apply = function() {
  var self = this;
  this.server.delPromise('/stashes/' + this.id, { path: this.stash.repoPath(), apply: true })
    .catch((e) => this.server.unhandledRejection(e));
}
StashItemViewModel.prototype.drop = function() {
  var self = this;
  components.create('yesnodialog', { title: 'Are you sure you want to drop the stash?', details: 'This operation cannot be undone.'})
    .show()
    .closeThen(function(diag) {
      if (diag.result()) {
          self.server.delPromise('/stashes/' + self.id, { path: self.stash.repoPath() })
            .catch((e) => this.server.unhandledRejection(e));
      }
  });
}
StashItemViewModel.prototype.toggleShowCommitDiffs = function() {
  this.showCommitDiff(!this.showCommitDiff());
}

function StashViewModel(server, repoPath) {
  var self = this;
  this.server = server;
  this.repoPath = repoPath;
  this.stashedChanges = ko.observable([]);
  this.isShow = ko.observable(storage.getItem('showStash') === 'true');
  this.visible = ko.computed(function() { return self.stashedChanges().length > 0 && self.isShow(); });
  this.refresh();
}

StashViewModel.prototype.updateNode = function(parentElement) {
  if (!this.isDisabled) ko.renderTemplate('stash', this, {}, parentElement);
}
StashViewModel.prototype.onProgramEvent = function(event) {
  if (event.event == 'request-app-content-refresh' ||
    event.event == 'working-tree-changed' ||
    event.event == 'git-directory-changed')
    this.refresh();
}
StashViewModel.prototype.refresh = function() {
  var self = this;
  this.server.getPromise('/stashes', { path: this.repoPath() })
    .then(function(stashes) {
      var changed = self.stashedChanges().length != stashes.length;
      if (!changed) {
        changed = !self.stashedChanges().every(function(item1) {
          return stashes.some(function(item2) {
            return item1.sha1 == item2.sha1;
          });
        });
      }

      if (changed) {
        self.stashedChanges(stashes.map(function(item) { return new StashItemViewModel(self, item); }));
      }
    }).catch(function(err) {
      if (err.errorCode != 'no-such-path') self.server.unhandledRejection(err);
    })
}
StashViewModel.prototype.toggleShowStash = function() {
  this.isShow(!this.isShow());
  storage.setItem('showStash', this.isShow());
}

},{"knockout":"knockout","moment":"moment","ungit-components":"ungit-components","ungit-storage":"ungit-storage"}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL3N0YXNoL3N0YXNoLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiXG52YXIga28gPSByZXF1aXJlKCdrbm9ja291dCcpO1xudmFyIG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xudmFyIGNvbXBvbmVudHMgPSByZXF1aXJlKCd1bmdpdC1jb21wb25lbnRzJyk7XG52YXIgc3RvcmFnZSA9IHJlcXVpcmUoJ3VuZ2l0LXN0b3JhZ2UnKTtcblxuY29tcG9uZW50cy5yZWdpc3Rlcignc3Rhc2gnLCBmdW5jdGlvbihhcmdzKSB7XG4gIHJldHVybiBuZXcgU3Rhc2hWaWV3TW9kZWwoYXJncy5zZXJ2ZXIsIGFyZ3MucmVwb1BhdGgpO1xufSk7XG5cbmZ1bmN0aW9uIFN0YXNoSXRlbVZpZXdNb2RlbChzdGFzaCwgZGF0YSkge1xuICB0aGlzLnN0YXNoID0gc3Rhc2g7XG4gIHRoaXMuc2VydmVyID0gc3Rhc2guc2VydmVyO1xuICB0aGlzLmlkID0gZGF0YS5yZWZsb2dJZDtcbiAgdGhpcy5zaGExID0gZGF0YS5zaGExO1xuICB0aGlzLnRpdGxlID0gZGF0YS5yZWZsb2dOYW1lICsgJyAnICsgbW9tZW50KG5ldyBEYXRlKGRhdGEuY29tbWl0RGF0ZSkpLmZyb21Ob3coKTtcbiAgdGhpcy5tZXNzYWdlID0gZGF0YS5tZXNzYWdlO1xuICB0aGlzLnNob3dDb21taXREaWZmID0ga28ub2JzZXJ2YWJsZShmYWxzZSk7XG5cbiAgdGhpcy5jb21taXREaWZmID0ga28ub2JzZXJ2YWJsZShjb21wb25lbnRzLmNyZWF0ZSgnY29tbWl0RGlmZicsIHtcbiAgICBmaWxlTGluZURpZmZzOiBkYXRhLmZpbGVMaW5lRGlmZnMuc2xpY2UoKSxcbiAgICBzaGExOiB0aGlzLnNoYTEsXG4gICAgcmVwb1BhdGg6IHN0YXNoLnJlcG9QYXRoLFxuICAgIHNlcnZlcjogc3Rhc2guc2VydmVyXG4gIH0pKTtcbn1cblN0YXNoSXRlbVZpZXdNb2RlbC5wcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNlcnZlci5kZWxQcm9taXNlKCcvc3Rhc2hlcy8nICsgdGhpcy5pZCwgeyBwYXRoOiB0aGlzLnN0YXNoLnJlcG9QYXRoKCksIGFwcGx5OiB0cnVlIH0pXG4gICAgLmNhdGNoKChlKSA9PiB0aGlzLnNlcnZlci51bmhhbmRsZWRSZWplY3Rpb24oZSkpO1xufVxuU3Rhc2hJdGVtVmlld01vZGVsLnByb3RvdHlwZS5kcm9wID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgY29tcG9uZW50cy5jcmVhdGUoJ3llc25vZGlhbG9nJywgeyB0aXRsZTogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkcm9wIHRoZSBzdGFzaD8nLCBkZXRhaWxzOiAnVGhpcyBvcGVyYXRpb24gY2Fubm90IGJlIHVuZG9uZS4nfSlcbiAgICAuc2hvdygpXG4gICAgLmNsb3NlVGhlbihmdW5jdGlvbihkaWFnKSB7XG4gICAgICBpZiAoZGlhZy5yZXN1bHQoKSkge1xuICAgICAgICAgIHNlbGYuc2VydmVyLmRlbFByb21pc2UoJy9zdGFzaGVzLycgKyBzZWxmLmlkLCB7IHBhdGg6IHNlbGYuc3Rhc2gucmVwb1BhdGgoKSB9KVxuICAgICAgICAgICAgLmNhdGNoKChlKSA9PiB0aGlzLnNlcnZlci51bmhhbmRsZWRSZWplY3Rpb24oZSkpO1xuICAgICAgfVxuICB9KTtcbn1cblN0YXNoSXRlbVZpZXdNb2RlbC5wcm90b3R5cGUudG9nZ2xlU2hvd0NvbW1pdERpZmZzID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuc2hvd0NvbW1pdERpZmYoIXRoaXMuc2hvd0NvbW1pdERpZmYoKSk7XG59XG5cbmZ1bmN0aW9uIFN0YXNoVmlld01vZGVsKHNlcnZlciwgcmVwb1BhdGgpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgdGhpcy5yZXBvUGF0aCA9IHJlcG9QYXRoO1xuICB0aGlzLnN0YXNoZWRDaGFuZ2VzID0ga28ub2JzZXJ2YWJsZShbXSk7XG4gIHRoaXMuaXNTaG93ID0ga28ub2JzZXJ2YWJsZShzdG9yYWdlLmdldEl0ZW0oJ3Nob3dTdGFzaCcpID09PSAndHJ1ZScpO1xuICB0aGlzLnZpc2libGUgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHsgcmV0dXJuIHNlbGYuc3Rhc2hlZENoYW5nZXMoKS5sZW5ndGggPiAwICYmIHNlbGYuaXNTaG93KCk7IH0pO1xuICB0aGlzLnJlZnJlc2goKTtcbn1cblxuU3Rhc2hWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZU5vZGUgPSBmdW5jdGlvbihwYXJlbnRFbGVtZW50KSB7XG4gIGlmICghdGhpcy5pc0Rpc2FibGVkKSBrby5yZW5kZXJUZW1wbGF0ZSgnc3Rhc2gnLCB0aGlzLCB7fSwgcGFyZW50RWxlbWVudCk7XG59XG5TdGFzaFZpZXdNb2RlbC5wcm90b3R5cGUub25Qcm9ncmFtRXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtYXBwLWNvbnRlbnQtcmVmcmVzaCcgfHxcbiAgICBldmVudC5ldmVudCA9PSAnd29ya2luZy10cmVlLWNoYW5nZWQnIHx8XG4gICAgZXZlbnQuZXZlbnQgPT0gJ2dpdC1kaXJlY3RvcnktY2hhbmdlZCcpXG4gICAgdGhpcy5yZWZyZXNoKCk7XG59XG5TdGFzaFZpZXdNb2RlbC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuc2VydmVyLmdldFByb21pc2UoJy9zdGFzaGVzJywgeyBwYXRoOiB0aGlzLnJlcG9QYXRoKCkgfSlcbiAgICAudGhlbihmdW5jdGlvbihzdGFzaGVzKSB7XG4gICAgICB2YXIgY2hhbmdlZCA9IHNlbGYuc3Rhc2hlZENoYW5nZXMoKS5sZW5ndGggIT0gc3Rhc2hlcy5sZW5ndGg7XG4gICAgICBpZiAoIWNoYW5nZWQpIHtcbiAgICAgICAgY2hhbmdlZCA9ICFzZWxmLnN0YXNoZWRDaGFuZ2VzKCkuZXZlcnkoZnVuY3Rpb24oaXRlbTEpIHtcbiAgICAgICAgICByZXR1cm4gc3Rhc2hlcy5zb21lKGZ1bmN0aW9uKGl0ZW0yKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbTEuc2hhMSA9PSBpdGVtMi5zaGExO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNoYW5nZWQpIHtcbiAgICAgICAgc2VsZi5zdGFzaGVkQ2hhbmdlcyhzdGFzaGVzLm1hcChmdW5jdGlvbihpdGVtKSB7IHJldHVybiBuZXcgU3Rhc2hJdGVtVmlld01vZGVsKHNlbGYsIGl0ZW0pOyB9KSk7XG4gICAgICB9XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICBpZiAoZXJyLmVycm9yQ29kZSAhPSAnbm8tc3VjaC1wYXRoJykgc2VsZi5zZXJ2ZXIudW5oYW5kbGVkUmVqZWN0aW9uKGVycik7XG4gICAgfSlcbn1cblN0YXNoVmlld01vZGVsLnByb3RvdHlwZS50b2dnbGVTaG93U3Rhc2ggPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5pc1Nob3coIXRoaXMuaXNTaG93KCkpO1xuICBzdG9yYWdlLnNldEl0ZW0oJ3Nob3dTdGFzaCcsIHRoaXMuaXNTaG93KCkpO1xufVxuIl19
