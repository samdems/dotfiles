"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const outline_view_adapter_1 = require("../../lib/adapters/outline-view-adapter");
const ls = require("../../lib/languageclient");
const sinon = require("sinon");
const chai_1 = require("chai");
describe('OutlineViewAdapter', () => {
    const createLocation = (a, b, c, d) => ({
        uri: '',
        range: { start: { line: a, character: b }, end: { line: c, character: d } },
    });
    beforeEach(() => {
        global.sinon = sinon.sandbox.create();
    });
    afterEach(() => {
        global.sinon.restore();
    });
    describe('canAdapt', () => {
        it('returns true if documentSymbolProvider is supported', () => {
            const result = outline_view_adapter_1.default.canAdapt({ documentSymbolProvider: true });
            chai_1.expect(result).to.be.true;
        });
        it('returns false if documentSymbolProvider not supported', () => {
            const result = outline_view_adapter_1.default.canAdapt({});
            chai_1.expect(result).to.be.false;
        });
    });
    describe('createOutlineTrees', () => {
        it('creates an empty array given an empty array', () => {
            const result = outline_view_adapter_1.default.createOutlineTrees([]);
            chai_1.expect(result).to.deep.equal([]);
        });
        it('creates a single converted root item from a single source item', () => {
            const sourceItem = { kind: ls.SymbolKind.Namespace, name: 'R', location: createLocation(5, 6, 7, 8) };
            const expected = outline_view_adapter_1.default.symbolToOutline(sourceItem);
            const result = outline_view_adapter_1.default.createOutlineTrees([sourceItem]);
            chai_1.expect(result).to.deep.equal([expected]);
        });
        it('creates an empty root container with a single source item when containerName missing', () => {
            const sourceItem = {
                kind: ls.SymbolKind.Class,
                name: 'Program',
                location: createLocation(1, 2, 3, 4),
            };
            const expected = outline_view_adapter_1.default.symbolToOutline(sourceItem);
            sourceItem.containerName = 'missing';
            const result = outline_view_adapter_1.default.createOutlineTrees([sourceItem]);
            chai_1.expect(result.length).to.equal(1);
            chai_1.expect(result[0].representativeName).to.equal('missing');
            chai_1.expect(result[0].startPosition.row).to.equal(0);
            chai_1.expect(result[0].startPosition.column).to.equal(0);
            chai_1.expect(result[0].children).to.deep.equal([expected]);
        });
        // tslint:disable-next-line:max-line-length
        it('creates an empty root container with a single source item when containerName is missing and matches own name', () => {
            const sourceItem = {
                kind: ls.SymbolKind.Class,
                name: 'simple',
                location: createLocation(1, 2, 3, 4),
            };
            const expected = outline_view_adapter_1.default.symbolToOutline(sourceItem);
            sourceItem.containerName = 'simple';
            const result = outline_view_adapter_1.default.createOutlineTrees([sourceItem]);
            chai_1.expect(result.length).to.equal(1);
            chai_1.expect(result[0].representativeName).to.equal('simple');
            chai_1.expect(result[0].startPosition.row).to.equal(0);
            chai_1.expect(result[0].startPosition.column).to.equal(0);
            chai_1.expect(result[0].children).to.deep.equal([expected]);
        });
        it('creates a simple named hierarchy', () => {
            const sourceItems = [
                { kind: ls.SymbolKind.Namespace, name: 'java.com', location: createLocation(1, 0, 10, 0) },
                { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(2, 0, 7, 0), containerName: 'java.com' },
                { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(4, 0, 5, 0), containerName: 'Program' },
            ];
            const result = outline_view_adapter_1.default.createOutlineTrees(sourceItems);
            chai_1.expect(result.length).to.equal(1);
            chai_1.expect(result[0].children.length).to.equal(1);
            chai_1.expect(result[0].children[0].representativeName).to.equal('Program');
            chai_1.expect(result[0].children[0].children.length).to.equal(1);
            chai_1.expect(result[0].children[0].children[0].representativeName).to.equal('main');
        });
        it('retains duplicate named items', () => {
            const sourceItems = [
                { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) },
                { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) },
                { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' },
            ];
            const result = outline_view_adapter_1.default.createOutlineTrees(sourceItems);
            chai_1.expect(result.length).to.equal(2);
            chai_1.expect(result[0].representativeName).to.equal('duplicate');
            chai_1.expect(result[1].representativeName).to.equal('duplicate');
        });
        it('disambiguates containerName based on range', () => {
            const sourceItems = [
                { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 5, 0) },
                { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(6, 0, 10, 0) },
                { kind: ls.SymbolKind.Function, name: 'main', location: createLocation(7, 0, 8, 0), containerName: 'duplicate' },
            ];
            const result = outline_view_adapter_1.default.createOutlineTrees(sourceItems);
            chai_1.expect(result[1].children.length).to.equal(1);
            chai_1.expect(result[1].children[0].representativeName).to.equal('main');
        });
        it("does not become it's own parent", () => {
            const sourceItems = [
                { kind: ls.SymbolKind.Namespace, name: 'duplicate', location: createLocation(1, 0, 10, 0) },
                {
                    kind: ls.SymbolKind.Namespace,
                    name: 'duplicate',
                    location: createLocation(6, 0, 7, 0),
                    containerName: 'duplicate',
                },
            ];
            const result = outline_view_adapter_1.default.createOutlineTrees(sourceItems);
            chai_1.expect(result.length).to.equal(1);
            const outline = result[0];
            chai_1.expect(outline.endPosition).to.not.be.undefined;
            if (outline.endPosition) {
                chai_1.expect(outline.endPosition.row).to.equal(10);
                chai_1.expect(outline.children.length).to.equal(1);
                const outlineChild = outline.children[0];
                chai_1.expect(outlineChild.endPosition).to.not.be.undefined;
                if (outlineChild.endPosition) {
                    chai_1.expect(outlineChild.endPosition.row).to.equal(7);
                }
            }
        });
        it('parents to the innnermost named container', () => {
            const sourceItems = [
                { kind: ls.SymbolKind.Namespace, name: 'turtles', location: createLocation(1, 0, 10, 0) },
                {
                    kind: ls.SymbolKind.Namespace,
                    name: 'turtles',
                    location: createLocation(4, 0, 8, 0),
                    containerName: 'turtles',
                },
                { kind: ls.SymbolKind.Class, name: 'disc', location: createLocation(4, 0, 5, 0), containerName: 'turtles' },
            ];
            const result = outline_view_adapter_1.default.createOutlineTrees(sourceItems);
            chai_1.expect(result.length).to.equal(1);
            const outline = result[0];
            chai_1.expect(outline).to.not.be.undefined;
            if (outline) {
                chai_1.expect(outline.endPosition).to.not.be.undefined;
                if (outline.endPosition) {
                    chai_1.expect(outline.endPosition.row).to.equal(10);
                    chai_1.expect(outline.children.length).to.equal(1);
                    const outlineChild = outline.children[0];
                    chai_1.expect(outlineChild.endPosition).to.not.be.undefined;
                    if (outlineChild.endPosition) {
                        chai_1.expect(outlineChild.endPosition.row).to.equal(8);
                        chai_1.expect(outlineChild.children.length).to.equal(1);
                        const outlineGrandChild = outlineChild.children[0];
                        chai_1.expect(outlineGrandChild.endPosition).to.not.be.undefined;
                        if (outlineGrandChild.endPosition) {
                            chai_1.expect(outlineGrandChild.endPosition.row).to.equal(5);
                        }
                    }
                }
            }
        });
    });
    describe('symbolToOutline', () => {
        it('converts an individual item', () => {
            const sourceItem = { kind: ls.SymbolKind.Class, name: 'Program', location: createLocation(1, 2, 3, 4) };
            const result = outline_view_adapter_1.default.symbolToOutline(sourceItem);
            chai_1.expect(result.icon).to.equal('type-class');
            chai_1.expect(result.representativeName).to.equal('Program');
            chai_1.expect(result.children).to.deep.equal([]);
            chai_1.expect(result.tokenizedText).to.not.be.undefined;
            if (result.tokenizedText) {
                chai_1.expect(result.tokenizedText[0].kind).to.equal('type');
                chai_1.expect(result.tokenizedText[0].value).to.equal('Program');
                chai_1.expect(result.startPosition.row).to.equal(1);
                chai_1.expect(result.startPosition.column).to.equal(2);
                chai_1.expect(result.endPosition).to.not.be.undefined;
                if (result.endPosition) {
                    chai_1.expect(result.endPosition.row).to.equal(3);
                    chai_1.expect(result.endPosition.column).to.equal(4);
                }
            }
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0bGluZS12aWV3LWFkYXB0ZXIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvb3V0bGluZS12aWV3LWFkYXB0ZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtGQUF5RTtBQUN6RSwrQ0FBK0M7QUFDL0MsK0JBQStCO0FBQy9CLCtCQUE4QjtBQUU5QixRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2xDLE1BQU0sY0FBYyxHQUFHLENBQUMsQ0FBTSxFQUFFLENBQU0sRUFBRSxDQUFNLEVBQUUsQ0FBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzFELEdBQUcsRUFBRSxFQUFFO1FBQ1AsS0FBSyxFQUFFLEVBQUMsS0FBSyxFQUFFLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFDLEVBQUM7S0FDdEUsQ0FBQyxDQUFDO0lBRUgsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNiLE1BQWMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNILFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDWixNQUFjLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7UUFDeEIsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEdBQUcsRUFBRTtZQUM3RCxNQUFNLE1BQU0sR0FBRyw4QkFBa0IsQ0FBQyxRQUFRLENBQUMsRUFBQyxzQkFBc0IsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1lBQzNFLGFBQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFD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QUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUM7Z0JBQ3hGLEVBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFDO2dCQUM3RyxFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsYUFBYSxFQUFFLFNBQVMsRUFBQzthQUM3RyxDQUFDO1lBQ0YsTUFBTSxNQUFNLEdBQUcsOEJBQWtCLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEUsYUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLGFBQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUMsYUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3JFLGFBQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFELGFBQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEYsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1lBQ3ZDLE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUM7Z0JBQ3hGLEVBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBQztnQkFDekYsRUFBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUM7YUFDL0csQ0FBQztZQUNGLE1BQU0sTUFBTSxHQUFHLDhCQUFrQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2xFLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQyxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUMzRCxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLEVBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBQztnQkFDeEYsRUFBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFDO2dCQUN6RixFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBQzthQUMvRyxDQUFDO1lBQ0YsTUFBTSxNQUFNLEdBQUcsOEJBQWtCLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDbEUsYUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QyxhQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUM7Z0JBQ3pGO29CQUNFLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVM7b0JBQzdCLElBQUksRUFBRSxXQUFXO29CQUNqQixRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDcEMsYUFBYSxFQUFFLFdBQVc7aUJBQzNCO2FBQ0YsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLDhCQUFrQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2xFLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVsQyxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsYUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDaEQsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO2dCQUN2QixhQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUM3QyxhQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUU1QyxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QyxhQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDckQsSUFBSSxZQUFZLENBQUMsV0FBVyxFQUFFO29CQUM1QixhQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2lCQUNsRDthQUNGO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ25ELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUM7Z0JBQ3ZGO29CQUNFLElBQUksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVM7b0JBQzdCLElBQUksRUFBRSxTQUFTO29CQUNmLFFBQVEsRUFBRSxjQUFjLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNwQyxhQUFhLEVBQUUsU0FBUztpQkFDekI7Z0JBQ0QsRUFBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsY0FBYyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxTQUFTLEVBQUM7YUFDMUcsQ0FBQztZQUNGLE1BQU0sTUFBTSxHQUFHLDhCQUFrQixDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2xFLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVsQyxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsYUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNwQyxJQUFJLE9BQU8sRUFBRTtnQkFDWCxhQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDaEQsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFO29CQUN2QixhQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUM3QyxhQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUU1QyxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN6QyxhQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDckQsSUFBSSxZQUFZLENBQUMsV0FBVyxFQUFFO3dCQUM1QixhQUFNLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNqRCxhQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUVqRCxNQUFNLGlCQUFpQixHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ25ELGFBQU0sQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUM7d0JBQzFELElBQUksaUJBQWlCLENBQUMsV0FBVyxFQUFFOzRCQUNqQyxhQUFNLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQ3ZEO3FCQUNGO2lCQUNGO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLE1BQU0sVUFBVSxHQUFHLEVBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBQyxDQUFDO1lBQ3RHLE1BQU0sTUFBTSxHQUFHLDhCQUFrQixDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM5RCxhQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDM0MsYUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdEQsYUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQyxhQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNqRCxJQUFJLE1BQU0sQ0FBQyxhQUFhLEVBQUU7Z0JBQ3hCLGFBQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3RELGFBQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQzFELGFBQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzdDLGFBQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELGFBQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUMvQyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUU7b0JBQ3RCLGFBQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzNDLGFBQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQy9DO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gJy4uLy4uL2xpYi9hZGFwdGVycy9vdXRsaW5lLXZpZXctYWRhcHRlcic7XHJcbmltcG9ydCAqIGFzIGxzIGZyb20gJy4uLy4uL2xpYi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCAqIGFzIHNpbm9uIGZyb20gJ3Npbm9uJztcclxuaW1wb3J0IHsgZXhwZWN0IH0gZnJvbSAnY2hhaSc7XHJcblxyXG5kZXNjcmliZSgnT3V0bGluZVZpZXdBZGFwdGVyJywgKCkgPT4ge1xyXG4gIGNvbnN0IGNyZWF0ZUxvY2F0aW9uID0gKGE6IGFueSwgYjogYW55LCBjOiBhbnksIGQ6IGFueSkgPT4gKHtcclxuICAgIHVyaTogJycsXHJcbiAgICByYW5nZToge3N0YXJ0OiB7bGluZTogYSwgY2hhcmFjdGVyOiBifSwgZW5kOiB7bGluZTogYywgY2hhcmFjdGVyOiBkfX0sXHJcbiAgfSk7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgKGdsb2JhbCBhcyBhbnkpLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgKGdsb2JhbCBhcyBhbnkpLnNpbm9uLnJlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NhbkFkYXB0JywgKCkgPT4ge1xyXG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiBkb2N1bWVudFN5bWJvbFByb3ZpZGVyIGlzIHN1cHBvcnRlZCcsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNhbkFkYXB0KHtkb2N1bWVudFN5bWJvbFByb3ZpZGVyOiB0cnVlfSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLnRydWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgncmV0dXJucyBmYWxzZSBpZiBkb2N1bWVudFN5bWJvbFByb3ZpZGVyIG5vdCBzdXBwb3J0ZWQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jYW5BZGFwdCh7fSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmJlLmZhbHNlO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGVPdXRsaW5lVHJlZXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnY3JlYXRlcyBhbiBlbXB0eSBhcnJheSBnaXZlbiBhbiBlbXB0eSBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbXSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvLmRlZXAuZXF1YWwoW10pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NyZWF0ZXMgYSBzaW5nbGUgY29udmVydGVkIHJvb3QgaXRlbSBmcm9tIGEgc2luZ2xlIHNvdXJjZSBpdGVtJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2VJdGVtID0ge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnUicsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig1LCA2LCA3LCA4KX07XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkID0gT3V0bGluZVZpZXdBZGFwdGVyLnN5bWJvbFRvT3V0bGluZShzb3VyY2VJdGVtKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbc291cmNlSXRlbV0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50by5kZWVwLmVxdWFsKFtleHBlY3RlZF0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2NyZWF0ZXMgYW4gZW1wdHkgcm9vdCBjb250YWluZXIgd2l0aCBhIHNpbmdsZSBzb3VyY2UgaXRlbSB3aGVuIGNvbnRhaW5lck5hbWUgbWlzc2luZycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbTogbHMuU3ltYm9sSW5mb3JtYXRpb24gPSB7XHJcbiAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5DbGFzcyxcclxuICAgICAgICBuYW1lOiAnUHJvZ3JhbScsXHJcbiAgICAgICAgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDIsIDMsIDQpLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBleHBlY3RlZCA9IE91dGxpbmVWaWV3QWRhcHRlci5zeW1ib2xUb091dGxpbmUoc291cmNlSXRlbSk7XHJcbiAgICAgIHNvdXJjZUl0ZW0uY29udGFpbmVyTmFtZSA9ICdtaXNzaW5nJztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbc291cmNlSXRlbV0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnbWlzc2luZycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0YXJ0UG9zaXRpb24ucm93KS50by5lcXVhbCgwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5zdGFydFBvc2l0aW9uLmNvbHVtbikudG8uZXF1YWwoMCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uY2hpbGRyZW4pLnRvLmRlZXAuZXF1YWwoW2V4cGVjdGVkXSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICBpdCgnY3JlYXRlcyBhbiBlbXB0eSByb290IGNvbnRhaW5lciB3aXRoIGEgc2luZ2xlIHNvdXJjZSBpdGVtIHdoZW4gY29udGFpbmVyTmFtZSBpcyBtaXNzaW5nIGFuZCBtYXRjaGVzIG93biBuYW1lJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2VJdGVtOiBscy5TeW1ib2xJbmZvcm1hdGlvbiA9IHtcclxuICAgICAgICBraW5kOiBscy5TeW1ib2xLaW5kLkNsYXNzLFxyXG4gICAgICAgIG5hbWU6ICdzaW1wbGUnLFxyXG4gICAgICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAyLCAzLCA0KSxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZXhwZWN0ZWQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuc3ltYm9sVG9PdXRsaW5lKHNvdXJjZUl0ZW0pO1xyXG4gICAgICBzb3VyY2VJdGVtLmNvbnRhaW5lck5hbWUgPSAnc2ltcGxlJztcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhbc291cmNlSXRlbV0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnc2ltcGxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMF0uc3RhcnRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDApO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLnN0YXJ0UG9zaXRpb24uY29sdW1uKS50by5lcXVhbCgwKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbZXhwZWN0ZWRdKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjcmVhdGVzIGEgc2ltcGxlIG5hbWVkIGhpZXJhcmNoeScsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnamF2YS5jb20nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMSwgMCwgMTAsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5DbGFzcywgbmFtZTogJ1Byb2dyYW0nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oMiwgMCwgNywgMCksIGNvbnRhaW5lck5hbWU6ICdqYXZhLmNvbSd9LFxyXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLkZ1bmN0aW9uLCBuYW1lOiAnbWFpbicsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig0LCAwLCA1LCAwKSwgY29udGFpbmVyTmFtZTogJ1Byb2dyYW0nfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlbi5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5jaGlsZHJlblswXS5jaGlsZHJlbi5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ21haW4nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdyZXRhaW5zIGR1cGxpY2F0ZSBuYW1lZCBpdGVtcycsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDAsIDUsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsIG5hbWU6ICdkdXBsaWNhdGUnLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNiwgMCwgMTAsIDApfSxcclxuICAgICAgICB7a2luZDogbHMuU3ltYm9sS2luZC5GdW5jdGlvbiwgbmFtZTogJ21haW4nLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oNywgMCwgOCwgMCksIGNvbnRhaW5lck5hbWU6ICdkdXBsaWNhdGUnfSxcclxuICAgICAgXTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLmNyZWF0ZU91dGxpbmVUcmVlcyhzb3VyY2VJdGVtcyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50by5lcXVhbCgyKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFswXS5yZXByZXNlbnRhdGl2ZU5hbWUpLnRvLmVxdWFsKCdkdXBsaWNhdGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdFsxXS5yZXByZXNlbnRhdGl2ZU5hbWUpLnRvLmVxdWFsKCdkdXBsaWNhdGUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkaXNhbWJpZ3VhdGVzIGNvbnRhaW5lck5hbWUgYmFzZWQgb24gcmFuZ2UnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHNvdXJjZUl0ZW1zID0gW1xyXG4gICAgICAgIHtraW5kOiBscy5TeW1ib2xLaW5kLk5hbWVzcGFjZSwgbmFtZTogJ2R1cGxpY2F0ZScsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCA1LCAwKX0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDYsIDAsIDEwLCAwKX0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuRnVuY3Rpb24sIG5hbWU6ICdtYWluJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDcsIDAsIDgsIDApLCBjb250YWluZXJOYW1lOiAnZHVwbGljYXRlJ30sXHJcbiAgICAgIF07XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IE91dGxpbmVWaWV3QWRhcHRlci5jcmVhdGVPdXRsaW5lVHJlZXMoc291cmNlSXRlbXMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0WzFdLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRbMV0uY2hpbGRyZW5bMF0ucmVwcmVzZW50YXRpdmVOYW1lKS50by5lcXVhbCgnbWFpbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJkb2VzIG5vdCBiZWNvbWUgaXQncyBvd24gcGFyZW50XCIsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAnZHVwbGljYXRlJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDAsIDEwLCAwKX0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAga2luZDogbHMuU3ltYm9sS2luZC5OYW1lc3BhY2UsXHJcbiAgICAgICAgICBuYW1lOiAnZHVwbGljYXRlJyxcclxuICAgICAgICAgIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbig2LCAwLCA3LCAwKSxcclxuICAgICAgICAgIGNvbnRhaW5lck5hbWU6ICdkdXBsaWNhdGUnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKHNvdXJjZUl0ZW1zKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG5cclxuICAgICAgY29uc3Qgb3V0bGluZSA9IHJlc3VsdFswXTtcclxuICAgICAgZXhwZWN0KG91dGxpbmUuZW5kUG9zaXRpb24pLnRvLm5vdC5iZS51bmRlZmluZWQ7XHJcbiAgICAgIGlmIChvdXRsaW5lLmVuZFBvc2l0aW9uKSB7XHJcbiAgICAgICAgZXhwZWN0KG91dGxpbmUuZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCgxMCk7XHJcbiAgICAgICAgZXhwZWN0KG91dGxpbmUuY2hpbGRyZW4ubGVuZ3RoKS50by5lcXVhbCgxKTtcclxuXHJcbiAgICAgICAgY29uc3Qgb3V0bGluZUNoaWxkID0gb3V0bGluZS5jaGlsZHJlblswXTtcclxuICAgICAgICBleHBlY3Qob3V0bGluZUNoaWxkLmVuZFBvc2l0aW9uKS50by5ub3QuYmUudW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChvdXRsaW5lQ2hpbGQuZW5kUG9zaXRpb24pIHtcclxuICAgICAgICAgIGV4cGVjdChvdXRsaW5lQ2hpbGQuZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCg3KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdwYXJlbnRzIHRvIHRoZSBpbm5uZXJtb3N0IG5hbWVkIGNvbnRhaW5lcicsICgpID0+IHtcclxuICAgICAgY29uc3Qgc291cmNlSXRlbXMgPSBbXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLCBuYW1lOiAndHVydGxlcycsIGxvY2F0aW9uOiBjcmVhdGVMb2NhdGlvbigxLCAwLCAxMCwgMCl9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGtpbmQ6IGxzLlN5bWJvbEtpbmQuTmFtZXNwYWNlLFxyXG4gICAgICAgICAgbmFtZTogJ3R1cnRsZXMnLFxyXG4gICAgICAgICAgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDQsIDAsIDgsIDApLFxyXG4gICAgICAgICAgY29udGFpbmVyTmFtZTogJ3R1cnRsZXMnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge2tpbmQ6IGxzLlN5bWJvbEtpbmQuQ2xhc3MsIG5hbWU6ICdkaXNjJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDQsIDAsIDUsIDApLCBjb250YWluZXJOYW1lOiAndHVydGxlcyd9LFxyXG4gICAgICBdO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBPdXRsaW5lVmlld0FkYXB0ZXIuY3JlYXRlT3V0bGluZVRyZWVzKHNvdXJjZUl0ZW1zKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvLmVxdWFsKDEpO1xyXG5cclxuICAgICAgY29uc3Qgb3V0bGluZSA9IHJlc3VsdFswXTtcclxuICAgICAgZXhwZWN0KG91dGxpbmUpLnRvLm5vdC5iZS51bmRlZmluZWQ7XHJcbiAgICAgIGlmIChvdXRsaW5lKSB7XHJcbiAgICAgICAgZXhwZWN0KG91dGxpbmUuZW5kUG9zaXRpb24pLnRvLm5vdC5iZS51bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKG91dGxpbmUuZW5kUG9zaXRpb24pIHtcclxuICAgICAgICAgIGV4cGVjdChvdXRsaW5lLmVuZFBvc2l0aW9uLnJvdykudG8uZXF1YWwoMTApO1xyXG4gICAgICAgICAgZXhwZWN0KG91dGxpbmUuY2hpbGRyZW4ubGVuZ3RoKS50by5lcXVhbCgxKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBvdXRsaW5lQ2hpbGQgPSBvdXRsaW5lLmNoaWxkcmVuWzBdO1xyXG4gICAgICAgICAgZXhwZWN0KG91dGxpbmVDaGlsZC5lbmRQb3NpdGlvbikudG8ubm90LmJlLnVuZGVmaW5lZDtcclxuICAgICAgICAgIGlmIChvdXRsaW5lQ2hpbGQuZW5kUG9zaXRpb24pIHtcclxuICAgICAgICAgICAgZXhwZWN0KG91dGxpbmVDaGlsZC5lbmRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDgpO1xyXG4gICAgICAgICAgICBleHBlY3Qob3V0bGluZUNoaWxkLmNoaWxkcmVuLmxlbmd0aCkudG8uZXF1YWwoMSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBvdXRsaW5lR3JhbmRDaGlsZCA9IG91dGxpbmVDaGlsZC5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgZXhwZWN0KG91dGxpbmVHcmFuZENoaWxkLmVuZFBvc2l0aW9uKS50by5ub3QuYmUudW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBpZiAob3V0bGluZUdyYW5kQ2hpbGQuZW5kUG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICBleHBlY3Qob3V0bGluZUdyYW5kQ2hpbGQuZW5kUG9zaXRpb24ucm93KS50by5lcXVhbCg1KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdzeW1ib2xUb091dGxpbmUnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgYW4gaW5kaXZpZHVhbCBpdGVtJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzb3VyY2VJdGVtID0ge2tpbmQ6IGxzLlN5bWJvbEtpbmQuQ2xhc3MsIG5hbWU6ICdQcm9ncmFtJywgbG9jYXRpb246IGNyZWF0ZUxvY2F0aW9uKDEsIDIsIDMsIDQpfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gT3V0bGluZVZpZXdBZGFwdGVyLnN5bWJvbFRvT3V0bGluZShzb3VyY2VJdGVtKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pY29uKS50by5lcXVhbCgndHlwZS1jbGFzcycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlcHJlc2VudGF0aXZlTmFtZSkudG8uZXF1YWwoJ1Byb2dyYW0nKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbXSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudG9rZW5pemVkVGV4dCkudG8ubm90LmJlLnVuZGVmaW5lZDtcclxuICAgICAgaWYgKHJlc3VsdC50b2tlbml6ZWRUZXh0KSB7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b2tlbml6ZWRUZXh0WzBdLmtpbmQpLnRvLmVxdWFsKCd0eXBlJyk7XHJcbiAgICAgICAgZXhwZWN0KHJlc3VsdC50b2tlbml6ZWRUZXh0WzBdLnZhbHVlKS50by5lcXVhbCgnUHJvZ3JhbScpO1xyXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhcnRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDEpO1xyXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3RhcnRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDIpO1xyXG4gICAgICAgIGV4cGVjdChyZXN1bHQuZW5kUG9zaXRpb24pLnRvLm5vdC5iZS51bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5lbmRQb3NpdGlvbikge1xyXG4gICAgICAgICAgZXhwZWN0KHJlc3VsdC5lbmRQb3NpdGlvbi5yb3cpLnRvLmVxdWFsKDMpO1xyXG4gICAgICAgICAgZXhwZWN0KHJlc3VsdC5lbmRQb3NpdGlvbi5jb2x1bW4pLnRvLmVxdWFsKDQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pO1xyXG4iXX0=