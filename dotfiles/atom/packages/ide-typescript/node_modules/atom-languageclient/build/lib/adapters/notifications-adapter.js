"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const languageclient_1 = require("../languageclient");
// Public: Adapts Atom's user notifications to those of the language server protocol.
class NotificationsAdapter {
    // Public: Attach to a {LanguageClientConnection} to recieve events indicating
    // when user notifications should be displayed.
    static attach(connection, name, projectPath) {
        connection.onShowMessage((m) => NotificationsAdapter.onShowMessage(m, name, projectPath));
        connection.onShowMessageRequest((m) => NotificationsAdapter.onShowMessageRequest(m, name, projectPath));
    }
    // Public: Show a notification message with buttons using the Atom notifications API.
    //
    // * `params` The {ShowMessageRequestParams} received from the language server
    //            indicating the details of the notification to be displayed.
    // * `name`   The name of the language server so the user can identify the
    //            context of the message.
    // * `projectPath`   The path of the current project.
    static onShowMessageRequest(params, name, projectPath) {
        return new Promise((resolve, _reject) => {
            const options = {
                dismissable: true,
                detail: `${name} ${projectPath}`,
            };
            if (params.actions) {
                options.buttons = params.actions.map((a) => ({
                    text: a.title,
                    onDidClick: () => {
                        resolve(a);
                        if (notification != null) {
                            notification.dismiss();
                        }
                    },
                }));
            }
            const notification = addNotificationForMessage(params.type, params.message, options);
            if (notification != null) {
                notification.onDidDismiss(() => {
                    resolve(null);
                });
            }
        });
    }
    // Public: Show a notification message using the Atom notifications API.
    //
    // * `params` The {ShowMessageParams} received from the language server
    //            indicating the details of the notification to be displayed.
    // * `name`   The name of the language server so the user can identify the
    //            context of the message.
    // * `projectPath`   The path of the current project.
    static onShowMessage(params, name, projectPath) {
        addNotificationForMessage(params.type, params.message, {
            dismissable: true,
            detail: `${name} ${projectPath}`,
        });
    }
    // Public: Convert a {MessageActionItem} from the language server into an
    // equivalent {NotificationButton} within Atom.
    //
    // * `actionItem` The {MessageActionItem} to be converted.
    //
    // Returns a {NotificationButton} equivalent to the {MessageActionItem} given.
    static actionItemToNotificationButton(actionItem) {
        return {
            text: actionItem.title,
        };
    }
}
exports.default = NotificationsAdapter;
function messageTypeToString(messageType) {
    switch (messageType) {
        case languageclient_1.MessageType.Error: return 'error';
        case languageclient_1.MessageType.Warning: return 'warning';
        default: return 'info';
    }
}
function addNotificationForMessage(messageType, message, options) {
    function isDuplicate(note) {
        const noteDismissed = note.isDismissed && note.isDismissed();
        const noteOptions = note.getOptions && note.getOptions() || {};
        return !noteDismissed &&
            note.getType() === messageTypeToString(messageType) &&
            note.getMessage() === message &&
            noteOptions.detail === options.detail;
    }
    if (atom.notifications.getNotifications().some(isDuplicate)) {
        return null;
    }
    switch (messageType) {
        case languageclient_1.MessageType.Error:
            return atom.notifications.addError(message, options);
        case languageclient_1.MessageType.Warning:
            return atom.notifications.addWarning(message, options);
        case languageclient_1.MessageType.Log:
            // console.log(params.message);
            return null;
        case languageclient_1.MessageType.Info:
        default:
            return atom.notifications.addInfo(message, options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9ucy1hZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNEQU0yQjtBQU8zQixxRkFBcUY7QUFDckY7SUFDRSw4RUFBOEU7SUFDOUUsK0NBQStDO0lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQ2xCLFVBQW9DLEVBQ3BDLElBQVksRUFDWixXQUFtQjtRQUVuQixVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzFGLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsb0JBQW9CLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQzFHLENBQUM7SUFFRCxxRkFBcUY7SUFDckYsRUFBRTtJQUNGLDhFQUE4RTtJQUM5RSx5RUFBeUU7SUFDekUsMEVBQTBFO0lBQzFFLHFDQUFxQztJQUNyQyxxREFBcUQ7SUFDOUMsTUFBTSxDQUFDLG9CQUFvQixDQUNoQyxNQUFnQyxFQUNoQyxJQUFZLEVBQ1osV0FBbUI7UUFFbkIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsRUFBRTtZQUN0QyxNQUFNLE9BQU8sR0FBd0I7Z0JBQ25DLFdBQVcsRUFBRSxJQUFJO2dCQUNqQixNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksV0FBVyxFQUFFO2FBQ2pDLENBQUM7WUFDRixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUU7Z0JBQ2xCLE9BQU8sQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQzNDLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSztvQkFDYixVQUFVLEVBQUUsR0FBRyxFQUFFO3dCQUNmLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDWCxJQUFJLFlBQVksSUFBSSxJQUFJLEVBQUU7NEJBQ3hCLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQzt5QkFDeEI7b0JBQ0gsQ0FBQztpQkFDRixDQUFDLENBQUMsQ0FBQzthQUNMO1lBRUQsTUFBTSxZQUFZLEdBQUcseUJBQXlCLENBQzVDLE1BQU0sQ0FBQyxJQUFJLEVBQ1gsTUFBTSxDQUFDLE9BQU8sRUFDZCxPQUFPLENBQUMsQ0FBQztZQUVYLElBQUksWUFBWSxJQUFJLElBQUksRUFBRTtnQkFDeEIsWUFBWSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUU7b0JBQzdCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDaEIsQ0FBQyxDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHdFQUF3RTtJQUN4RSxFQUFFO0lBQ0YsdUVBQXVFO0lBQ3ZFLHlFQUF5RTtJQUN6RSwwRUFBMEU7SUFDMUUscUNBQXFDO0lBQ3JDLHFEQUFxRDtJQUM5QyxNQUFNLENBQUMsYUFBYSxDQUN6QixNQUF5QixFQUN6QixJQUFZLEVBQ1osV0FBbUI7UUFFbkIseUJBQXlCLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsT0FBTyxFQUFFO1lBQ3JELFdBQVcsRUFBRSxJQUFJO1lBQ2pCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxXQUFXLEVBQUU7U0FDakMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHlFQUF5RTtJQUN6RSwrQ0FBK0M7SUFDL0MsRUFBRTtJQUNGLDBEQUEwRDtJQUMxRCxFQUFFO0lBQ0YsOEVBQThFO0lBQ3ZFLE1BQU0sQ0FBQyw4QkFBOEIsQ0FDMUMsVUFBNkI7UUFFN0IsT0FBTztZQUNMLElBQUksRUFBRSxVQUFVLENBQUMsS0FBSztTQUN2QixDQUFDO0lBQ0osQ0FBQztDQUNGO0FBckZELHVDQXFGQztBQUVELDZCQUNFLFdBQW1CO0lBRW5CLFFBQVEsV0FBVyxFQUFFO1FBQ25CLEtBQUssNEJBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLE9BQU8sQ0FBQztRQUN2QyxLQUFLLDRCQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxTQUFTLENBQUM7UUFDM0MsT0FBTyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUM7S0FDeEI7QUFDSCxDQUFDO0FBRUQsbUNBQ0UsV0FBbUIsRUFDbkIsT0FBZSxFQUNmLE9BQTRCO0lBRTVCLHFCQUFxQixJQUFxQjtRQUN4QyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM3RCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDL0QsT0FBTyxDQUFDLGFBQWE7WUFDbkIsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLG1CQUFtQixDQUFDLFdBQVcsQ0FBQztZQUNuRCxJQUFJLENBQUMsVUFBVSxFQUFFLEtBQUssT0FBTztZQUM3QixXQUFXLENBQUMsTUFBTSxLQUFLLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDMUMsQ0FBQztJQUNELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtRQUMzRCxPQUFPLElBQUksQ0FBQztLQUNiO0lBRUQsUUFBUSxXQUFXLEVBQUU7UUFDbkIsS0FBSyw0QkFBVyxDQUFDLEtBQUs7WUFDcEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdkQsS0FBSyw0QkFBVyxDQUFDLE9BQU87WUFDdEIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDekQsS0FBSyw0QkFBVyxDQUFDLEdBQUc7WUFDbEIsK0JBQStCO1lBQy9CLE9BQU8sSUFBSSxDQUFDO1FBQ2QsS0FBSyw0QkFBVyxDQUFDLElBQUksQ0FBQztRQUN0QjtZQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQ3ZEO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uLFxyXG4gIE1lc3NhZ2VUeXBlLFxyXG4gIE1lc3NhZ2VBY3Rpb25JdGVtLFxyXG4gIFNob3dNZXNzYWdlUGFyYW1zLFxyXG4gIFNob3dNZXNzYWdlUmVxdWVzdFBhcmFtcyxcclxufSBmcm9tICcuLi9sYW5ndWFnZWNsaWVudCc7XHJcbmltcG9ydCB7XHJcbiAgTm90aWZpY2F0aW9uLFxyXG4gIE5vdGlmaWNhdGlvbk9wdGlvbnMsXHJcbiAgTm90aWZpY2F0aW9uRXh0LFxyXG59IGZyb20gJ2F0b20nO1xyXG5cclxuLy8gUHVibGljOiBBZGFwdHMgQXRvbSdzIHVzZXIgbm90aWZpY2F0aW9ucyB0byB0aG9zZSBvZiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHByb3RvY29sLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb3RpZmljYXRpb25zQWRhcHRlciB7XHJcbiAgLy8gUHVibGljOiBBdHRhY2ggdG8gYSB7TGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9ufSB0byByZWNpZXZlIGV2ZW50cyBpbmRpY2F0aW5nXHJcbiAgLy8gd2hlbiB1c2VyIG5vdGlmaWNhdGlvbnMgc2hvdWxkIGJlIGRpc3BsYXllZC5cclxuICBwdWJsaWMgc3RhdGljIGF0dGFjaChcclxuICAgIGNvbm5lY3Rpb246IExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbixcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHByb2plY3RQYXRoOiBzdHJpbmcsXHJcbiAgKSB7XHJcbiAgICBjb25uZWN0aW9uLm9uU2hvd01lc3NhZ2UoKG0pID0+IE5vdGlmaWNhdGlvbnNBZGFwdGVyLm9uU2hvd01lc3NhZ2UobSwgbmFtZSwgcHJvamVjdFBhdGgpKTtcclxuICAgIGNvbm5lY3Rpb24ub25TaG93TWVzc2FnZVJlcXVlc3QoKG0pID0+IE5vdGlmaWNhdGlvbnNBZGFwdGVyLm9uU2hvd01lc3NhZ2VSZXF1ZXN0KG0sIG5hbWUsIHByb2plY3RQYXRoKSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNob3cgYSBub3RpZmljYXRpb24gbWVzc2FnZSB3aXRoIGJ1dHRvbnMgdXNpbmcgdGhlIEF0b20gbm90aWZpY2F0aW9ucyBBUEkuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7U2hvd01lc3NhZ2VSZXF1ZXN0UGFyYW1zfSByZWNlaXZlZCBmcm9tIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcclxuICAvLyAgICAgICAgICAgIGluZGljYXRpbmcgdGhlIGRldGFpbHMgb2YgdGhlIG5vdGlmaWNhdGlvbiB0byBiZSBkaXNwbGF5ZWQuXHJcbiAgLy8gKiBgbmFtZWAgICBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHNvIHRoZSB1c2VyIGNhbiBpZGVudGlmeSB0aGVcclxuICAvLyAgICAgICAgICAgIGNvbnRleHQgb2YgdGhlIG1lc3NhZ2UuXHJcbiAgLy8gKiBgcHJvamVjdFBhdGhgICAgVGhlIHBhdGggb2YgdGhlIGN1cnJlbnQgcHJvamVjdC5cclxuICBwdWJsaWMgc3RhdGljIG9uU2hvd01lc3NhZ2VSZXF1ZXN0KFxyXG4gICAgcGFyYW1zOiBTaG93TWVzc2FnZVJlcXVlc3RQYXJhbXMsXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBwcm9qZWN0UGF0aDogc3RyaW5nLFxyXG4gICk6IFByb21pc2U8TWVzc2FnZUFjdGlvbkl0ZW0gfCBudWxsPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIF9yZWplY3QpID0+IHtcclxuICAgICAgY29uc3Qgb3B0aW9uczogTm90aWZpY2F0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICBkaXNtaXNzYWJsZTogdHJ1ZSxcclxuICAgICAgICBkZXRhaWw6IGAke25hbWV9ICR7cHJvamVjdFBhdGh9YCxcclxuICAgICAgfTtcclxuICAgICAgaWYgKHBhcmFtcy5hY3Rpb25zKSB7XHJcbiAgICAgICAgb3B0aW9ucy5idXR0b25zID0gcGFyYW1zLmFjdGlvbnMubWFwKChhKSA9PiAoe1xyXG4gICAgICAgICAgdGV4dDogYS50aXRsZSxcclxuICAgICAgICAgIG9uRGlkQ2xpY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgcmVzb2x2ZShhKTtcclxuICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmRpc21pc3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGFkZE5vdGlmaWNhdGlvbkZvck1lc3NhZ2UoXHJcbiAgICAgICAgcGFyYW1zLnR5cGUsXHJcbiAgICAgICAgcGFyYW1zLm1lc3NhZ2UsXHJcbiAgICAgICAgb3B0aW9ucyk7XHJcblxyXG4gICAgICBpZiAobm90aWZpY2F0aW9uICE9IG51bGwpIHtcclxuICAgICAgICBub3RpZmljYXRpb24ub25EaWREaXNtaXNzKCgpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTaG93IGEgbm90aWZpY2F0aW9uIG1lc3NhZ2UgdXNpbmcgdGhlIEF0b20gbm90aWZpY2F0aW9ucyBBUEkuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7U2hvd01lc3NhZ2VQYXJhbXN9IHJlY2VpdmVkIGZyb20gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gIC8vICAgICAgICAgICAgaW5kaWNhdGluZyB0aGUgZGV0YWlscyBvZiB0aGUgbm90aWZpY2F0aW9uIHRvIGJlIGRpc3BsYXllZC5cclxuICAvLyAqIGBuYW1lYCAgIFRoZSBuYW1lIG9mIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgc28gdGhlIHVzZXIgY2FuIGlkZW50aWZ5IHRoZVxyXG4gIC8vICAgICAgICAgICAgY29udGV4dCBvZiB0aGUgbWVzc2FnZS5cclxuICAvLyAqIGBwcm9qZWN0UGF0aGAgICBUaGUgcGF0aCBvZiB0aGUgY3VycmVudCBwcm9qZWN0LlxyXG4gIHB1YmxpYyBzdGF0aWMgb25TaG93TWVzc2FnZShcclxuICAgIHBhcmFtczogU2hvd01lc3NhZ2VQYXJhbXMsXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBwcm9qZWN0UGF0aDogc3RyaW5nLFxyXG4gICk6IHZvaWQge1xyXG4gICAgYWRkTm90aWZpY2F0aW9uRm9yTWVzc2FnZShwYXJhbXMudHlwZSwgcGFyYW1zLm1lc3NhZ2UsIHtcclxuICAgICAgZGlzbWlzc2FibGU6IHRydWUsXHJcbiAgICAgIGRldGFpbDogYCR7bmFtZX0gJHtwcm9qZWN0UGF0aH1gLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IENvbnZlcnQgYSB7TWVzc2FnZUFjdGlvbkl0ZW19IGZyb20gdGhlIGxhbmd1YWdlIHNlcnZlciBpbnRvIGFuXHJcbiAgLy8gZXF1aXZhbGVudCB7Tm90aWZpY2F0aW9uQnV0dG9ufSB3aXRoaW4gQXRvbS5cclxuICAvL1xyXG4gIC8vICogYGFjdGlvbkl0ZW1gIFRoZSB7TWVzc2FnZUFjdGlvbkl0ZW19IHRvIGJlIGNvbnZlcnRlZC5cclxuICAvL1xyXG4gIC8vIFJldHVybnMgYSB7Tm90aWZpY2F0aW9uQnV0dG9ufSBlcXVpdmFsZW50IHRvIHRoZSB7TWVzc2FnZUFjdGlvbkl0ZW19IGdpdmVuLlxyXG4gIHB1YmxpYyBzdGF0aWMgYWN0aW9uSXRlbVRvTm90aWZpY2F0aW9uQnV0dG9uKFxyXG4gICAgYWN0aW9uSXRlbTogTWVzc2FnZUFjdGlvbkl0ZW0sXHJcbiAgKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0ZXh0OiBhY3Rpb25JdGVtLnRpdGxlLFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1lc3NhZ2VUeXBlVG9TdHJpbmcoXHJcbiAgbWVzc2FnZVR5cGU6IG51bWJlcixcclxuKTogc3RyaW5nIHtcclxuICBzd2l0Y2ggKG1lc3NhZ2VUeXBlKSB7XHJcbiAgICBjYXNlIE1lc3NhZ2VUeXBlLkVycm9yOiByZXR1cm4gJ2Vycm9yJztcclxuICAgIGNhc2UgTWVzc2FnZVR5cGUuV2FybmluZzogcmV0dXJuICd3YXJuaW5nJztcclxuICAgIGRlZmF1bHQ6IHJldHVybiAnaW5mbyc7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhZGROb3RpZmljYXRpb25Gb3JNZXNzYWdlKFxyXG4gIG1lc3NhZ2VUeXBlOiBudW1iZXIsXHJcbiAgbWVzc2FnZTogc3RyaW5nLFxyXG4gIG9wdGlvbnM6IE5vdGlmaWNhdGlvbk9wdGlvbnMsXHJcbik6IE5vdGlmaWNhdGlvbiB8IG51bGwge1xyXG4gIGZ1bmN0aW9uIGlzRHVwbGljYXRlKG5vdGU6IE5vdGlmaWNhdGlvbkV4dCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgbm90ZURpc21pc3NlZCA9IG5vdGUuaXNEaXNtaXNzZWQgJiYgbm90ZS5pc0Rpc21pc3NlZCgpO1xyXG4gICAgY29uc3Qgbm90ZU9wdGlvbnMgPSBub3RlLmdldE9wdGlvbnMgJiYgbm90ZS5nZXRPcHRpb25zKCkgfHwge307XHJcbiAgICByZXR1cm4gIW5vdGVEaXNtaXNzZWQgJiZcclxuICAgICAgbm90ZS5nZXRUeXBlKCkgPT09IG1lc3NhZ2VUeXBlVG9TdHJpbmcobWVzc2FnZVR5cGUpICYmXHJcbiAgICAgIG5vdGUuZ2V0TWVzc2FnZSgpID09PSBtZXNzYWdlICYmXHJcbiAgICAgIG5vdGVPcHRpb25zLmRldGFpbCA9PT0gb3B0aW9ucy5kZXRhaWw7XHJcbiAgfVxyXG4gIGlmIChhdG9tLm5vdGlmaWNhdGlvbnMuZ2V0Tm90aWZpY2F0aW9ucygpLnNvbWUoaXNEdXBsaWNhdGUpKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHN3aXRjaCAobWVzc2FnZVR5cGUpIHtcclxuICAgIGNhc2UgTWVzc2FnZVR5cGUuRXJyb3I6XHJcbiAgICAgIHJldHVybiBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IobWVzc2FnZSwgb3B0aW9ucyk7XHJcbiAgICBjYXNlIE1lc3NhZ2VUeXBlLldhcm5pbmc6XHJcbiAgICAgIHJldHVybiBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkV2FybmluZyhtZXNzYWdlLCBvcHRpb25zKTtcclxuICAgIGNhc2UgTWVzc2FnZVR5cGUuTG9nOlxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhwYXJhbXMubWVzc2FnZSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgY2FzZSBNZXNzYWdlVHlwZS5JbmZvOlxyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmV0dXJuIGF0b20ubm90aWZpY2F0aW9ucy5hZGRJbmZvKG1lc3NhZ2UsIG9wdGlvbnMpO1xyXG4gIH1cclxufVxyXG4iXX0=