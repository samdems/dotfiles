"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
const jsonrpc = require("vscode-jsonrpc");
const events_1 = require("events");
const logger_1 = require("./logger");
__export(require("vscode-languageserver-protocol"));
// TypeScript wrapper around JSONRPC to implement Microsoft Language Server Protocol v3
// https://github.com/Microsoft/language-server-protocol/blob/master/protocol.md
class LanguageClientConnection extends events_1.EventEmitter {
    constructor(rpc, logger) {
        super();
        this._rpc = rpc;
        this._log = logger || new logger_1.NullLogger();
        this.setupLogging();
        rpc.listen();
        this.isConnected = true;
        this._rpc.onClose(() => {
            this.isConnected = false;
            this._log.warn('rpc.onClose', 'The RPC connection closed unexpectedly');
            this.emit('close');
        });
    }
    setupLogging() {
        this._rpc.onError((error) => this._log.error(['rpc.onError', error]));
        this._rpc.onUnhandledNotification((notification) => {
            if (notification.method != null && notification.params != null) {
                this._log.warn(`rpc.onUnhandledNotification ${notification.method}`, notification.params);
            }
            else {
                this._log.warn('rpc.onUnhandledNotification', notification);
            }
        });
        this._rpc.onNotification((...args) => this._log.debug('rpc.onNotification', args));
    }
    dispose() {
        this._rpc.dispose();
    }
    // Public: Initialize the language server with necessary {InitializeParams}.
    //
    // * `params` The {InitializeParams} containing processId, rootPath, options and
    //            server capabilities.
    //
    // Returns a {Promise} containing the {InitializeResult} with details of the server's
    // capabilities.
    initialize(params) {
        return this._sendRequest('initialize', params);
    }
    // Public: Send an `initialized` notification to the language server.
    initialized() {
        this._sendNotification('initialized', {});
    }
    // Public: Send a `shutdown` request to the language server.
    shutdown() {
        return this._sendRequest('shutdown');
    }
    // Public: Send an `exit` notification to the language server.
    exit() {
        this._sendNotification('exit');
    }
    // Public: Register a callback for a custom message.
    //
    // * `method`   A string containing the name of the message to listen for.
    // * `callback` The function to be called when the message is received.
    //              The payload from the message is passed to the function.
    onCustom(method, callback) {
        this._onNotification({ method }, callback);
    }
    // Public: Send a custom request
    //
    // * `method`   A string containing the name of the request message.
    // * `params`   The method's parameters
    sendCustomRequest(method, params) {
        return this._sendRequest(method, params);
    }
    // Public: Send a custom notification
    //
    // * `method`   A string containing the name of the notification message.
    // * `params`  The method's parameters
    sendCustomNotification(method, params) {
        this._sendNotification(method, params);
    }
    // Public: Register a callback for the `window/showMessage` message.
    //
    // * `callback` The function to be called when the `window/showMessage` message is
    //              received with {ShowMessageParams} being passed.
    onShowMessage(callback) {
        this._onNotification({ method: 'window/showMessage' }, callback);
    }
    // Public: Register a callback for the `window/showMessageRequest` message.
    //
    // * `callback` The function to be called when the `window/showMessageRequest` message is
    //              received with {ShowMessageRequestParam}' being passed.
    // Returns a {Promise} containing the {MessageActionItem}.
    onShowMessageRequest(callback) {
        this._onRequest({ method: 'window/showMessageRequest' }, callback);
    }
    // Public: Register a callback for the `window/logMessage` message.
    //
    // * `callback` The function to be called when the `window/logMessage` message is
    //              received with {LogMessageParams} being passed.
    onLogMessage(callback) {
        this._onNotification({ method: 'window/logMessage' }, callback);
    }
    // Public: Register a callback for the `telemetry/event` message.
    //
    // * `callback` The function to be called when the `telemetry/event` message is
    //              received with any parameters received being passed on.
    onTelemetryEvent(callback) {
        this._onNotification({ method: 'telemetry/event' }, callback);
    }
    // Public: Register a callback for the `workspace/applyEdit` message.
    //
    // * `callback` The function to be called when the `workspace/applyEdit` message is
    //              received with {ApplyWorkspaceEditParams} being passed.
    // Returns a {Promise} containing the {ApplyWorkspaceEditResponse}.
    onApplyEdit(callback) {
        this._onRequest({ method: 'workspace/applyEdit' }, callback);
    }
    // Public: Send a `workspace/didChangeConfiguration` notification.
    //
    // * `params` The {DidChangeConfigurationParams} containing the new configuration.
    didChangeConfiguration(params) {
        this._sendNotification('workspace/didChangeConfiguration', params);
    }
    // Public: Send a `textDocument/didOpen` notification.
    //
    // * `params` The {DidOpenTextDocumentParams} containing the opened text document details.
    didOpenTextDocument(params) {
        this._sendNotification('textDocument/didOpen', params);
    }
    // Public: Send a `textDocument/didChange` notification.
    //
    // * `params` The {DidChangeTextDocumentParams} containing the changed text document
    // details including the version number and actual text changes.
    didChangeTextDocument(params) {
        this._sendNotification('textDocument/didChange', params);
    }
    // Public: Send a `textDocument/didClose` notification.
    //
    // * `params` The {DidCloseTextDocumentParams} containing the opened text document details.
    didCloseTextDocument(params) {
        this._sendNotification('textDocument/didClose', params);
    }
    // Public: Send a `textDocument/willSave` notification.
    //
    // * `params` The {WillSaveTextDocumentParams} containing the to-be-saved text document
    // details and the reason for the save.
    willSaveTextDocument(params) {
        this._sendNotification('textDocument/willSave', params);
    }
    // Public: Send a `textDocument/willSaveWaitUntil` notification.
    //
    // * `params` The {WillSaveTextDocumentParams} containing the to-be-saved text document
    // details and the reason for the save.
    // Returns a {Promise} containing an {Array} of {TextEdit}s to be applied to the text
    // document before it is saved.
    willSaveWaitUntilTextDocument(params) {
        return this._sendRequest('textDocument/willSaveWaitUntil', params);
    }
    // Public: Send a `textDocument/didSave` notification.
    //
    // * `params` The {DidSaveTextDocumentParams} containing the saved text document details.
    didSaveTextDocument(params) {
        this._sendNotification('textDocument/didSave', params);
    }
    // Public: Send a `workspace/didChangeWatchedFiles` notification.
    //
    // * `params` The {DidChangeWatchedFilesParams} containing the array of {FileEvent}s that
    // have been observed upon the watched files.
    didChangeWatchedFiles(params) {
        this._sendNotification('workspace/didChangeWatchedFiles', params);
    }
    // Public: Register a callback for the `textDocument/publishDiagnostics` message.
    //
    // * `callback` The function to be called when the `textDocument/publishDiagnostics` message is
    //              received a {PublishDiagnosticsParams} containing new {Diagnostic} messages for a given uri.
    onPublishDiagnostics(callback) {
        this._onNotification({ method: 'textDocument/publishDiagnostics' }, callback);
    }
    // Public: Send a `textDocument/completion` request.
    //
    // * `params`            The {TextDocumentPositionParams} or {CompletionParams} for which
    //                       {CompletionItem}s are desired.
    // * `cancellationToken` The {CancellationToken} that is used to cancel this request if
    //                       necessary.
    // Returns a {Promise} containing either a {CompletionList} or an {Array} of {CompletionItem}s.
    completion(params, cancellationToken) {
        // Cancel prior request if necessary
        return this._sendRequest('textDocument/completion', params, cancellationToken);
    }
    // Public: Send a `completionItem/resolve` request.
    //
    // * `params` The {CompletionItem} for which a fully resolved {CompletionItem} is desired.
    // Returns a {Promise} containing a fully resolved {CompletionItem}.
    completionItemResolve(params) {
        return this._sendRequest('completionItem/resolve', params);
    }
    // Public: Send a `textDocument/hover` request.
    //
    // * `params` The {TextDocumentPositionParams} for which a {Hover} is desired.
    // Returns a {Promise} containing a {Hover}.
    hover(params) {
        return this._sendRequest('textDocument/hover', params);
    }
    // Public: Send a `textDocument/signatureHelp` request.
    //
    // * `params` The {TextDocumentPositionParams} for which a {SignatureHelp} is desired.
    // Returns a {Promise} containing a {SignatureHelp}.
    signatureHelp(params) {
        return this._sendRequest('textDocument/signatureHelp', params);
    }
    // Public: Send a `textDocument/definition` request.
    //
    // * `params` The {TextDocumentPositionParams} of a symbol for which one or more {Location}s
    // that define that symbol are required.
    // Returns a {Promise} containing either a single {Location} or an {Array} of many {Location}s.
    gotoDefinition(params) {
        return this._sendRequest('textDocument/definition', params);
    }
    // Public: Send a `textDocument/references` request.
    //
    // * `params` The {TextDocumentPositionParams} of a symbol for which all referring {Location}s
    // are desired.
    // Returns a {Promise} containing an {Array} of {Location}s that reference this symbol.
    findReferences(params) {
        return this._sendRequest('textDocument/references', params);
    }
    // Public: Send a `textDocument/documentHighlight` request.
    //
    // * `params` The {TextDocumentPositionParams} of a symbol for which all highlights are desired.
    // Returns a {Promise} containing an {Array} of {DocumentHighlight}s that can be used to
    // highlight this symbol.
    documentHighlight(params) {
        return this._sendRequest('textDocument/documentHighlight', params);
    }
    // Public: Send a `textDocument/documentSymbol` request.
    //
    // * `params`            The {DocumentSymbolParams} that identifies the document for which
    //                       symbols are desired.
    // * `cancellationToken` The {CancellationToken} that is used to cancel this request if
    //                       necessary.
    // Returns a {Promise} containing an {Array} of {SymbolInformation}s that can be used to
    // navigate this document.
    documentSymbol(params, cancellationToken) {
        return this._sendRequest('textDocument/documentSymbol', params);
    }
    // Public: Send a `workspace/symbol` request.
    //
    // * `params` The {WorkspaceSymbolParams} containing the query string to search the workspace for.
    // Returns a {Promise} containing an {Array} of {SymbolInformation}s that identify where the query
    // string occurs within the workspace.
    workspaceSymbol(params) {
        return this._sendRequest('workspace/symbol', params);
    }
    // Public: Send a `textDocument/codeAction` request.
    //
    // * `params` The {CodeActionParams} identifying the document, range and context for the code action.
    // Returns a {Promise} containing an {Array} of {Commands}s that can be performed against the given
    // documents range.
    codeAction(params) {
        return this._sendRequest('textDocument/codeAction', params);
    }
    // Public: Send a `textDocument/codeLens` request.
    //
    // * `params` The {CodeLensParams} identifying the document for which code lens commands are desired.
    // Returns a {Promise} containing an {Array} of {CodeLens}s that associate commands and data with
    // specified ranges within the document.
    codeLens(params) {
        return this._sendRequest('textDocument/codeLens', params);
    }
    // Public: Send a `codeLens/resolve` request.
    //
    // * `params` The {CodeLens} identifying the code lens to be resolved with full detail.
    // Returns a {Promise} containing the {CodeLens} fully resolved.
    codeLensResolve(params) {
        return this._sendRequest('codeLens/resolve', params);
    }
    // Public: Send a `textDocument/documentLink` request.
    //
    // * `params` The {DocumentLinkParams} identifying the document for which links should be identified.
    // Returns a {Promise} containing an {Array} of {DocumentLink}s relating uri's to specific ranges
    // within the document.
    documentLink(params) {
        return this._sendRequest('textDocument/documentLink', params);
    }
    // Public: Send a `documentLink/resolve` request.
    //
    // * `params` The {DocumentLink} identifying the document link to be resolved with full detail.
    // Returns a {Promise} containing the {DocumentLink} fully resolved.
    documentLinkResolve(params) {
        return this._sendRequest('documentLink/resolve', params);
    }
    // Public: Send a `textDocument/formatting` request.
    //
    // * `params` The {DocumentFormattingParams} identifying the document to be formatted as well as
    // additional formatting preferences.
    // Returns a {Promise} containing an {Array} of {TextEdit}s to be applied to the document to
    // correctly reformat it.
    documentFormatting(params) {
        return this._sendRequest('textDocument/formatting', params);
    }
    // Public: Send a `textDocument/rangeFormatting` request.
    //
    // * `params` The {DocumentRangeFormattingParams} identifying the document and range to be formatted
    // as well as additional formatting preferences.
    // Returns a {Promise} containing an {Array} of {TextEdit}s to be applied to the document to
    // correctly reformat it.
    documentRangeFormatting(params) {
        return this._sendRequest('textDocument/rangeFormatting', params);
    }
    // Public: Send a `textDocument/onTypeFormatting` request.
    //
    // * `params` The {DocumentOnTypeFormattingParams} identifying the document to be formatted,
    // the character that was typed and at what position as well as additional formatting preferences.
    // Returns a {Promise} containing an {Array} of {TextEdit}s to be applied to the document to
    // correctly reformat it.
    documentOnTypeFormatting(params) {
        return this._sendRequest('textDocument/onTypeFormatting', params);
    }
    // Public: Send a `textDocument/rename` request.
    //
    // * `params` The {RenameParams} identifying the document containing the symbol to be renamed,
    // as well as the position and new name.
    // Returns a {Promise} containing an {WorkspaceEdit} that contains a list of {TextEdit}s either
    // on the changes property (keyed by uri) or the documentChanges property containing
    // an {Array} of {TextDocumentEdit}s (preferred).
    rename(params) {
        return this._sendRequest('textDocument/rename', params);
    }
    // Public: Send a `workspace/executeCommand` request.
    //
    // * `params` The {ExecuteCommandParams} specifying the command and arguments
    // the language server should execute (these commands are usually from {CodeLens} or {CodeAction}
    // responses).
    // Returns a {Promise} containing anything.
    executeCommand(params) {
        return this._sendRequest('workspace/executeCommand', params);
    }
    _onRequest(type, callback) {
        this._rpc.onRequest(type.method, (value) => {
            this._log.debug(`rpc.onRequest ${type.method}`, value);
            return callback(value);
        });
    }
    _onNotification(type, callback) {
        this._rpc.onNotification(type.method, (value) => {
            this._log.debug(`rpc.onNotification ${type.method}`, value);
            callback(value);
        });
    }
    _sendNotification(method, args) {
        this._log.debug(`rpc.sendNotification ${method}`, args);
        this._rpc.sendNotification(method, args);
    }
    _sendRequest(method, args, cancellationToken) {
        return __awaiter(this, void 0, void 0, function* () {
            this._log.debug(`rpc.sendRequest ${method} sending`, args);
            try {
                const start = performance.now();
                let result;
                if (cancellationToken) {
                    result = yield this._rpc.sendRequest(method, args, cancellationToken);
                }
                else {
                    // If cancellationToken is null or undefined, don't add the third
                    // argument otherwise vscode-jsonrpc will send an additional, null
                    // message parameter to the request
                    result = yield this._rpc.sendRequest(method, args);
                }
                const took = performance.now() - start;
                this._log.debug(`rpc.sendRequest ${method} received (${Math.floor(took)}ms)`, result);
                return result;
            }
            catch (e) {
                const responseError = e;
                if (cancellationToken && responseError.code === jsonrpc.ErrorCodes.RequestCancelled) {
                    this._log.debug(`rpc.sendRequest ${method} was cancelled`);
                }
                else {
                    this._log.error(`rpc.sendRequest ${method} threw`, e);
                }
                throw e;
            }
        });
    }
}
exports.LanguageClientConnection = LanguageClientConnection;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFuZ3VhZ2VjbGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLDBDQUEwQztBQUUxQyxtQ0FBc0M7QUFDdEMscUNBR2tCO0FBRWxCLG9EQUErQztBQXVCL0MsdUZBQXVGO0FBQ3ZGLGdGQUFnRjtBQUNoRiw4QkFBc0MsU0FBUSxxQkFBWTtJQUt4RCxZQUFZLEdBQThCLEVBQUUsTUFBZTtRQUN6RCxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxJQUFJLElBQUksbUJBQVUsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7UUFFYixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7WUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLHdDQUF3QyxDQUFDLENBQUM7WUFDeEUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxZQUFZO1FBQ2xCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEUsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ2pELElBQUks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cGMgZnJvbSAndnNjb2RlLWpzb25ycGMnO1xyXG5pbXBvcnQgKiBhcyBsc3AgZnJvbSAndnNjb2RlLWxhbmd1YWdlc2VydmVyLXByb3RvY29sJztcclxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcclxuaW1wb3J0IHtcclxuICBOdWxsTG9nZ2VyLFxyXG4gIExvZ2dlcixcclxufSBmcm9tICcuL2xvZ2dlcic7XHJcblxyXG5leHBvcnQgKiBmcm9tICd2c2NvZGUtbGFuZ3VhZ2VzZXJ2ZXItcHJvdG9jb2wnO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBLbm93bk5vdGlmaWNhdGlvbnMge1xyXG4gICd0ZXh0RG9jdW1lbnQvcHVibGlzaERpYWdub3N0aWNzJzogbHNwLlB1Ymxpc2hEaWFnbm9zdGljc1BhcmFtcztcclxuICAndGVsZW1ldHJ5L2V2ZW50JzogYW55O1xyXG4gICd3aW5kb3cvbG9nTWVzc2FnZSc6IGxzcC5Mb2dNZXNzYWdlUGFyYW1zO1xyXG4gICd3aW5kb3cvc2hvd01lc3NhZ2VSZXF1ZXN0JzogbHNwLlNob3dNZXNzYWdlUmVxdWVzdFBhcmFtcztcclxuICAnd2luZG93L3Nob3dNZXNzYWdlJzogbHNwLlNob3dNZXNzYWdlUGFyYW1zO1xyXG4gIFtjdXN0b206IHN0cmluZ106IG9iamVjdDtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBLbm93blJlcXVlc3RzIHtcclxuICAnd2luZG93L3Nob3dNZXNzYWdlUmVxdWVzdCc6XHJcbiAgICBbbHNwLlNob3dNZXNzYWdlUmVxdWVzdFBhcmFtcywgbHNwLk1lc3NhZ2VBY3Rpb25JdGVtIHwgbnVsbF07XHJcbiAgJ3dvcmtzcGFjZS9hcHBseUVkaXQnOlxyXG4gICAgW2xzcC5BcHBseVdvcmtzcGFjZUVkaXRQYXJhbXMsIGxzcC5BcHBseVdvcmtzcGFjZUVkaXRSZXNwb25zZV07XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFJlcXVlc3RDYWxsYmFjazxUIGV4dGVuZHMga2V5b2YgS25vd25SZXF1ZXN0cz4gPVxyXG4gIEtub3duUmVxdWVzdHNbVF0gZXh0ZW5kcyBbaW5mZXIgVSwgaW5mZXIgVl0gP1xyXG4gIChwYXJhbTogVSkgPT4gUHJvbWlzZTxWPiA6XHJcbiAgbmV2ZXI7XHJcblxyXG4vLyBUeXBlU2NyaXB0IHdyYXBwZXIgYXJvdW5kIEpTT05SUEMgdG8gaW1wbGVtZW50IE1pY3Jvc29mdCBMYW5ndWFnZSBTZXJ2ZXIgUHJvdG9jb2wgdjNcclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9sYW5ndWFnZS1zZXJ2ZXItcHJvdG9jb2wvYmxvYi9tYXN0ZXIvcHJvdG9jb2wubWRcclxuZXhwb3J0IGNsYXNzIExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgcHJpdmF0ZSBfcnBjOiBqc29ucnBjLk1lc3NhZ2VDb25uZWN0aW9uO1xyXG4gIHByaXZhdGUgX2xvZzogTG9nZ2VyO1xyXG4gIHB1YmxpYyBpc0Nvbm5lY3RlZDogYm9vbGVhbjtcclxuXHJcbiAgY29uc3RydWN0b3IocnBjOiBqc29ucnBjLk1lc3NhZ2VDb25uZWN0aW9uLCBsb2dnZXI/OiBMb2dnZXIpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLl9ycGMgPSBycGM7XHJcbiAgICB0aGlzLl9sb2cgPSBsb2dnZXIgfHwgbmV3IE51bGxMb2dnZXIoKTtcclxuICAgIHRoaXMuc2V0dXBMb2dnaW5nKCk7XHJcbiAgICBycGMubGlzdGVuKCk7XHJcblxyXG4gICAgdGhpcy5pc0Nvbm5lY3RlZCA9IHRydWU7XHJcbiAgICB0aGlzLl9ycGMub25DbG9zZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgdGhpcy5fbG9nLndhcm4oJ3JwYy5vbkNsb3NlJywgJ1RoZSBSUEMgY29ubmVjdGlvbiBjbG9zZWQgdW5leHBlY3RlZGx5Jyk7XHJcbiAgICAgIHRoaXMuZW1pdCgnY2xvc2UnKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZXR1cExvZ2dpbmcoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9ycGMub25FcnJvcigoZXJyb3IpID0+IHRoaXMuX2xvZy5lcnJvcihbJ3JwYy5vbkVycm9yJywgZXJyb3JdKSk7XHJcbiAgICB0aGlzLl9ycGMub25VbmhhbmRsZWROb3RpZmljYXRpb24oKG5vdGlmaWNhdGlvbikgPT4ge1xyXG4gICAgICBpZiAobm90aWZpY2F0aW9uLm1ldGhvZCAhPSBudWxsICYmIG5vdGlmaWNhdGlvbi5wYXJhbXMgIT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuX2xvZy53YXJuKGBycGMub25VbmhhbmRsZWROb3RpZmljYXRpb24gJHtub3RpZmljYXRpb24ubWV0aG9kfWAsIG5vdGlmaWNhdGlvbi5wYXJhbXMpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2xvZy53YXJuKCdycGMub25VbmhhbmRsZWROb3RpZmljYXRpb24nLCBub3RpZmljYXRpb24pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3JwYy5vbk5vdGlmaWNhdGlvbigoLi4uYXJnczogYW55W10pID0+IHRoaXMuX2xvZy5kZWJ1ZygncnBjLm9uTm90aWZpY2F0aW9uJywgYXJncykpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRpc3Bvc2UoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9ycGMuZGlzcG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBJbml0aWFsaXplIHRoZSBsYW5ndWFnZSBzZXJ2ZXIgd2l0aCBuZWNlc3Nhcnkge0luaXRpYWxpemVQYXJhbXN9LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0luaXRpYWxpemVQYXJhbXN9IGNvbnRhaW5pbmcgcHJvY2Vzc0lkLCByb290UGF0aCwgb3B0aW9ucyBhbmRcclxuICAvLyAgICAgICAgICAgIHNlcnZlciBjYXBhYmlsaXRpZXMuXHJcbiAgLy9cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgdGhlIHtJbml0aWFsaXplUmVzdWx0fSB3aXRoIGRldGFpbHMgb2YgdGhlIHNlcnZlcidzXHJcbiAgLy8gY2FwYWJpbGl0aWVzLlxyXG4gIHB1YmxpYyBpbml0aWFsaXplKHBhcmFtczogbHNwLkluaXRpYWxpemVQYXJhbXMpOiBQcm9taXNlPGxzcC5Jbml0aWFsaXplUmVzdWx0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ2luaXRpYWxpemUnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGFuIGBpbml0aWFsaXplZGAgbm90aWZpY2F0aW9uIHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXIuXHJcbiAgcHVibGljIGluaXRpYWxpemVkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VuZE5vdGlmaWNhdGlvbignaW5pdGlhbGl6ZWQnLCB7fSk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgc2h1dGRvd25gIHJlcXVlc3QgdG8gdGhlIGxhbmd1YWdlIHNlcnZlci5cclxuICBwdWJsaWMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3NodXRkb3duJyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYW4gYGV4aXRgIG5vdGlmaWNhdGlvbiB0byB0aGUgbGFuZ3VhZ2Ugc2VydmVyLlxyXG4gIHB1YmxpYyBleGl0KCk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VuZE5vdGlmaWNhdGlvbignZXhpdCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBSZWdpc3RlciBhIGNhbGxiYWNrIGZvciBhIGN1c3RvbSBtZXNzYWdlLlxyXG4gIC8vXHJcbiAgLy8gKiBgbWV0aG9kYCAgIEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIG5hbWUgb2YgdGhlIG1lc3NhZ2UgdG8gbGlzdGVuIGZvci5cclxuICAvLyAqIGBjYWxsYmFja2AgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBtZXNzYWdlIGlzIHJlY2VpdmVkLlxyXG4gIC8vICAgICAgICAgICAgICBUaGUgcGF5bG9hZCBmcm9tIHRoZSBtZXNzYWdlIGlzIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24uXHJcbiAgcHVibGljIG9uQ3VzdG9tKG1ldGhvZDogc3RyaW5nLCBjYWxsYmFjazogKG9iajogb2JqZWN0KSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbih7bWV0aG9kfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgY3VzdG9tIHJlcXVlc3RcclxuICAvL1xyXG4gIC8vICogYG1ldGhvZGAgICBBIHN0cmluZyBjb250YWluaW5nIHRoZSBuYW1lIG9mIHRoZSByZXF1ZXN0IG1lc3NhZ2UuXHJcbiAgLy8gKiBgcGFyYW1zYCAgIFRoZSBtZXRob2QncyBwYXJhbWV0ZXJzXHJcbiAgcHVibGljIHNlbmRDdXN0b21SZXF1ZXN0KG1ldGhvZDogc3RyaW5nLCBwYXJhbXM/OiBhbnlbXSB8IG9iamVjdCk6IFByb21pc2U8YW55IHwgbnVsbD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KG1ldGhvZCwgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGN1c3RvbSBub3RpZmljYXRpb25cclxuICAvL1xyXG4gIC8vICogYG1ldGhvZGAgICBBIHN0cmluZyBjb250YWluaW5nIHRoZSBuYW1lIG9mIHRoZSBub3RpZmljYXRpb24gbWVzc2FnZS5cclxuICAvLyAqIGBwYXJhbXNgICBUaGUgbWV0aG9kJ3MgcGFyYW1ldGVyc1xyXG4gIHB1YmxpYyBzZW5kQ3VzdG9tTm90aWZpY2F0aW9uKG1ldGhvZDogc3RyaW5nLCBwYXJhbXM/OiBhbnlbXSB8IG9iamVjdCk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VuZE5vdGlmaWNhdGlvbihtZXRob2QsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFJlZ2lzdGVyIGEgY2FsbGJhY2sgZm9yIHRoZSBgd2luZG93L3Nob3dNZXNzYWdlYCBtZXNzYWdlLlxyXG4gIC8vXHJcbiAgLy8gKiBgY2FsbGJhY2tgIFRoZSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2hlbiB0aGUgYHdpbmRvdy9zaG93TWVzc2FnZWAgbWVzc2FnZSBpc1xyXG4gIC8vICAgICAgICAgICAgICByZWNlaXZlZCB3aXRoIHtTaG93TWVzc2FnZVBhcmFtc30gYmVpbmcgcGFzc2VkLlxyXG4gIHB1YmxpYyBvblNob3dNZXNzYWdlKGNhbGxiYWNrOiAocGFyYW1zOiBsc3AuU2hvd01lc3NhZ2VQYXJhbXMpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgIHRoaXMuX29uTm90aWZpY2F0aW9uKHttZXRob2Q6ICd3aW5kb3cvc2hvd01lc3NhZ2UnfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBSZWdpc3RlciBhIGNhbGxiYWNrIGZvciB0aGUgYHdpbmRvdy9zaG93TWVzc2FnZVJlcXVlc3RgIG1lc3NhZ2UuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2AgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBgd2luZG93L3Nob3dNZXNzYWdlUmVxdWVzdGAgbWVzc2FnZSBpc1xyXG4gIC8vICAgICAgICAgICAgICByZWNlaXZlZCB3aXRoIHtTaG93TWVzc2FnZVJlcXVlc3RQYXJhbX0nIGJlaW5nIHBhc3NlZC5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgdGhlIHtNZXNzYWdlQWN0aW9uSXRlbX0uXHJcbiAgcHVibGljIG9uU2hvd01lc3NhZ2VSZXF1ZXN0KGNhbGxiYWNrOiAocGFyYW1zOiBsc3AuU2hvd01lc3NhZ2VSZXF1ZXN0UGFyYW1zKVxyXG4gID0+IFByb21pc2U8bHNwLk1lc3NhZ2VBY3Rpb25JdGVtIHwgbnVsbD4pOiB2b2lkIHtcclxuICAgIHRoaXMuX29uUmVxdWVzdCh7bWV0aG9kOiAnd2luZG93L3Nob3dNZXNzYWdlUmVxdWVzdCd9LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFJlZ2lzdGVyIGEgY2FsbGJhY2sgZm9yIHRoZSBgd2luZG93L2xvZ01lc3NhZ2VgIG1lc3NhZ2UuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2AgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBgd2luZG93L2xvZ01lc3NhZ2VgIG1lc3NhZ2UgaXNcclxuICAvLyAgICAgICAgICAgICAgcmVjZWl2ZWQgd2l0aCB7TG9nTWVzc2FnZVBhcmFtc30gYmVpbmcgcGFzc2VkLlxyXG4gIHB1YmxpYyBvbkxvZ01lc3NhZ2UoY2FsbGJhY2s6IChwYXJhbXM6IGxzcC5Mb2dNZXNzYWdlUGFyYW1zKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbih7bWV0aG9kOiAnd2luZG93L2xvZ01lc3NhZ2UnfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBSZWdpc3RlciBhIGNhbGxiYWNrIGZvciB0aGUgYHRlbGVtZXRyeS9ldmVudGAgbWVzc2FnZS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGB0ZWxlbWV0cnkvZXZlbnRgIG1lc3NhZ2UgaXNcclxuICAvLyAgICAgICAgICAgICAgcmVjZWl2ZWQgd2l0aCBhbnkgcGFyYW1ldGVycyByZWNlaXZlZCBiZWluZyBwYXNzZWQgb24uXHJcbiAgcHVibGljIG9uVGVsZW1ldHJ5RXZlbnQoY2FsbGJhY2s6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgdGhpcy5fb25Ob3RpZmljYXRpb24oe21ldGhvZDogJ3RlbGVtZXRyeS9ldmVudCd9LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFJlZ2lzdGVyIGEgY2FsbGJhY2sgZm9yIHRoZSBgd29ya3NwYWNlL2FwcGx5RWRpdGAgbWVzc2FnZS5cclxuICAvL1xyXG4gIC8vICogYGNhbGxiYWNrYCBUaGUgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGB3b3Jrc3BhY2UvYXBwbHlFZGl0YCBtZXNzYWdlIGlzXHJcbiAgLy8gICAgICAgICAgICAgIHJlY2VpdmVkIHdpdGgge0FwcGx5V29ya3NwYWNlRWRpdFBhcmFtc30gYmVpbmcgcGFzc2VkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyB0aGUge0FwcGx5V29ya3NwYWNlRWRpdFJlc3BvbnNlfS5cclxuICBwdWJsaWMgb25BcHBseUVkaXQoY2FsbGJhY2s6IChwYXJhbXM6IGxzcC5BcHBseVdvcmtzcGFjZUVkaXRQYXJhbXMpID0+XHJcbiAgUHJvbWlzZTxsc3AuQXBwbHlXb3Jrc3BhY2VFZGl0UmVzcG9uc2U+KTogdm9pZCB7XHJcbiAgICB0aGlzLl9vblJlcXVlc3Qoe21ldGhvZDogJ3dvcmtzcGFjZS9hcHBseUVkaXQnfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHdvcmtzcGFjZS9kaWRDaGFuZ2VDb25maWd1cmF0aW9uYCBub3RpZmljYXRpb24uXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7RGlkQ2hhbmdlQ29uZmlndXJhdGlvblBhcmFtc30gY29udGFpbmluZyB0aGUgbmV3IGNvbmZpZ3VyYXRpb24uXHJcbiAgcHVibGljIGRpZENoYW5nZUNvbmZpZ3VyYXRpb24ocGFyYW1zOiBsc3AuRGlkQ2hhbmdlQ29uZmlndXJhdGlvblBhcmFtcyk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VuZE5vdGlmaWNhdGlvbignd29ya3NwYWNlL2RpZENoYW5nZUNvbmZpZ3VyYXRpb24nLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHRleHREb2N1bWVudC9kaWRPcGVuYCBub3RpZmljYXRpb24uXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7RGlkT3BlblRleHREb2N1bWVudFBhcmFtc30gY29udGFpbmluZyB0aGUgb3BlbmVkIHRleHQgZG9jdW1lbnQgZGV0YWlscy5cclxuICBwdWJsaWMgZGlkT3BlblRleHREb2N1bWVudChwYXJhbXM6IGxzcC5EaWRPcGVuVGV4dERvY3VtZW50UGFyYW1zKTogdm9pZCB7XHJcbiAgICB0aGlzLl9zZW5kTm90aWZpY2F0aW9uKCd0ZXh0RG9jdW1lbnQvZGlkT3BlbicsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L2RpZENoYW5nZWAgbm90aWZpY2F0aW9uLlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0RpZENoYW5nZVRleHREb2N1bWVudFBhcmFtc30gY29udGFpbmluZyB0aGUgY2hhbmdlZCB0ZXh0IGRvY3VtZW50XHJcbiAgLy8gZGV0YWlscyBpbmNsdWRpbmcgdGhlIHZlcnNpb24gbnVtYmVyIGFuZCBhY3R1YWwgdGV4dCBjaGFuZ2VzLlxyXG4gIHB1YmxpYyBkaWRDaGFuZ2VUZXh0RG9jdW1lbnQocGFyYW1zOiBsc3AuRGlkQ2hhbmdlVGV4dERvY3VtZW50UGFyYW1zKTogdm9pZCB7XHJcbiAgICB0aGlzLl9zZW5kTm90aWZpY2F0aW9uKCd0ZXh0RG9jdW1lbnQvZGlkQ2hhbmdlJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvZGlkQ2xvc2VgIG5vdGlmaWNhdGlvbi5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtEaWRDbG9zZVRleHREb2N1bWVudFBhcmFtc30gY29udGFpbmluZyB0aGUgb3BlbmVkIHRleHQgZG9jdW1lbnQgZGV0YWlscy5cclxuICBwdWJsaWMgZGlkQ2xvc2VUZXh0RG9jdW1lbnQocGFyYW1zOiBsc3AuRGlkQ2xvc2VUZXh0RG9jdW1lbnRQYXJhbXMpOiB2b2lkIHtcclxuICAgIHRoaXMuX3NlbmROb3RpZmljYXRpb24oJ3RleHREb2N1bWVudC9kaWRDbG9zZScsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L3dpbGxTYXZlYCBub3RpZmljYXRpb24uXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7V2lsbFNhdmVUZXh0RG9jdW1lbnRQYXJhbXN9IGNvbnRhaW5pbmcgdGhlIHRvLWJlLXNhdmVkIHRleHQgZG9jdW1lbnRcclxuICAvLyBkZXRhaWxzIGFuZCB0aGUgcmVhc29uIGZvciB0aGUgc2F2ZS5cclxuICBwdWJsaWMgd2lsbFNhdmVUZXh0RG9jdW1lbnQocGFyYW1zOiBsc3AuV2lsbFNhdmVUZXh0RG9jdW1lbnRQYXJhbXMpOiB2b2lkIHtcclxuICAgIHRoaXMuX3NlbmROb3RpZmljYXRpb24oJ3RleHREb2N1bWVudC93aWxsU2F2ZScsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L3dpbGxTYXZlV2FpdFVudGlsYCBub3RpZmljYXRpb24uXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7V2lsbFNhdmVUZXh0RG9jdW1lbnRQYXJhbXN9IGNvbnRhaW5pbmcgdGhlIHRvLWJlLXNhdmVkIHRleHQgZG9jdW1lbnRcclxuICAvLyBkZXRhaWxzIGFuZCB0aGUgcmVhc29uIGZvciB0aGUgc2F2ZS5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgYW4ge0FycmF5fSBvZiB7VGV4dEVkaXR9cyB0byBiZSBhcHBsaWVkIHRvIHRoZSB0ZXh0XHJcbiAgLy8gZG9jdW1lbnQgYmVmb3JlIGl0IGlzIHNhdmVkLlxyXG4gIHB1YmxpYyB3aWxsU2F2ZVdhaXRVbnRpbFRleHREb2N1bWVudChwYXJhbXM6IGxzcC5XaWxsU2F2ZVRleHREb2N1bWVudFBhcmFtcyk6IFByb21pc2U8bHNwLlRleHRFZGl0W10gfCBudWxsPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC93aWxsU2F2ZVdhaXRVbnRpbCcsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L2RpZFNhdmVgIG5vdGlmaWNhdGlvbi5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtEaWRTYXZlVGV4dERvY3VtZW50UGFyYW1zfSBjb250YWluaW5nIHRoZSBzYXZlZCB0ZXh0IGRvY3VtZW50IGRldGFpbHMuXHJcbiAgcHVibGljIGRpZFNhdmVUZXh0RG9jdW1lbnQocGFyYW1zOiBsc3AuRGlkU2F2ZVRleHREb2N1bWVudFBhcmFtcyk6IHZvaWQge1xyXG4gICAgdGhpcy5fc2VuZE5vdGlmaWNhdGlvbigndGV4dERvY3VtZW50L2RpZFNhdmUnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHdvcmtzcGFjZS9kaWRDaGFuZ2VXYXRjaGVkRmlsZXNgIG5vdGlmaWNhdGlvbi5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtEaWRDaGFuZ2VXYXRjaGVkRmlsZXNQYXJhbXN9IGNvbnRhaW5pbmcgdGhlIGFycmF5IG9mIHtGaWxlRXZlbnR9cyB0aGF0XHJcbiAgLy8gaGF2ZSBiZWVuIG9ic2VydmVkIHVwb24gdGhlIHdhdGNoZWQgZmlsZXMuXHJcbiAgcHVibGljIGRpZENoYW5nZVdhdGNoZWRGaWxlcyhwYXJhbXM6IGxzcC5EaWRDaGFuZ2VXYXRjaGVkRmlsZXNQYXJhbXMpOiB2b2lkIHtcclxuICAgIHRoaXMuX3NlbmROb3RpZmljYXRpb24oJ3dvcmtzcGFjZS9kaWRDaGFuZ2VXYXRjaGVkRmlsZXMnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBSZWdpc3RlciBhIGNhbGxiYWNrIGZvciB0aGUgYHRleHREb2N1bWVudC9wdWJsaXNoRGlhZ25vc3RpY3NgIG1lc3NhZ2UuXHJcbiAgLy9cclxuICAvLyAqIGBjYWxsYmFja2AgVGhlIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBgdGV4dERvY3VtZW50L3B1Ymxpc2hEaWFnbm9zdGljc2AgbWVzc2FnZSBpc1xyXG4gIC8vICAgICAgICAgICAgICByZWNlaXZlZCBhIHtQdWJsaXNoRGlhZ25vc3RpY3NQYXJhbXN9IGNvbnRhaW5pbmcgbmV3IHtEaWFnbm9zdGljfSBtZXNzYWdlcyBmb3IgYSBnaXZlbiB1cmkuXHJcbiAgcHVibGljIG9uUHVibGlzaERpYWdub3N0aWNzKGNhbGxiYWNrOiAocGFyYW1zOiBsc3AuUHVibGlzaERpYWdub3N0aWNzUGFyYW1zKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLl9vbk5vdGlmaWNhdGlvbih7bWV0aG9kOiAndGV4dERvY3VtZW50L3B1Ymxpc2hEaWFnbm9zdGljcyd9LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L2NvbXBsZXRpb25gIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgICAgICAgICAgICAgVGhlIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gb3Ige0NvbXBsZXRpb25QYXJhbXN9IGZvciB3aGljaFxyXG4gIC8vICAgICAgICAgICAgICAgICAgICAgICB7Q29tcGxldGlvbkl0ZW19cyBhcmUgZGVzaXJlZC5cclxuICAvLyAqIGBjYW5jZWxsYXRpb25Ub2tlbmAgVGhlIHtDYW5jZWxsYXRpb25Ub2tlbn0gdGhhdCBpcyB1c2VkIHRvIGNhbmNlbCB0aGlzIHJlcXVlc3QgaWZcclxuICAvLyAgICAgICAgICAgICAgICAgICAgICAgbmVjZXNzYXJ5LlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBlaXRoZXIgYSB7Q29tcGxldGlvbkxpc3R9IG9yIGFuIHtBcnJheX0gb2Yge0NvbXBsZXRpb25JdGVtfXMuXHJcbiAgcHVibGljIGNvbXBsZXRpb24oXHJcbiAgICBwYXJhbXM6IGxzcC5UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyB8IENvbXBsZXRpb25QYXJhbXMsXHJcbiAgICBjYW5jZWxsYXRpb25Ub2tlbj86IGpzb25ycGMuQ2FuY2VsbGF0aW9uVG9rZW4pOiBQcm9taXNlPGxzcC5Db21wbGV0aW9uSXRlbVtdIHwgbHNwLkNvbXBsZXRpb25MaXN0PiB7XHJcbiAgICAvLyBDYW5jZWwgcHJpb3IgcmVxdWVzdCBpZiBuZWNlc3NhcnlcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgndGV4dERvY3VtZW50L2NvbXBsZXRpb24nLCBwYXJhbXMsIGNhbmNlbGxhdGlvblRva2VuKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGBjb21wbGV0aW9uSXRlbS9yZXNvbHZlYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0NvbXBsZXRpb25JdGVtfSBmb3Igd2hpY2ggYSBmdWxseSByZXNvbHZlZCB7Q29tcGxldGlvbkl0ZW19IGlzIGRlc2lyZWQuXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBjb250YWluaW5nIGEgZnVsbHkgcmVzb2x2ZWQge0NvbXBsZXRpb25JdGVtfS5cclxuICBwdWJsaWMgY29tcGxldGlvbkl0ZW1SZXNvbHZlKHBhcmFtczogbHNwLkNvbXBsZXRpb25JdGVtKTogUHJvbWlzZTxsc3AuQ29tcGxldGlvbkl0ZW0gfCBudWxsPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ2NvbXBsZXRpb25JdGVtL3Jlc29sdmUnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHRleHREb2N1bWVudC9ob3ZlcmAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gZm9yIHdoaWNoIGEge0hvdmVyfSBpcyBkZXNpcmVkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhIHtIb3Zlcn0uXHJcbiAgcHVibGljIGhvdmVyKHBhcmFtczogbHNwLlRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKTogUHJvbWlzZTxsc3AuSG92ZXIgfCBudWxsPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9ob3ZlcicsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L3NpZ25hdHVyZUhlbHBgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7VGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXN9IGZvciB3aGljaCBhIHtTaWduYXR1cmVIZWxwfSBpcyBkZXNpcmVkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhIHtTaWduYXR1cmVIZWxwfS5cclxuICBwdWJsaWMgc2lnbmF0dXJlSGVscChwYXJhbXM6IGxzcC5UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyk6IFByb21pc2U8bHNwLlNpZ25hdHVyZUhlbHAgfCBudWxsPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9zaWduYXR1cmVIZWxwJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvZGVmaW5pdGlvbmAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gb2YgYSBzeW1ib2wgZm9yIHdoaWNoIG9uZSBvciBtb3JlIHtMb2NhdGlvbn1zXHJcbiAgLy8gdGhhdCBkZWZpbmUgdGhhdCBzeW1ib2wgYXJlIHJlcXVpcmVkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBlaXRoZXIgYSBzaW5nbGUge0xvY2F0aW9ufSBvciBhbiB7QXJyYXl9IG9mIG1hbnkge0xvY2F0aW9ufXMuXHJcbiAgcHVibGljIGdvdG9EZWZpbml0aW9uKHBhcmFtczogbHNwLlRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKTogUHJvbWlzZTxsc3AuTG9jYXRpb24gfCBsc3AuTG9jYXRpb25bXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCd0ZXh0RG9jdW1lbnQvZGVmaW5pdGlvbicsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L3JlZmVyZW5jZXNgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7VGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXN9IG9mIGEgc3ltYm9sIGZvciB3aGljaCBhbGwgcmVmZXJyaW5nIHtMb2NhdGlvbn1zXHJcbiAgLy8gYXJlIGRlc2lyZWQuXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBjb250YWluaW5nIGFuIHtBcnJheX0gb2Yge0xvY2F0aW9ufXMgdGhhdCByZWZlcmVuY2UgdGhpcyBzeW1ib2wuXHJcbiAgcHVibGljIGZpbmRSZWZlcmVuY2VzKHBhcmFtczogbHNwLlJlZmVyZW5jZVBhcmFtcyk6IFByb21pc2U8bHNwLkxvY2F0aW9uW10+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgndGV4dERvY3VtZW50L3JlZmVyZW5jZXMnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHRleHREb2N1bWVudC9kb2N1bWVudEhpZ2hsaWdodGAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgVGhlIHtUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtc30gb2YgYSBzeW1ib2wgZm9yIHdoaWNoIGFsbCBoaWdobGlnaHRzIGFyZSBkZXNpcmVkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhbiB7QXJyYXl9IG9mIHtEb2N1bWVudEhpZ2hsaWdodH1zIHRoYXQgY2FuIGJlIHVzZWQgdG9cclxuICAvLyBoaWdobGlnaHQgdGhpcyBzeW1ib2wuXHJcbiAgcHVibGljIGRvY3VtZW50SGlnaGxpZ2h0KHBhcmFtczogbHNwLlRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKTogUHJvbWlzZTxsc3AuRG9jdW1lbnRIaWdobGlnaHRbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCd0ZXh0RG9jdW1lbnQvZG9jdW1lbnRIaWdobGlnaHQnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHRleHREb2N1bWVudC9kb2N1bWVudFN5bWJvbGAgcmVxdWVzdC5cclxuICAvL1xyXG4gIC8vICogYHBhcmFtc2AgICAgICAgICAgICBUaGUge0RvY3VtZW50U3ltYm9sUGFyYW1zfSB0aGF0IGlkZW50aWZpZXMgdGhlIGRvY3VtZW50IGZvciB3aGljaFxyXG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBzeW1ib2xzIGFyZSBkZXNpcmVkLlxyXG4gIC8vICogYGNhbmNlbGxhdGlvblRva2VuYCBUaGUge0NhbmNlbGxhdGlvblRva2VufSB0aGF0IGlzIHVzZWQgdG8gY2FuY2VsIHRoaXMgcmVxdWVzdCBpZlxyXG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBuZWNlc3NhcnkuXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBjb250YWluaW5nIGFuIHtBcnJheX0gb2Yge1N5bWJvbEluZm9ybWF0aW9ufXMgdGhhdCBjYW4gYmUgdXNlZCB0b1xyXG4gIC8vIG5hdmlnYXRlIHRoaXMgZG9jdW1lbnQuXHJcbiAgcHVibGljIGRvY3VtZW50U3ltYm9sKFxyXG4gICAgcGFyYW1zOiBsc3AuRG9jdW1lbnRTeW1ib2xQYXJhbXMsXHJcbiAgICBjYW5jZWxsYXRpb25Ub2tlbj86IGpzb25ycGMuQ2FuY2VsbGF0aW9uVG9rZW4sXHJcbiAgKTogUHJvbWlzZTxsc3AuU3ltYm9sSW5mb3JtYXRpb25bXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCd0ZXh0RG9jdW1lbnQvZG9jdW1lbnRTeW1ib2wnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYHdvcmtzcGFjZS9zeW1ib2xgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7V29ya3NwYWNlU3ltYm9sUGFyYW1zfSBjb250YWluaW5nIHRoZSBxdWVyeSBzdHJpbmcgdG8gc2VhcmNoIHRoZSB3b3Jrc3BhY2UgZm9yLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhbiB7QXJyYXl9IG9mIHtTeW1ib2xJbmZvcm1hdGlvbn1zIHRoYXQgaWRlbnRpZnkgd2hlcmUgdGhlIHF1ZXJ5XHJcbiAgLy8gc3RyaW5nIG9jY3VycyB3aXRoaW4gdGhlIHdvcmtzcGFjZS5cclxuICBwdWJsaWMgd29ya3NwYWNlU3ltYm9sKHBhcmFtczogbHNwLldvcmtzcGFjZVN5bWJvbFBhcmFtcyk6IFByb21pc2U8bHNwLlN5bWJvbEluZm9ybWF0aW9uW10+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgnd29ya3NwYWNlL3N5bWJvbCcsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L2NvZGVBY3Rpb25gIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7Q29kZUFjdGlvblBhcmFtc30gaWRlbnRpZnlpbmcgdGhlIGRvY3VtZW50LCByYW5nZSBhbmQgY29udGV4dCBmb3IgdGhlIGNvZGUgYWN0aW9uLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhbiB7QXJyYXl9IG9mIHtDb21tYW5kc31zIHRoYXQgY2FuIGJlIHBlcmZvcm1lZCBhZ2FpbnN0IHRoZSBnaXZlblxyXG4gIC8vIGRvY3VtZW50cyByYW5nZS5cclxuICBwdWJsaWMgY29kZUFjdGlvbihwYXJhbXM6IGxzcC5Db2RlQWN0aW9uUGFyYW1zKTogUHJvbWlzZTxsc3AuQ29tbWFuZFtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9jb2RlQWN0aW9uJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvY29kZUxlbnNgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7Q29kZUxlbnNQYXJhbXN9IGlkZW50aWZ5aW5nIHRoZSBkb2N1bWVudCBmb3Igd2hpY2ggY29kZSBsZW5zIGNvbW1hbmRzIGFyZSBkZXNpcmVkLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhbiB7QXJyYXl9IG9mIHtDb2RlTGVuc31zIHRoYXQgYXNzb2NpYXRlIGNvbW1hbmRzIGFuZCBkYXRhIHdpdGhcclxuICAvLyBzcGVjaWZpZWQgcmFuZ2VzIHdpdGhpbiB0aGUgZG9jdW1lbnQuXHJcbiAgcHVibGljIGNvZGVMZW5zKHBhcmFtczogbHNwLkNvZGVMZW5zUGFyYW1zKTogUHJvbWlzZTxsc3AuQ29kZUxlbnNbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCd0ZXh0RG9jdW1lbnQvY29kZUxlbnMnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYGNvZGVMZW5zL3Jlc29sdmVgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7Q29kZUxlbnN9IGlkZW50aWZ5aW5nIHRoZSBjb2RlIGxlbnMgdG8gYmUgcmVzb2x2ZWQgd2l0aCBmdWxsIGRldGFpbC5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgdGhlIHtDb2RlTGVuc30gZnVsbHkgcmVzb2x2ZWQuXHJcbiAgcHVibGljIGNvZGVMZW5zUmVzb2x2ZShwYXJhbXM6IGxzcC5Db2RlTGVucyk6IFByb21pc2U8bHNwLkNvZGVMZW5zIHwgbnVsbD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCdjb2RlTGVucy9yZXNvbHZlJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvZG9jdW1lbnRMaW5rYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0RvY3VtZW50TGlua1BhcmFtc30gaWRlbnRpZnlpbmcgdGhlIGRvY3VtZW50IGZvciB3aGljaCBsaW5rcyBzaG91bGQgYmUgaWRlbnRpZmllZC5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgYW4ge0FycmF5fSBvZiB7RG9jdW1lbnRMaW5rfXMgcmVsYXRpbmcgdXJpJ3MgdG8gc3BlY2lmaWMgcmFuZ2VzXHJcbiAgLy8gd2l0aGluIHRoZSBkb2N1bWVudC5cclxuICBwdWJsaWMgZG9jdW1lbnRMaW5rKHBhcmFtczogbHNwLkRvY3VtZW50TGlua1BhcmFtcyk6IFByb21pc2U8bHNwLkRvY3VtZW50TGlua1tdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9kb2N1bWVudExpbmsnLCBwYXJhbXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljOiBTZW5kIGEgYGRvY3VtZW50TGluay9yZXNvbHZlYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0RvY3VtZW50TGlua30gaWRlbnRpZnlpbmcgdGhlIGRvY3VtZW50IGxpbmsgdG8gYmUgcmVzb2x2ZWQgd2l0aCBmdWxsIGRldGFpbC5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgdGhlIHtEb2N1bWVudExpbmt9IGZ1bGx5IHJlc29sdmVkLlxyXG4gIHB1YmxpYyBkb2N1bWVudExpbmtSZXNvbHZlKHBhcmFtczogbHNwLkRvY3VtZW50TGluayk6IFByb21pc2U8bHNwLkRvY3VtZW50TGluaz4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3NlbmRSZXF1ZXN0KCdkb2N1bWVudExpbmsvcmVzb2x2ZScsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L2Zvcm1hdHRpbmdgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7RG9jdW1lbnRGb3JtYXR0aW5nUGFyYW1zfSBpZGVudGlmeWluZyB0aGUgZG9jdW1lbnQgdG8gYmUgZm9ybWF0dGVkIGFzIHdlbGwgYXNcclxuICAvLyBhZGRpdGlvbmFsIGZvcm1hdHRpbmcgcHJlZmVyZW5jZXMuXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBjb250YWluaW5nIGFuIHtBcnJheX0gb2Yge1RleHRFZGl0fXMgdG8gYmUgYXBwbGllZCB0byB0aGUgZG9jdW1lbnQgdG9cclxuICAvLyBjb3JyZWN0bHkgcmVmb3JtYXQgaXQuXHJcbiAgcHVibGljIGRvY3VtZW50Rm9ybWF0dGluZyhwYXJhbXM6IGxzcC5Eb2N1bWVudEZvcm1hdHRpbmdQYXJhbXMpOiBQcm9taXNlPGxzcC5UZXh0RWRpdFtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9mb3JtYXR0aW5nJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvcmFuZ2VGb3JtYXR0aW5nYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0RvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUGFyYW1zfSBpZGVudGlmeWluZyB0aGUgZG9jdW1lbnQgYW5kIHJhbmdlIHRvIGJlIGZvcm1hdHRlZFxyXG4gIC8vIGFzIHdlbGwgYXMgYWRkaXRpb25hbCBmb3JtYXR0aW5nIHByZWZlcmVuY2VzLlxyXG4gIC8vIFJldHVybnMgYSB7UHJvbWlzZX0gY29udGFpbmluZyBhbiB7QXJyYXl9IG9mIHtUZXh0RWRpdH1zIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGRvY3VtZW50IHRvXHJcbiAgLy8gY29ycmVjdGx5IHJlZm9ybWF0IGl0LlxyXG4gIHB1YmxpYyBkb2N1bWVudFJhbmdlRm9ybWF0dGluZyhwYXJhbXM6IGxzcC5Eb2N1bWVudFJhbmdlRm9ybWF0dGluZ1BhcmFtcyk6IFByb21pc2U8bHNwLlRleHRFZGl0W10+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgndGV4dERvY3VtZW50L3JhbmdlRm9ybWF0dGluZycsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgdGV4dERvY3VtZW50L29uVHlwZUZvcm1hdHRpbmdgIHJlcXVlc3QuXHJcbiAgLy9cclxuICAvLyAqIGBwYXJhbXNgIFRoZSB7RG9jdW1lbnRPblR5cGVGb3JtYXR0aW5nUGFyYW1zfSBpZGVudGlmeWluZyB0aGUgZG9jdW1lbnQgdG8gYmUgZm9ybWF0dGVkLFxyXG4gIC8vIHRoZSBjaGFyYWN0ZXIgdGhhdCB3YXMgdHlwZWQgYW5kIGF0IHdoYXQgcG9zaXRpb24gYXMgd2VsbCBhcyBhZGRpdGlvbmFsIGZvcm1hdHRpbmcgcHJlZmVyZW5jZXMuXHJcbiAgLy8gUmV0dXJucyBhIHtQcm9taXNlfSBjb250YWluaW5nIGFuIHtBcnJheX0gb2Yge1RleHRFZGl0fXMgdG8gYmUgYXBwbGllZCB0byB0aGUgZG9jdW1lbnQgdG9cclxuICAvLyBjb3JyZWN0bHkgcmVmb3JtYXQgaXQuXHJcbiAgcHVibGljIGRvY3VtZW50T25UeXBlRm9ybWF0dGluZyhwYXJhbXM6IGxzcC5Eb2N1bWVudE9uVHlwZUZvcm1hdHRpbmdQYXJhbXMpOiBQcm9taXNlPGxzcC5UZXh0RWRpdFtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3QoJ3RleHREb2N1bWVudC9vblR5cGVGb3JtYXR0aW5nJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYzogU2VuZCBhIGB0ZXh0RG9jdW1lbnQvcmVuYW1lYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge1JlbmFtZVBhcmFtc30gaWRlbnRpZnlpbmcgdGhlIGRvY3VtZW50IGNvbnRhaW5pbmcgdGhlIHN5bWJvbCB0byBiZSByZW5hbWVkLFxyXG4gIC8vIGFzIHdlbGwgYXMgdGhlIHBvc2l0aW9uIGFuZCBuZXcgbmFtZS5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgYW4ge1dvcmtzcGFjZUVkaXR9IHRoYXQgY29udGFpbnMgYSBsaXN0IG9mIHtUZXh0RWRpdH1zIGVpdGhlclxyXG4gIC8vIG9uIHRoZSBjaGFuZ2VzIHByb3BlcnR5IChrZXllZCBieSB1cmkpIG9yIHRoZSBkb2N1bWVudENoYW5nZXMgcHJvcGVydHkgY29udGFpbmluZ1xyXG4gIC8vIGFuIHtBcnJheX0gb2Yge1RleHREb2N1bWVudEVkaXR9cyAocHJlZmVycmVkKS5cclxuICBwdWJsaWMgcmVuYW1lKHBhcmFtczogbHNwLlJlbmFtZVBhcmFtcyk6IFByb21pc2U8bHNwLldvcmtzcGFjZUVkaXQ+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgndGV4dERvY3VtZW50L3JlbmFtZScsIHBhcmFtcyk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWM6IFNlbmQgYSBgd29ya3NwYWNlL2V4ZWN1dGVDb21tYW5kYCByZXF1ZXN0LlxyXG4gIC8vXHJcbiAgLy8gKiBgcGFyYW1zYCBUaGUge0V4ZWN1dGVDb21tYW5kUGFyYW1zfSBzcGVjaWZ5aW5nIHRoZSBjb21tYW5kIGFuZCBhcmd1bWVudHNcclxuICAvLyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIHNob3VsZCBleGVjdXRlICh0aGVzZSBjb21tYW5kcyBhcmUgdXN1YWxseSBmcm9tIHtDb2RlTGVuc30gb3Ige0NvZGVBY3Rpb259XHJcbiAgLy8gcmVzcG9uc2VzKS5cclxuICAvLyBSZXR1cm5zIGEge1Byb21pc2V9IGNvbnRhaW5pbmcgYW55dGhpbmcuXHJcbiAgcHVibGljIGV4ZWN1dGVDb21tYW5kKHBhcmFtczogbHNwLkV4ZWN1dGVDb21tYW5kUGFyYW1zKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdCgnd29ya3NwYWNlL2V4ZWN1dGVDb21tYW5kJywgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uUmVxdWVzdDxUIGV4dGVuZHMga2V5b2YgS25vd25SZXF1ZXN0cz4odHlwZToge21ldGhvZDogVH0sIGNhbGxiYWNrOiBSZXF1ZXN0Q2FsbGJhY2s8VD4pOiB2b2lkIHtcclxuICAgIHRoaXMuX3JwYy5vblJlcXVlc3QodHlwZS5tZXRob2QsICh2YWx1ZSkgPT4ge1xyXG4gICAgICB0aGlzLl9sb2cuZGVidWcoYHJwYy5vblJlcXVlc3QgJHt0eXBlLm1ldGhvZH1gLCB2YWx1ZSk7XHJcbiAgICAgIHJldHVybiBjYWxsYmFjayh2YWx1ZSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uTm90aWZpY2F0aW9uPFQgZXh0ZW5kcyBrZXlvZiBLbm93bk5vdGlmaWNhdGlvbnM+KFxyXG4gICAgdHlwZToge21ldGhvZDogVH0sIGNhbGxiYWNrOiAob2JqOiBLbm93bk5vdGlmaWNhdGlvbnNbVF0pID0+IHZvaWQsXHJcbiAgKTogdm9pZCB7XHJcbiAgICB0aGlzLl9ycGMub25Ob3RpZmljYXRpb24odHlwZS5tZXRob2QsICh2YWx1ZSkgPT4ge1xyXG4gICAgICB0aGlzLl9sb2cuZGVidWcoYHJwYy5vbk5vdGlmaWNhdGlvbiAke3R5cGUubWV0aG9kfWAsIHZhbHVlKTtcclxuICAgICAgY2FsbGJhY2sodmFsdWUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZW5kTm90aWZpY2F0aW9uKG1ldGhvZDogc3RyaW5nLCBhcmdzPzogb2JqZWN0KTogdm9pZCB7XHJcbiAgICB0aGlzLl9sb2cuZGVidWcoYHJwYy5zZW5kTm90aWZpY2F0aW9uICR7bWV0aG9kfWAsIGFyZ3MpO1xyXG4gICAgdGhpcy5fcnBjLnNlbmROb3RpZmljYXRpb24obWV0aG9kLCBhcmdzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgX3NlbmRSZXF1ZXN0KFxyXG4gICAgbWV0aG9kOiBzdHJpbmcsXHJcbiAgICBhcmdzPzogb2JqZWN0LFxyXG4gICAgY2FuY2VsbGF0aW9uVG9rZW4/OiBqc29ucnBjLkNhbmNlbGxhdGlvblRva2VuLFxyXG4gICk6IFByb21pc2U8YW55PiB7XHJcbiAgICB0aGlzLl9sb2cuZGVidWcoYHJwYy5zZW5kUmVxdWVzdCAke21ldGhvZH0gc2VuZGluZ2AsIGFyZ3MpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgbGV0IHJlc3VsdDtcclxuICAgICAgaWYgKGNhbmNlbGxhdGlvblRva2VuKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5fcnBjLnNlbmRSZXF1ZXN0KG1ldGhvZCwgYXJncywgY2FuY2VsbGF0aW9uVG9rZW4pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIElmIGNhbmNlbGxhdGlvblRva2VuIGlzIG51bGwgb3IgdW5kZWZpbmVkLCBkb24ndCBhZGQgdGhlIHRoaXJkXHJcbiAgICAgICAgLy8gYXJndW1lbnQgb3RoZXJ3aXNlIHZzY29kZS1qc29ucnBjIHdpbGwgc2VuZCBhbiBhZGRpdGlvbmFsLCBudWxsXHJcbiAgICAgICAgLy8gbWVzc2FnZSBwYXJhbWV0ZXIgdG8gdGhlIHJlcXVlc3RcclxuICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLl9ycGMuc2VuZFJlcXVlc3QobWV0aG9kLCBhcmdzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdG9vayA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQ7XHJcbiAgICAgIHRoaXMuX2xvZy5kZWJ1ZyhgcnBjLnNlbmRSZXF1ZXN0ICR7bWV0aG9kfSByZWNlaXZlZCAoJHtNYXRoLmZsb29yKHRvb2spfW1zKWAsIHJlc3VsdCk7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlRXJyb3IgPSBlIGFzIGpzb25ycGMuUmVzcG9uc2VFcnJvcjxhbnk+O1xyXG4gICAgICBpZiAoY2FuY2VsbGF0aW9uVG9rZW4gJiYgcmVzcG9uc2VFcnJvci5jb2RlID09PSBqc29ucnBjLkVycm9yQ29kZXMuUmVxdWVzdENhbmNlbGxlZCkge1xyXG4gICAgICAgIHRoaXMuX2xvZy5kZWJ1ZyhgcnBjLnNlbmRSZXF1ZXN0ICR7bWV0aG9kfSB3YXMgY2FuY2VsbGVkYCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgdGhpcy5fbG9nLmVycm9yKGBycGMuc2VuZFJlcXVlc3QgJHttZXRob2R9IHRocmV3YCwgZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgdHlwZSBEaWFnbm9zdGljQ29kZSA9IG51bWJlciB8IHN0cmluZztcclxuXHJcbi8qKlxyXG4gKiBDb250YWlucyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBjb250ZXh0IGluIHdoaWNoIGEgY29tcGxldGlvbiByZXF1ZXN0IGlzIHRyaWdnZXJlZC5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGxldGlvbkNvbnRleHQge1xyXG4gIC8qKlxyXG4gICAqIEhvdyB0aGUgY29tcGxldGlvbiB3YXMgdHJpZ2dlcmVkLlxyXG4gICAqL1xyXG4gIHRyaWdnZXJLaW5kOiBsc3AuQ29tcGxldGlvblRyaWdnZXJLaW5kO1xyXG5cclxuICAvKipcclxuICAgKiBUaGUgdHJpZ2dlciBjaGFyYWN0ZXIgKGEgc2luZ2xlIGNoYXJhY3RlcikgdGhhdCBoYXMgdHJpZ2dlciBjb2RlIGNvbXBsZXRlLlxyXG4gICAqIElzIHVuZGVmaW5lZCBpZiBgdHJpZ2dlcktpbmQgIT09IENvbXBsZXRpb25UcmlnZ2VyS2luZC5UcmlnZ2VyQ2hhcmFjdGVyYFxyXG4gICAqL1xyXG4gIHRyaWdnZXJDaGFyYWN0ZXI/OiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDb21wbGV0aW9uIHBhcmFtZXRlcnNcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGxldGlvblBhcmFtcyBleHRlbmRzIGxzcC5UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyB7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBjb21wbGV0aW9uIGNvbnRleHQuIFRoaXMgaXMgb25seSBhdmFpbGFibGUgaXQgdGhlIGNsaWVudCBzcGVjaWZpZXNcclxuICAgKiB0byBzZW5kIHRoaXMgdXNpbmcgYENsaWVudENhcGFiaWxpdGllcy50ZXh0RG9jdW1lbnQuY29tcGxldGlvbi5jb250ZXh0U3VwcG9ydCA9PT0gdHJ1ZWBcclxuICAgKi9cclxuICBjb250ZXh0PzogQ29tcGxldGlvbkNvbnRleHQ7XHJcbn1cclxuIl19